<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Cui的个人博客</title>
  <subtitle>不要让希望变成了失望</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://chr10003566.github.io./"/>
  <updated>2020-02-26T13:04:01.610Z</updated>
  <id>http://chr10003566.github.io./</id>
  
  <author>
    <name>Cui</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>FoveaBox论文笔记</title>
    <link href="http://chr10003566.github.io./2020/02/26/FoveaBox%E8%AE%BA%E6%96%87%E7%AC%94%E8%AE%B0/"/>
    <id>http://chr10003566.github.io./2020/02/26/FoveaBox论文笔记/</id>
    <published>2020-02-26T08:45:16.000Z</published>
    <updated>2020-02-26T13:04:01.610Z</updated>
    
    <content type="html">&lt;p&gt;论文：FoveaBox: Beyond Anchor-based Object Detector&lt;br&gt;论文链接：&lt;a href=&quot;https://arxiv.org/abs/1904.03797&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://arxiv.org/abs/1904.03797&lt;/a&gt;&lt;br&gt;代码链接：&lt;a href=&quot;https://github.com/taokong/FoveaBox&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/taokong/FoveaBox&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;Introduction&quot;&gt;&lt;a href=&quot;#Introduction&quot; class=&quot;headerlink&quot; title=&quot;Introduction&quot;&gt;&lt;/a&gt;Introduction&lt;/h2&gt;&lt;p&gt;FoveaBox同样是一篇Anchor Free的文章，与之前介绍的Anchor Free文章不同，FoveaBox并不是通过关键点检测来实现，其思想有点类似DenseBox与YOLOv1，Anchor-based的思想是通过预定义一些Anchor（候选框）去与Groundtruth做比较，得到候选框相对GroundTruth的偏移量，而FoveaBox则将候选框移除了，得到的Feature map对每个pixel预测其分类与候选框的坐标，几乎就是暴力回归。与其他的Anchor free的文章一样，该文章指出Anchor based文章有以下三个问题：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;会带来不少的超参数（anchor的个数、比例等等）&lt;/li&gt;
&lt;li&gt;对于不同的数据集，需要设计不同的anchor的尺寸和比例，泛化能力较差（类似YOLOv3通过聚类得到anchor的大小）&lt;/li&gt;
&lt;li&gt;anchor机制会导致正负样本不平衡的问题&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;上述的问题，也确实是Anchor机制导致的问题，相信大家也听过不少了，解决方法要么是提出能够自适应的Anchor，要么放弃Anchor，投入Anchor-free的怀抱。&lt;br&gt;&lt;img src=&quot;https://pic.downk.cc/item/5e5652a56127cc0713d5d532.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;Method&quot;&gt;&lt;a href=&quot;#Method&quot; class=&quot;headerlink&quot; title=&quot;Method&quot;&gt;&lt;/a&gt;Method&lt;/h2&gt;&lt;h3 id=&quot;Architecture&quot;&gt;&lt;a href=&quot;#Architecture&quot; class=&quot;headerlink&quot; title=&quot;Architecture&quot;&gt;&lt;/a&gt;Architecture&lt;/h3&gt;&lt;p&gt;&lt;img src=&quot;https://pic.downk.cc/item/5e5652fa6127cc0713d5e265.png&quot; alt=&quot;&quot;&gt;&lt;br&gt;首先我们来看看FoveaBox的整体框架是怎样的（见上图），是不是很熟悉，这不是和RetianNet一致的框架么。不同的地方就在与（原文作者也标红了），最后一层的feature map的通道数不相同，RetinaNet是W x H x KA和 W x H x 4A，而FoevaBox则是W x H x K和W x H x 4，其中K表示数据集中物体的类别数（COCO - 80， VOC - 20）而A表示 Anchor的数目，FoevaBox摒弃了Anchor，因此channel数自然少了A倍。&lt;/p&gt;
&lt;h3 id=&quot;Scale-Assignment&quot;&gt;&lt;a href=&quot;#Scale-Assignment&quot; class=&quot;headerlink&quot; title=&quot;Scale Assignment&quot;&gt;&lt;/a&gt;Scale Assignment&lt;/h3&gt;&lt;p&gt;由于不同的物体，尺度变化较大，作者借鉴了FPN的思路，FoveaBox将连续尺度划分成多个区间，并将它们和特征金字塔中的不同层对应。因此，特征金字塔中每层只负责预测某个特定尺度范围的矩形框，其中Sl表示第l层特征的基础大小，而给定的区间范围由一个系数η控制，衡量方式如下二式所示：&lt;br&gt;&lt;img src=&quot;https://img-blog.csdnimg.cn/20191007201656622.png&quot; alt=&quot;&quot;&gt;&lt;br&gt;&lt;img src=&quot;https://img-blog.csdnimg.cn/20191007201716471.png&quot; alt=&quot;&quot;&gt;&lt;br&gt;其中值得注意的是某个尺寸的物体可能会被映射到金字塔不同层次，这与之前FPN的概念有差异（某尺寸只被映射到金字塔特定某层）。&lt;/p&gt;
&lt;h3 id=&quot;Object-Fovea&quot;&gt;&lt;a href=&quot;#Object-Fovea&quot; class=&quot;headerlink&quot; title=&quot;Object Fovea&quot;&gt;&lt;/a&gt;Object Fovea&lt;/h3&gt;&lt;p&gt;Fovea其实就是依据ground truth 在输出的特征上制定的样本区域。给定一个ground truth的坐标（X1,Y1,X2,Y2）,首先将这个矩形框映射到其对应的金字塔层&lt;br&gt;&lt;img src=&quot;https://img-blog.csdnimg.cn/20191007201745787.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;可以看到就是将image上的矩形框的坐标点映射倒FPN输出的每个Feature map上。得到GT映射到Feature map的中心点坐标后，作者通过以下的变换确定中心区域。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img-blog.csdnimg.cn/2019100720175945.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;FoveaBox需要对特征图上每个点都预测一个分类结果以及并回归边框的偏移量，由于物体真实边框附近的点远离物体中心，或者与背景像素更为接近，如果将其作为正样本，对模型的训练造成困难。因此作者通过一个简单的变换，先通过groundtruh边框得到物体中心在特征图中对应的位置，然后通过一个参数σ1调节物体高和宽，将用来训练的真实边框位置向物体中心收缩一点，收缩后的边框内部的点作为正样本，然后使用参数σ2 再次调节边框高和宽，使其向外扩展一点，使用扩展边框外部的点作为负样本(原文是除了正区域外的，被assign的整个feature map区域，作为负样本)，这样将两个边框范围内的点忽略掉，增加正负样本之间的判别度。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;σ1 是缩放因子，处于正区域范围内的单元会在训练的时候被标上相应类别标签。而另外一个缩放因子 σ2会被用在制定负区域，同样的计算方式（实验中采用的是σ1=0.3,σ2=0.4）。与此同时，需要注意此时的正样本只占了一小部分，为了克服正负样本不均衡，在分类任务中采用了Focal loss。&lt;/p&gt;
&lt;h3 id=&quot;Box-Prediction&quot;&gt;&lt;a href=&quot;#Box-Prediction&quot; class=&quot;headerlink&quot; title=&quot;Box Prediction&quot;&gt;&lt;/a&gt;Box Prediction&lt;/h3&gt;&lt;p&gt;关于Box 的回归，作者是通过下面那个分支，每个点会预测出(tx1,ty1,tx2,ty2)。其中(x1,y1,x2,y2)表示ground truth坐标，(x,y)表示一个cell单元的坐标，z为标准化因子使得输出空间映射到以1为中心的新空间&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img-blog.csdnimg.cn/20191007201848902.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxMzc1NjA5,size_16,color_FFFFFF,t_70&quot; alt=&quot;&quot;&gt;&lt;br&gt;在本篇文章中，采用的是Smooth L1 loss&lt;/p&gt;
&lt;p&gt;学习资料：&lt;br&gt;&lt;a href=&quot;https://blog.csdn.net/qq_41375609/article/details/102325395&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;FoevaBox优质博客&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;论文：FoveaBox: Beyond Anchor-based Object Detector&lt;br&gt;论文链接：&lt;a href=&quot;https://arxiv.org/abs/1904.03797&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https:
    
    </summary>
    
      <category term="论文阅读" scheme="http://chr10003566.github.io./categories/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/"/>
    
    
  </entry>
  
  <entry>
    <title>RepPoints论文笔记</title>
    <link href="http://chr10003566.github.io./2020/02/25/RepPoints%E8%AE%BA%E6%96%87%E7%AC%94%E8%AE%B0/"/>
    <id>http://chr10003566.github.io./2020/02/25/RepPoints论文笔记/</id>
    <published>2020-02-25T08:17:05.000Z</published>
    <updated>2020-02-28T12:09:59.010Z</updated>
    
    <content type="html">&lt;p&gt;论文：RepPoints: Point Set Representation for Object Detection&lt;br&gt;论文链接：&lt;a href=&quot;https://arxiv.org/pdf/1904.11490.pdf&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://arxiv.org/pdf/1904.11490.pdf&lt;/a&gt;&lt;br&gt;代码链接：&lt;a href=&quot;https://github.com/microsoft/RepPoints&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/microsoft/RepPoints&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;Preface&quot;&gt;&lt;a href=&quot;#Preface&quot; class=&quot;headerlink&quot; title=&quot;Preface&quot;&gt;&lt;/a&gt;Preface&lt;/h2&gt;&lt;p&gt; 该篇文章是由微软亚研院提出，可以看做是可形变卷积的第三版本，文章相比之前的文章更难理解一些，本人理解可能也有偏差，大家可以多搜索些资料，积极思考下，本文仅给出个人阅读的见解。下面是一些阅读资料。&lt;/p&gt;
&lt;p&gt; &lt;a href=&quot;https://www.zhihu.com/question/57493889&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;如何评价Deformable Conv&lt;/a&gt;&lt;br&gt; &lt;a href=&quot;https://www.zhihu.com/question/322372759/answer/798327725&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;如何评价RepPoints&lt;/a&gt;&lt;br&gt; 以及本文主要借鉴的一篇博客：&lt;br&gt; &lt;a href=&quot;https://zhuanlan.zhihu.com/p/64522910&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;陀飞轮—RepPoints：可形变卷积的进阶&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;Review-of-DCNv1-and-DCNv2&quot;&gt;&lt;a href=&quot;#Review-of-DCNv1-and-DCNv2&quot; class=&quot;headerlink&quot; title=&quot;Review of DCNv1 and DCNv2&quot;&gt;&lt;/a&gt;Review of DCNv1 and DCNv2&lt;/h2&gt;&lt;p&gt;由尺度、姿态、视角和部分形变等因素引起的几何变化是目标识别和检测的主要挑战。在卷积/RoI池化模块中，DCN通过学习采样点的位置来得到几何形变建模的能力。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://pic1.zhimg.com/80/v2-1436b85dcf4ff78eb1afe60c27b8820c_1440w.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;Deformable-Convolution&quot;&gt;&lt;a href=&quot;#Deformable-Convolution&quot; class=&quot;headerlink&quot; title=&quot;Deformable Convolution&quot;&gt;&lt;/a&gt;Deformable Convolution&lt;/h3&gt;&lt;p&gt;&lt;img src=&quot;https://pic2.zhimg.com/80/v2-6eacb5f7ab764e0a13c26ebb2414eba1_1440w.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;由输入特征学习得到的偏移量来改变标准卷积的采样位置。&lt;/p&gt;
&lt;p&gt;可形变卷积可以表示为：&lt;br&gt;&lt;img src=&quot;https://www.zhihu.com/equation?tex=y%28p%29%3D%5Csum_%7Bk%3D1%7D%5E%7BK%7D+w_%7Bk%7D+%5Ccdot+x%5Cleft%28p%2Bp_%7Bk%7D%2B%5CDelta+p_%7Bk%7D%5Cright%29%5C%5C&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;[具体的解释可见上述链接]&lt;/p&gt;
&lt;p&gt;PS：偏移量特征的分辨率与输入特征的分辨率相同，且通道数为采样点个数的两倍(即每个位置都有x和y两个方向的偏移量)。&lt;/p&gt;
&lt;h3 id=&quot;Modulated-Deformable-Convolution&quot;&gt;&lt;a href=&quot;#Modulated-Deformable-Convolution&quot; class=&quot;headerlink&quot; title=&quot;Modulated Deformable Convolution&quot;&gt;&lt;/a&gt;Modulated Deformable Convolution&lt;/h3&gt;&lt;p&gt;&lt;img src=&quot;https://pic3.zhimg.com/80/v2-5763a8a1b84c0a9ea1251847eeaffd62_1440w.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;相比可形变卷积多了一个调制因子。&lt;/p&gt;
&lt;p&gt;调制可形变卷积可以表示为：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://www.zhihu.com/equation?tex=y%28p%29%3D%5Csum_%7Bk%3D1%7D%5E%7BK%7D+w_%7Bk%7D+%5Ccdot+x%5Cleft%28p%2Bp_%7Bk%7D%2B%5CDelta+p_%7Bk%7D%5Cright%29+%5Ccdot+%5CDelta+m_%7Bk%7D%5C%5C&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;PS：调制因子特征的分辨率与输入特征的分辨率相同，且通道数为采样点的个数，加上偏移量特征后的通道数为采样点个数的三倍(即每个位置都有x和y两个方向的偏移量，还有一个调制因子)。&lt;/p&gt;
&lt;h3 id=&quot;Deformable-RoI-Pooling&quot;&gt;&lt;a href=&quot;#Deformable-RoI-Pooling&quot; class=&quot;headerlink&quot; title=&quot;Deformable RoI Pooling&quot;&gt;&lt;/a&gt;Deformable RoI Pooling&lt;/h3&gt;&lt;p&gt;&lt;img src=&quot;https://pic1.zhimg.com/80/v2-a0f767e67fbabf461d2abd479ba90da8_1440w.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;RepPoints&quot;&gt;&lt;a href=&quot;#RepPoints&quot; class=&quot;headerlink&quot; title=&quot;RepPoints&quot;&gt;&lt;/a&gt;RepPoints&lt;/h2&gt;&lt;h3 id=&quot;Motivation&quot;&gt;&lt;a href=&quot;#Motivation&quot; class=&quot;headerlink&quot; title=&quot;Motivation&quot;&gt;&lt;/a&gt;Motivation&lt;/h3&gt;&lt;p&gt;在目标检测任务中，边界框描述了目标检测器各阶段的目标位置。&lt;/p&gt;
&lt;p&gt;虽然边界框便于计算，但它们仅提供目标的粗略定位，并不完全拟合目标的形状和姿态。因此，从边界框的规则单元格中提取的特征可能会受到背景内容或前景区域的无效信息的严重影响。这可能导致特征质量降低，从而降低了目标检测的分类性能。&lt;/p&gt;
&lt;p&gt;本文提出一种新的表示方法，称为 RepPoints，它提供了更细粒度的定位和更方便的分类。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://pic1.zhimg.com/80/v2-90b287d33671ba1544fa99950f6b9058_1440w.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;如图所示，RepPoints 是一组点，通过学习自适应地将自己置于目标之上，该方式限定了目标的空间范围，并且表示具有重要语义信息的局部区域。&lt;/p&gt;
&lt;p&gt;RepPoints 的训练由目标定位和识别共同驱动的，因此，RepPoints 与 ground-truth 的边界框紧密相关，并引导检测器正确地分类目标。&lt;/p&gt;
&lt;h3 id=&quot;Bounding-Box-Representation&quot;&gt;&lt;a href=&quot;#Bounding-Box-Representation&quot; class=&quot;headerlink&quot; title=&quot;Bounding Box Representation&quot;&gt;&lt;/a&gt;Bounding Box Representation&lt;/h3&gt;&lt;p&gt;边界框是一个4维表示，编码目标的空间位置，即&lt;img src=&quot;https://www.zhihu.com/equation?tex=%5Cmathcal%7BB%7D%3D%28x%2C+y%2C+w%2C+h%29&quot; alt=&quot;&quot;&gt; ， &lt;img src=&quot;https://www.zhihu.com/equation?tex=x%2C+y&quot; alt=&quot;&quot;&gt;表示中心点， &lt;img src=&quot;https://www.zhihu.com/equation?tex=w%2C+h&quot; alt=&quot;&quot;&gt;表示宽度和高度。&lt;/p&gt;
&lt;p&gt;由于其使用简单方便，现代目标检测器严重依赖于边界框来表示检测 pipeline 中各个阶段的对象。&lt;/p&gt;
&lt;p&gt;性能最优的目标检测器通常遵循一个 multi-stage 的识别范式，其中目标定位是逐步细化的。其中，目标表示的角色如下：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://pic4.zhimg.com/80/v2-e7d1addcb3d0c80813d18c0455972ad3_1440w.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;论文：RepPoints: Point Set Representation for Object Detection&lt;br&gt;论文链接：&lt;a href=&quot;https://arxiv.org/pdf/1904.11490.pdf&quot; target=&quot;_blank&quot; rel=&quot;e
    
    </summary>
    
      <category term="论文阅读" scheme="http://chr10003566.github.io./categories/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/"/>
    
    
  </entry>
  
  <entry>
    <title>ExtremeNet论文笔记</title>
    <link href="http://chr10003566.github.io./2020/02/20/ExtremeNet%E8%AE%BA%E6%96%87%E7%AC%94%E8%AE%B0/"/>
    <id>http://chr10003566.github.io./2020/02/20/ExtremeNet论文笔记/</id>
    <published>2020-02-20T04:03:42.000Z</published>
    <updated>2020-02-20T08:11:27.481Z</updated>
    
    <content type="html">&lt;p&gt;论文：Bottom-up Object Detection by Grouping Extreme and Center Points&lt;br&gt;论文链接：&lt;a href=&quot;https://arxiv.org/abs/1901.08043&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://arxiv.org/abs/1901.08043&lt;/a&gt;&lt;br&gt;代码链接：&lt;a href=&quot;https://github.com/xingyizhou/ExtremeNet&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/xingyizhou/ExtremeNet&lt;/a&gt;.&lt;/p&gt;
&lt;h1 id=&quot;Preface&quot;&gt;&lt;a href=&quot;#Preface&quot; class=&quot;headerlink&quot; title=&quot;Preface&quot;&gt;&lt;/a&gt;Preface&lt;/h1&gt;&lt;p&gt;本篇文章与上一篇文章Objects as points是同一个第一作者，查阅了下作者的主页&lt;a href=&quot;https://www.cs.utexas.edu/~zhouxy/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Xingyi Zhou主页&lt;/a&gt;，发现作者主要是做关键点检测，正巧将其使用在目标检测上。本篇文章被CVPR 2019收录了，同样是Anchor free系列中的文章，也同样是关键点检测转到目标检测当中！&lt;/p&gt;
&lt;p&gt;#Introduction&lt;br&gt;文章作者提到自上而下的检测器—基于Anchor based的检测器存在以下问题：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;矩形框不是自然对象的表示，大多数的物体不是轴对齐的框&lt;/li&gt;
&lt;li&gt;基于Anchor based的检测器需要枚举大量的矩形框，而这些候选框并不是真正理解了物体本身构成的视觉语法&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;本文还与CornerNet做了比较，主要有两点不同：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;角点，往往在物体的外面，没有明显的外观特点。而极点，则位于物体上，有一致的局部外观特征。&lt;/li&gt;
&lt;li&gt;CornerNet是基于几何重组，即通过计算角点的嵌入向量的距离，来判断两个角点是否属于同一个矩形框，而ExtremeNet则是通过四个极点+一个中心点来构建矩形框的，四个极点和中心点都包含外观特征。&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;Method&quot;&gt;&lt;a href=&quot;#Method&quot; class=&quot;headerlink&quot; title=&quot;Method&quot;&gt;&lt;/a&gt;Method&lt;/h1&gt;&lt;p&gt;&lt;img src=&quot;https://pic.downk.cc/item/5e4e297148b86553eed44aa6.png&quot; alt=&quot;&quot;&gt;&lt;br&gt;上图是ExtremeNet的整体框架图，可以看到输入一张图像后，通过沙漏网络最后会得到4个C x H x W的Heatmap（极上点，极左点，极下点，极右点），以及1个C x h x w的Heatmap（中心点），还有4个极点的偏移值（2 x H x W）。如何通过4个极点确定一个候选框呢？作者借鉴了&lt;a href=&quot;https://arxiv.org/abs/1708.02750&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Extreme clicking for efficient object annotation&lt;/a&gt;，即若4个极点的坐标为(x(t), y(t)), (x(l), y(l)), (x(b), y(b)), (x(r), y(r))，则中心点的坐标为(x(l)+x(r)/2,y(t)+y(b)/2)，如何通过Heatmap确定极点的呢？作者通过一个3 x 3的滑动窗口，找到一个Peak，它的值比相邻的关键点都大，并且比设定的阈值也更大。因此确定了极点。4个极点的分类损失和偏移值的使用均和CornerNet相一致，中心点的Heatmap目的则是为了减少误检，用于四个极点固定好后，可以计算得到候选框的中心点坐标（下采样后的），如果计算得到的中心点在中心点的Heatmap的值大于设定的阈值，则保留该候选框。下图则展示了其具体的流程～&lt;br&gt;&lt;img src=&quot;https://pic.downk.cc/item/5e4e347e48b86553eed69439.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;作者针对一些特殊情况，做了一些改进，如当三个objects并排的时候，可能会出现最左边的极点和最右边的极点与最上、最下的极点同样构成一个候选框，也就是如下图的情况。&lt;br&gt;&lt;img src=&quot;https://pic2.zhimg.com/80/v2-6ba5861194a662374d321158df519ba1_hd.jpg&quot; alt=&quot;&quot;&gt;&lt;br&gt;蓝色代表真实目标，红色虚线代表被误检的框。如果出现这种情况，即一个框内所有框的置信度分数之和超过该框的3倍，则将该框的置信度除以2&lt;/p&gt;
&lt;p&gt;由于极点的定义不是固定的，如果目标物边界边缘构成极点，则该边的任意一个点都可以看作是极点。因此，本文对目标物的对齐边界产生一个较弱的相应，而不是强峰值响应。但这种弱相应存在两个问题：第一：较弱的相应其值可能会低于峰值阈值，因此该极点可能会被忽略。第二：即使检测到了一个极点，其分数仍可能会比具有强响应的旋转对象的分数低。本文采用edge aggregation解决上述问题。&lt;/p&gt;
&lt;p&gt;对于提取出局部最大点的极点，将其水平方向及垂直方向极点的分数进行聚合。将所有分数单调递减的极点进行聚合。当在聚合方向达到局部最小值的时候停止聚合。&lt;br&gt;&lt;img src=&quot;https://pic.downk.cc/item/5e4e3e8e48b86553eed8b0e3.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;Experiment&quot;&gt;&lt;a href=&quot;#Experiment&quot; class=&quot;headerlink&quot; title=&quot;Experiment&quot;&gt;&lt;/a&gt;Experiment&lt;/h1&gt;&lt;p&gt;&lt;img src=&quot;https://pic.downk.cc/item/5e4e3ed448b86553eed8bd67.png&quot; alt=&quot;&quot;&gt;&lt;br&gt;并未给出速度上的实验，不过从实验效果看，可以看到Center heatmap和group确实可以在CornerNet上得到提升。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;论文：Bottom-up Object Detection by Grouping Extreme and Center Points&lt;br&gt;论文链接：&lt;a href=&quot;https://arxiv.org/abs/1901.08043&quot; target=&quot;_blank&quot; re
    
    </summary>
    
      <category term="论文阅读" scheme="http://chr10003566.github.io./categories/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/"/>
    
    
  </entry>
  
  <entry>
    <title>CenterNet论文笔记-Objects as points</title>
    <link href="http://chr10003566.github.io./2020/02/19/CenterNet%E8%AE%BA%E6%96%87%E7%AC%94%E8%AE%B0-Objects-as-points/"/>
    <id>http://chr10003566.github.io./2020/02/19/CenterNet论文笔记-Objects-as-points/</id>
    <published>2020-02-19T07:21:19.000Z</published>
    <updated>2020-02-19T11:28:20.198Z</updated>
    
    <content type="html">&lt;p&gt;论文：Objects as points&lt;br&gt;论文链接：&lt;a href=&quot;https://arxiv.org/abs/1904.07850&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://arxiv.org/abs/1904.07850&lt;/a&gt;&lt;br&gt;代码链接：&lt;a href=&quot;https://github.com/xingyizhou/CenterNet&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/xingyizhou/CenterNet&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&quot;Preface&quot;&gt;&lt;a href=&quot;#Preface&quot; class=&quot;headerlink&quot; title=&quot;Preface&quot;&gt;&lt;/a&gt;Preface&lt;/h1&gt;&lt;p&gt;这篇文章（Objects as points）同样构建的模型同样也叫CenterNet，一个研究团队是来自德克萨斯州大学的学生，另一篇则是来自国科大和华为诺亚实验室。两篇共同点都是基于CornerNet的框架，对其做了一定程度的改进，但改进方向不相同，本篇CenterNet主要是借鉴了CornerNet从关键点检转到目标检测的方法，而华为诺亚实验室的CenterNet则主要是找到了CornerNet存在未利用到物体内部特征，无法感知内部信息的缺点，对该缺点做了改进。简单介绍了两篇CenterNet，现在着重介绍下本篇CenterNet吧。&lt;/p&gt;
&lt;h1 id=&quot;Introduction&quot;&gt;&lt;a href=&quot;#Introduction&quot; class=&quot;headerlink&quot; title=&quot;Introduction&quot;&gt;&lt;/a&gt;Introduction&lt;/h1&gt;&lt;p&gt;在本文中，作者很专业地指出了one stage approach和two stage approach的区别&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;One stage approach: 在图像上滑动复杂排列的可能bbox（即锚点）,然后直接对框进行分类，而不会利用到物体内部特征，无法感知内部信息。&lt;/p&gt;
&lt;p&gt;Two stage approach:对每个潜在框会重新计算图像特征，然后将那些特征进行分类。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;并且作者认为后处理，即 NMS（非极大值抑制），通过计算Bbox间的IOU来删除同个目标的重复检测框。这种后处理很难区分和训练，因此现有大多检测器都不是端到端可训练的。&lt;/p&gt;
&lt;p&gt;作者将自己的方法CenterNet与one stage approach做了详细的对比，认为主要存在以下三点区别&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;由于本文的CenterNet没有设置Anchor，而是通过关键点，因此不用设置阈值来区分前后景&lt;/p&gt;
&lt;p&gt;同样也是由于Anchor Free的原因，不需要使用NMS。&lt;/p&gt;
&lt;p&gt;CenterNet与之前目标检测框架比起来，使用了更大的特征图，仅仅只缩放了4倍，而此前的目标检测框架往往缩放8，16，32倍等。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;https://pic.downk.cc/item/5e4d131448b86553ee9df3e3.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;可以看到算法在效果和效率之间能取得很好的平衡！&lt;/p&gt;
&lt;h1 id=&quot;Method&quot;&gt;&lt;a href=&quot;#Method&quot; class=&quot;headerlink&quot; title=&quot;Method&quot;&gt;&lt;/a&gt;Method&lt;/h1&gt;&lt;p&gt;这里主要和CornerNet做一个对比，来详细的了解一下CenterNet所做的创新（个人感觉相比于华为诺亚实验室提高5%的创新点，本文稍显简单）此处借鉴：&lt;a href=&quot;本文链接：https://blog.csdn.net/u014380165/article/details/92801206&quot;&gt;AI之路-CenterNet笔记&lt;/a&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;CenterNet与CornerNet相同，都是采用&lt;strong&gt;Heatmap来进行预测&lt;/strong&gt;，所不同的是CenterNet预测的是中心点，而CornerNet则预测的是左上角点和右下角点，CenterNet在关键点的处理上是借鉴CornerNet的，&lt;strong&gt;引入了预测点的高斯分布区域计算真实预测值&lt;/strong&gt;，对该点不是很理解的同学，可以阅读&lt;a href=&quot;https://zhuanlan.zhihu.com/p/66048276&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;CenterNet——Objects as Points论文解读&lt;/a&gt;，引用一张图来简单说明一下。&lt;img src=&quot;https://pic2.zhimg.com/80/v2-82171546bc2b8448d45dd6915c40d375_hd.png&quot; alt=&quot;高斯分布&quot;&gt;即真实object中心点处Heatmap的值为1，而靠近中心点的值不完全设置为0，而是呈高斯分布逐渐减小。在损失函数的设计上，CenterNet同样借鉴了CornerNet，将Focal loss融合进自己中心点检测的损失函数，在上面的链接中非常详细的解释了该损失函数的原理。&lt;/li&gt;
&lt;li&gt;CenterNet和CornerNet同样使用了offset来对下采样导致的坐标误差进行微调，但是CornerNet使用的是在坐标误差中多次被应用的Smooth L1 loss，而CenterNet则使用的是L1 loss。其实这个offset是可选的，并非一定要使用，只是使用的话效果会有所下降（做比赛，刷榜的时候可以考虑的策略）&lt;/li&gt;
&lt;li&gt;CornerNet是通过组合左上角点和右上角点来组成候选框的，那么CenterNet如何通过中心点来获得候选框呢？CenterNet则是使用暴力法，直接通过回归得到候选框的宽和高，同样宽、高的损失函数同样是L1 loss，因此其整体的损失函数由3部分组成，第一部分是中心点分类的损失，第二部分是尺寸（宽、高）的损失，第三部分则是中心点偏移点的损失&lt;br&gt;&lt;img src=&quot;https://pic.downk.cc/item/5e4d168148b86553ee9f10b0.png&quot; alt=&quot;&quot;&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;因此可以推测出（论文竟然没给框架图），CenterNet预测得到三种Heatmap，第一种中心点分类：[1,C（类别数）,128,128]、[1,2（宽、高）,128,128]、[1,2（偏移量）,128,128]。&lt;br&gt;&lt;img src=&quot;https://pic.downk.cc/item/5e4d17ad48b86553ee9f79d4.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;Experiment&quot;&gt;&lt;a href=&quot;#Experiment&quot; class=&quot;headerlink&quot; title=&quot;Experiment&quot;&gt;&lt;/a&gt;Experiment&lt;/h1&gt;&lt;p&gt;&lt;img src=&quot;https://pic.downk.cc/item/5e4d1b0148b86553eea08cb6.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;可以看到与大部分检测相比，CenterNet的FPS几乎碾压，准确率也能保持在中上的水平。&lt;/p&gt;
&lt;h1 id=&quot;Note&quot;&gt;&lt;a href=&quot;#Note&quot; class=&quot;headerlink&quot; title=&quot;Note&quot;&gt;&lt;/a&gt;Note&lt;/h1&gt;&lt;p&gt;本文CenterNet在检测的时间和效果上做到了比较好的权衡，虽然算法也相对简单，但能将同一个框架应用到不同的领域，是十分棒的一个模型！&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;论文：Objects as points&lt;br&gt;论文链接：&lt;a href=&quot;https://arxiv.org/abs/1904.07850&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://arxiv.org/abs/1904.07850&lt;/
    
    </summary>
    
      <category term="论文阅读" scheme="http://chr10003566.github.io./categories/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/"/>
    
    
  </entry>
  
  <entry>
    <title>CenterNet论文笔记.md</title>
    <link href="http://chr10003566.github.io./2020/02/16/CenterNet%E8%AE%BA%E6%96%87%E7%AC%94%E8%AE%B0/"/>
    <id>http://chr10003566.github.io./2020/02/16/CenterNet论文笔记/</id>
    <published>2020-02-16T04:14:49.000Z</published>
    <updated>2020-02-16T08:31:01.824Z</updated>
    
    <content type="html">&lt;p&gt;论文：CenterNet: Keypoint Triplets for Object Detection&lt;br&gt;论文链接：&lt;a href=&quot;https://arxiv.org/abs/1904.08189&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://arxiv.org/abs/1904.08189&lt;/a&gt;&lt;br&gt;代码链接：&lt;a href=&quot;https://github.com/Duankaiwen/CenterNet&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/Duankaiwen/CenterNet&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;今天介绍一篇很好的 one-stage 目标检测论文：CenterNet: Keypoint Triplets for Object Detection，该论文是由 中科院，牛津大学以及华为诺亚方舟实验室联合提出。截至目前，据我们所知，CenterNet 应该是 one-stage 目标检测方法中性能最好的方法。&lt;/p&gt;
&lt;p&gt;《CenterNet: Keypoint Triplets for Object Detection》&lt;/p&gt;
&lt;p&gt;作者团队：中科院，牛津大学，华为诺亚方舟实验室&lt;/p&gt;
&lt;h2 id=&quot;Introduction&quot;&gt;&lt;a href=&quot;#Introduction&quot; class=&quot;headerlink&quot; title=&quot;Introduction&quot;&gt;&lt;/a&gt;Introduction&lt;/h2&gt;&lt;p&gt;基于关键点的目标检测方法例如最具代表性的CornerNet，通过检测物体的左上角点和右下角点来确定目标，但在确定目标的过程中，无法有效利用物体的内部的特征，即无法感知物体内部的信息，从而导致该类方法产生了很多误检 (错误目标框)。本文利用关键点三元组即中心点、左上角点和右下角点三个关键点而不是两个点来确定一个目标，使网络花费了很小的代价便具备了感知物体内部信息的能力，从而能有效抑制误检。另外，为了更好的检测中心点和角点，我们分别提出了 center pooling 和 cascade corner pooling 来提取中心点和角点的特征。我们方法的名字叫 CenterNet，是一种 one-stage 的方法，在最具挑战性之一的数据集 MS COCO [2] 上，获得了47% AP，超过了所有已知的 one-stage 检测方 法，并大幅度领先，其领先幅度至少达 4.9%。&lt;/p&gt;
&lt;h2 id=&quot;Basis&quot;&gt;&lt;a href=&quot;#Basis&quot; class=&quot;headerlink&quot; title=&quot;Basis&quot;&gt;&lt;/a&gt;Basis&lt;/h2&gt;&lt;p&gt;我们抑制误检的原理基于以下推论：如果目标框是准确的，那么在其中心区域能够检测到目标中心点的概率就会很高，反之亦然。因此，首先利用左上和右下两个角点生成初始目标框，对每个预测框定义一个中心区域，然后判断每个目标框的中心区域是否含有中心点，若有则保留该目标框，若无则删除该目标框，其原理如图1所。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://pic1.zhimg.com/80/v2-8a8af5135e730d0b77f9303fc9c25a98_hd.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;Baseline-and-Motivation&quot;&gt;&lt;a href=&quot;#Baseline-and-Motivation&quot; class=&quot;headerlink&quot; title=&quot;Baseline and Motivation&quot;&gt;&lt;/a&gt;Baseline and Motivation&lt;/h2&gt;&lt;p&gt;其实不光是基于关键点的 one-stage 方法无法感知物体内部信息，几乎所有的 one-stage 方法都存在这一问题。本论文的 baseline 为 CornerNet，因此首先讨论 CornerNet 为什么容易产生很多的误检。首先，CornerNet 通过检测角点确定目标，而不是通过初始候选框 anchor 的回归确定目标，由于没有了 anchor 的限制，使得任意两个角点都可以组成一个目标框，这就对判断两个角点是否属于同一物体的算法要求很高，一但准确度差一点，就会产生很多错误目标框。其次，恰恰这个算法有缺陷。因为此算法在判断两个角点是否属于同一物体时，缺乏全局信息的辅助，因此很容易把原本不是同一物体的两个角点看成是一对角点，因此产生了很多错误目标框。最后，角点的特征对边缘比较敏感，这导致很多角点同样对背景的边缘很敏感，因此在背景处也检测到了错误的角点。综上原因，使得 CornerNet 产生了很多误检。如图2所示，我们用 CornerNet 对两张图片进行检测，根据每个预测目标框的 confidence 选出 top100 个预测框 (根据 MS COCO 标准)，左图只显示了中等尺度和大尺度的预测框，右图只显示了小尺度的预测框，可以发现产生了很多误检。其中蓝色框为 ground truth, 红色框为预测框。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://pic1.zhimg.com/80/v2-da0900ab5cda899f71efaf3ce605d6c0_hd.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;其实不光 CornerNet 有这个问题，实际上 anchor-based one-stage detector 也存在这个问题，因为此类方法直接对 anchor 进行回归和分类，这个过程并没有像 two-stage 方法一样利用到了物体内部特征，因此无法感知物体内部信息，就会和 CornerNet 一样产生很多误检。下面是我用 SSD512 检测了两张图片，显示了 top100 个检测框，出现了和 CornerNet 类似的问题。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://pic2.zhimg.com/80/v2-c6529f46061695068e4c05bcc7411de9_hd.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;为了能够量化的分析误检问题，我们提出了一种新的衡量指标，称为FD (false discovery) rate, 此指标能够很直观的反映出误检情况。FD rate 的计算方式为 FD = 1-AP， 其中 AP 为 IoU 阈值取[0.05 : 0.05 : 0.5]下的平均精度。我们统计了 CornerNet 的误检情况，如表1所示：&lt;br&gt;&lt;img src=&quot;https://pic4.zhimg.com/80/v2-e6a1b19435c160e48a298e6d9bd7bf63_hd.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;可以看到，FD = 37.8，而 [公式] 高达32.7，这意味着即使我们把条件限制的很严格：只有那些与 ground-truth 的 IoU&amp;lt; 0.05 的才被认定为错误目标框，每100个预测框中仍然平均有32.7 个错误目标框！而小尺度的目标框其FD更是达到了60.3！&lt;/p&gt;
&lt;p&gt;我们分析出了 CornerNet 的问题后，接下来就是找出解决之道，关键问题在于让网络具备感知物体内部信息的能力。一个较容易想到的方法是把 CornerNet 变成一个 two-stage 的方法，即利用 RoI pooling 或 RoI align 提取预测框的内部信息，从而获得感知能力。但这样做开销很大，因此我们提出了用关键点三元组来检测目标，这样使得我们的方法在 one-stage 的前提下就能获得感知物体内部信息的能力。并且开销较小，因为我们只需关注物体的中心，从而避免了 RoI pooling 或 RoI align 关注物体内部的全部信息。&lt;/p&gt;
&lt;h2 id=&quot;Method&quot;&gt;&lt;a href=&quot;#Method&quot; class=&quot;headerlink&quot; title=&quot;Method&quot;&gt;&lt;/a&gt;Method&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Structure &lt;/strong&gt;&lt;br&gt;&lt;img src=&quot;https://pic2.zhimg.com/80/v2-bbea0d67bb5dbcdf6fd16141ed229071_hd.jpg&quot; alt=&quot;&quot;&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;上图为 CenterNet 的结构图。网络通过 center pooling 和 cascade corner pooling 分别得到 center heatmap 和 corner heatmaps，用来预测关键点的位置。得到角点的位置和类别后，通过 offsets 将角点的位置映射到输入图片的对应位置，然后通过 embedings 判断哪两个角点属于同一个物体，以便组成一个检测框。正如前文所说，组合过程中由于缺乏来自目标区域内部信息的辅助，从而导致大量的误检。为了解决这一问题，CenterNet 不仅预测角点，还预测中心点。我们对每个预测框定义一个中心区域，通过判断每个目标框的中心区域是否含有中心点，若有则保留，并且此时框的 confidence 为中心点，左上角点和右下角点的confidence的平均，若无则去除，使得网络具备感知目标区域内部信息的能力，能够有效除错误的目标框。&lt;/p&gt;
&lt;p&gt;我们发现中心区域的尺度会影响错误框去除效果。中心区域过小导致很多准确的小尺度的目标也会被去除，而中心区域过大导致很多大尺度的错误目标框无法被去除，因此我们提出了尺度可调节的中心区域定义法 (公式1)。该方法可以在预测框的尺度较大时定义一个相对较小的中心区域，在预测框的尺度较小时预测一个相对较大的中心区域。如 Fig3 所示。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://pic1.zhimg.com/80/v2-13133a7cea3b9330f170d66bc1713a88_hd.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://pic1.zhimg.com/80/v2-a0418bc3fc012942b1b3bc533effba40_hd.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Center pooling&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Center pooling：一个物体的中心并不一定含有很强的，易于区分于其他类别的语义信息。例如，一个人的头部含有很强的，易于区分于其他类别的语义信息，但是其中心往往位于人的中部。我们提出了center pooling 来丰富中心点特征。图5为该方法原理，center pooling提取中心点水平方向和垂直方向的最大值并相加，以此给中心点提供所处位置以外的信息。这一操作使中心点有机会获得更易于区分于其他类别的语义信息。Center pooling 可通过不同方向上的 corner pooling 的组合实现。一个水平方向上的取最大值操作可由 left pooling 和 right pooling通过串联实现，同理，一个垂直方向上的取最大值操作可由 top pooling 和 bottom pooling通过串联实现，如图6所示。&lt;br&gt;&lt;img src=&quot;https://pic1.zhimg.com/80/v2-70b5a7db0ad2cfd1b668c671c94c6d9c_hd.jpg&quot; alt=&quot;&quot;&gt;&lt;br&gt;&lt;img src=&quot;https://pic3.zhimg.com/80/v2-6cb703e827176d3aefbfff599b54e09a_hd.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Cascade corner pooling:&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;一般情况下角点位于物体外部，所处位置并不含有关联物体的语义信息，这为角点的检测带来了困难。图7(a) 为传统做法，称为 corner pooling。它提取物体边界最大值并相加，该方法只能提供关联物体边缘语义信息，对于更加丰富的物体内部语义信息则很难提取到。图7(b)为cascade corner pooling 原理，它首先提取物体边界最大值，然后在边界最大值处继续向内部(图中沿虚线方向)提取提最大值，并与边界最大值相加，以此给角点特征提供更加丰富的关联物体语义信息。Cascade corner pooling 也可通过不同方向上的 corner pooling 的组合实现，如图8 所示，图8展示了cascade left corner pooling 原理。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://pic2.zhimg.com/80/v2-383c1b465125216eb6f6fe9fd6457d61_hd.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;原文链接：&lt;a href=&quot;https://zhuanlan.zhihu.com/p/62789701&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;CenterNet&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;论文：CenterNet: Keypoint Triplets for Object Detection&lt;br&gt;论文链接：&lt;a href=&quot;https://arxiv.org/abs/1904.08189&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ht
    
    </summary>
    
      <category term="论文阅读" scheme="http://chr10003566.github.io./categories/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/"/>
    
    
  </entry>
  
  <entry>
    <title>mmDetection源码分析（五）：Faster R-CNN模块解读（三）</title>
    <link href="http://chr10003566.github.io./2019/12/11/mmdetection(5)/"/>
    <id>http://chr10003566.github.io./2019/12/11/mmdetection(5)/</id>
    <published>2019-12-11T11:04:53.000Z</published>
    <updated>2019-12-11T11:06:02.489Z</updated>
    
    <content type="html"></content>
    
    <summary type="html">
    
    </summary>
    
      <category term="mmDetection源码分析" scheme="http://chr10003566.github.io./categories/mmDetection%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    
    
  </entry>
  
  <entry>
    <title>mmDetection源码分析（四）：Faster R-CNN模块解读（二）</title>
    <link href="http://chr10003566.github.io./2019/12/10/mmdetection(4)/"/>
    <id>http://chr10003566.github.io./2019/12/10/mmdetection(4)/</id>
    <published>2019-12-10T13:51:03.000Z</published>
    <updated>2019-12-11T10:58:30.665Z</updated>
    
    <content type="html">&lt;h1 id=&quot;Faster-R-CNN模块解读（二）-Backbone的构建&quot;&gt;&lt;a href=&quot;#Faster-R-CNN模块解读（二）-Backbone的构建&quot; class=&quot;headerlink&quot; title=&quot;Faster R-CNN模块解读（二） Backbone的构建&quot;&gt;&lt;/a&gt;Faster R-CNN模块解读（二） Backbone的构建&lt;/h1&gt;&lt;p&gt;上一篇博客介绍了检测器的构建，是通过&lt;code&gt;build_from_cfg(cfg.model, DETECTORS, dict(train_cfg=train_cfg, test_cfg=test_cfg))&lt;/code&gt;调用得到，而构建检测器时，必须要构建Backbone，在&lt;code&gt;TwoStageDetector&lt;/code&gt;类初始化时，就需要构建&lt;code&gt;self.backbone = builder.build_backbone(backbone)&lt;/code&gt;。而在&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;mmdetection/mmdet/models/builder.py&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(cfg, registry, default_args=None)&lt;/span&gt;:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; isinstance(cfg, list):&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        modules = [&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            build_from_cfg(cfg_, registry, default_args) &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; cfg_ &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; cfg&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; nn.Sequential(*modules)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; build_from_cfg(cfg, registry, default_args)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;build_backbone&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(cfg)&lt;/span&gt;:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; build(cfg, BACKBONES)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;可以看到同样是调用&lt;code&gt;build_from_cfg(cfg.model.backbone, BACKBONES, dict(train_cfg=train_cfg, test_cfg=test_cfg))&lt;/code&gt;来构建Backbone的。&lt;/p&gt;
&lt;p&gt;在&lt;strong&gt;&lt;em&gt;mmdetection/configs/faster_rcnn_r50_fpn_1x.py&lt;/em&gt;&lt;/strong&gt;中，backbone的字典参数如下：&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;backbone=dict(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        type=&lt;span class=&quot;string&quot;&gt;&#39;ResNet&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        depth=&lt;span class=&quot;number&quot;&gt;50&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        num_stages=&lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        out_indices=(&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        frozen_stages=&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        style=&lt;span class=&quot;string&quot;&gt;&#39;pytorch&#39;&lt;/span&gt;),&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;此处&lt;code&gt;type&lt;/code&gt;为ResNet，则将会去构造&lt;strong&gt;&lt;em&gt;mmdetection/mmdet/models/backbones/resnet.py&lt;/em&gt;&lt;/strong&gt;这个类。&lt;/p&gt;
&lt;p&gt;该类则是大名鼎鼎的ResNet，下面将会与&lt;a href=&quot;https://arxiv.org/abs/1512.03385&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ResNet论文&lt;/a&gt; 中的网络结构一起来学习ResNet的实现。主要介绍ResNet-18与ResNet-50。&lt;br&gt;&lt;img src=&quot;http://www.programmersought.com/images/768/3133597021d9210d2d924d3d9ec5d388.png&quot; alt=&quot;&quot;&gt; &lt;/p&gt;
&lt;p&gt;对网络结构不是很熟悉的同学，可能还要借助caffe的prototxt可视化一起，会有更深层的理解，也会对编写该代码的作者更加崇拜。&lt;/p&gt;
&lt;p&gt;ResNet-18 prototxt：&lt;a href=&quot;https://raw.githubusercontent.com/marvis/pytorch-caffe-darknet-convert/master/cfg/resnet-18.prototxt&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://raw.githubusercontent.com/marvis/pytorch-caffe-darknet-convert/master/cfg/resnet-18.prototxt&lt;/a&gt; &lt;/p&gt;
&lt;p&gt;可视化网页：&lt;br&gt;&lt;a href=&quot;https://ethereon.github.io/netscope/#/editor&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://ethereon.github.io/netscope/#/editor&lt;/a&gt; &lt;/p&gt;
&lt;p&gt;将prototxt复制进左边的输入框，shift+enter即可以看到可视化的网络结构。&lt;/p&gt;
&lt;p&gt;ResNet-50，何恺明大大已经可视化了：&lt;a href=&quot;http://ethereon.github.io/netscope/#/gist/db945b393d40bfa26006&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://ethereon.github.io/netscope/#/gist/db945b393d40bfa26006&lt;/a&gt; &lt;/p&gt;
&lt;p&gt;准备工作做好后，我们便正式开始学习Backbone（ResNet）的构建了。&lt;/p&gt;
&lt;p&gt;先跳过&lt;code&gt;BasicBlock&lt;/code&gt;，&lt;code&gt;Bottleneck&lt;/code&gt;这两个类，看&lt;code&gt;ResNet&lt;/code&gt;这个类。&lt;/p&gt;
&lt;p&gt;在&lt;code&gt;__init__&lt;/code&gt;函数之前，&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;arch_settings = &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;number&quot;&gt;18&lt;/span&gt;: (BasicBlock, (&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;)),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;number&quot;&gt;34&lt;/span&gt;: (BasicBlock, (&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;)),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;number&quot;&gt;50&lt;/span&gt;: (Bottleneck, (&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;)),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;number&quot;&gt;101&lt;/span&gt;: (Bottleneck, (&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;23&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;)),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;number&quot;&gt;152&lt;/span&gt;: (Bottleneck, (&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;8&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;36&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;代码中很清晰的将不同层数的ResNet的区别，以及不同层数的ResNet的配置都一一告知。&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;84&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;__init__&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(self,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;             depth,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;             num_stages=&lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;             strides=&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;)&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;             dilations=&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;)&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;             out_indices=&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;)&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;             style=&lt;span class=&quot;string&quot;&gt;&#39;pytorch&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;             frozen_stages=&lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;             conv_cfg=None,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;             norm_cfg=dict&lt;span class=&quot;params&quot;&gt;(type=&lt;span class=&quot;string&quot;&gt;&#39;BN&#39;&lt;/span&gt;, requires_grad=True)&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;             norm_eval=True,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;             dcn=None,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;             stage_with_dcn=&lt;span class=&quot;params&quot;&gt;(False, False, False, False)&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;             gcb=None,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;             stage_with_gcb=&lt;span class=&quot;params&quot;&gt;(False, False, False, False)&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;             gen_attention=None,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;             stage_with_gen_attention=&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;, &lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;, &lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;, &lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;)&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;             with_cp=False,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;             zero_init_residual=True)&lt;/span&gt;:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    super(ResNet, self).__init__()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; depth &lt;span class=&quot;keyword&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; self.arch_settings:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;raise&lt;/span&gt; KeyError(&lt;span class=&quot;string&quot;&gt;&#39;invalid depth &amp;#123;&amp;#125; for resnet&#39;&lt;/span&gt;.format(depth))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    self.depth = depth&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    self.num_stages = num_stages&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;assert&lt;/span&gt; num_stages &amp;gt;= &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;and&lt;/span&gt; num_stages &amp;lt;= &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    self.strides = strides&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    self.dilations = dilations&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;assert&lt;/span&gt; len(strides) == len(dilations) == num_stages&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    self.out_indices = out_indices&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;assert&lt;/span&gt; max(out_indices) &amp;lt; num_stages&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    self.style = style&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    self.frozen_stages = frozen_stages&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    self.conv_cfg = conv_cfg&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    self.norm_cfg = norm_cfg&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    self.with_cp = with_cp&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    self.norm_eval = norm_eval&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    self.dcn = dcn&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    self.stage_with_dcn = stage_with_dcn&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; dcn &lt;span class=&quot;keyword&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;None&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;assert&lt;/span&gt; len(stage_with_dcn) == num_stages&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    self.gen_attention = gen_attention&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    self.gcb = gcb&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    self.stage_with_gcb = stage_with_gcb&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; gcb &lt;span class=&quot;keyword&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;None&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;assert&lt;/span&gt; len(stage_with_gcb) == num_stages&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    self.zero_init_residual = zero_init_residual&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    self.block, stage_blocks = self.arch_settings[depth]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    self.stage_blocks = stage_blocks[:num_stages]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    self.inplanes = &lt;span class=&quot;number&quot;&gt;64&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    self._make_stem_layer()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    self.res_layers = []&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; i, num_blocks &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; enumerate(self.stage_blocks):&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        stride = strides[i]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        dilation = dilations[i]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        dcn = self.dcn &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; self.stage_with_dcn[i] &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;None&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        gcb = self.gcb &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; self.stage_with_gcb[i] &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;None&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        planes = &lt;span class=&quot;number&quot;&gt;64&lt;/span&gt; * &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;**i&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        res_layer = make_res_layer(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            self.block,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            self.inplanes,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            planes,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            num_blocks,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            stride=stride,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            dilation=dilation,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            style=self.style,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            with_cp=with_cp,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            conv_cfg=conv_cfg,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            norm_cfg=norm_cfg,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            dcn=dcn,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            gcb=gcb,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            gen_attention=gen_attention,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            gen_attention_blocks=stage_with_gen_attention[i])&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        self.inplanes = planes * self.block.expansion&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        layer_name = &lt;span class=&quot;string&quot;&gt;&#39;layer&amp;#123;&amp;#125;&#39;&lt;/span&gt;.format(i + &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        self.add_module(layer_name, res_layer)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        self.res_layers.append(layer_name)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    self._freeze_stages()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    self.feat_dim = self.block.expansion * &lt;span class=&quot;number&quot;&gt;64&lt;/span&gt; * &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;**(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        len(self.stage_blocks) - &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;从&lt;code&gt;__init__&lt;/code&gt;函数中，我们可以看到，首先是将一系列的卷积层的变量传递到该类当中，比如：&lt;code&gt;stride（步长）&lt;/code&gt;，&lt;code&gt;dilation（扩张率）&lt;/code&gt;等，之后调用&lt;code&gt;_make_stem_layer()&lt;/code&gt;。&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;_make_stem_layer&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(self)&lt;/span&gt;:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    self.conv1 = build_conv_layer(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        self.conv_cfg,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;number&quot;&gt;64&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        kernel_size=&lt;span class=&quot;number&quot;&gt;7&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        stride=&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        padding=&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        bias=&lt;span class=&quot;keyword&quot;&gt;False&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    self.norm1_name, norm1 = build_norm_layer(self.norm_cfg, &lt;span class=&quot;number&quot;&gt;64&lt;/span&gt;, postfix=&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    self.add_module(self.norm1_name, norm1)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    self.relu = nn.ReLU(inplace=&lt;span class=&quot;keyword&quot;&gt;True&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    self.maxpool = nn.MaxPool2d(kernel_size=&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;, stride=&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;, padding=&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;从这个类，我们可以看到定义了conv1是一个7x7、步长为2，padding为3，输入channel为3，输出的channel为64，之后再接BatchNorm层与ReLU层，最后接一个kernel_size为3，步长为2的maxPooling 层&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://pic2.superbed.cn/item/5df085e11f8f59f4d6db8aaf.jpg&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;&lt;img src=&quot;https://pic2.superbed.cn/item/5df085e11f8f59f4d6db8aaf&quot; alt=&quot;&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;可以看到与可视化的第一部分一致，经过conv1与maxPooling之后，Feature map的尺寸变成原来的1/4。&lt;/p&gt;
&lt;p&gt;之后便是一个循环，构造每个stage的卷积层。通过调用&lt;code&gt;make_res_layer&lt;/code&gt;，构造每个stage的卷积层。&lt;code&gt;make_res_layer&lt;/code&gt;有个参数&lt;code&gt;block&lt;/code&gt;，用于指定使用的是&lt;code&gt;BasicBlock&lt;/code&gt;还是&lt;code&gt;Bottleneck&lt;/code&gt;。通过&lt;code&gt;__init__&lt;/code&gt;中的&lt;br&gt;&lt;code&gt;self.block, stage_blocks = self.arch_settings[depth]&lt;/code&gt;设置，可以看到ResNet-18使用的是&lt;code&gt;BasicBlock&lt;/code&gt;，而ResNet-50使用的是&lt;code&gt;Bottleneck&lt;/code&gt;。两者的区别可以从图1不同层数的ResNet结构图看出，BasicBlock是堆叠了两个3x3的卷积核，&lt;code&gt;Bottleneck&lt;/code&gt;则是1x1-&amp;gt;3x3-&amp;gt;1x1。具体结构如下图：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://www.programmersought.com/images/562/306cffd755e3f5fa09876452a583b4ca.png&quot; alt=&quot;&quot;&gt; 通过代码，我们同样可以看出区别。&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;BasicBlock&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(nn.Module)&lt;/span&gt;:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    expansion = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        self.norm1_name, norm1 = build_norm_layer(norm_cfg, planes, postfix=&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        self.norm2_name, norm2 = build_norm_layer(norm_cfg, planes, postfix=&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        self.conv1 = build_conv_layer(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            conv_cfg,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            inplanes,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            planes,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            stride=stride,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            padding=dilation,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            dilation=dilation,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            bias=&lt;span class=&quot;keyword&quot;&gt;False&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        self.add_module(self.norm1_name, norm1)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        self.conv2 = build_conv_layer(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            conv_cfg, planes, planes, &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;, padding=&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, bias=&lt;span class=&quot;keyword&quot;&gt;False&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        self.add_module(self.norm2_name, norm2)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        self.relu = nn.ReLU(inplace=&lt;span class=&quot;keyword&quot;&gt;True&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        self.downsample = downsample&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        self.stride = stride&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        self.dilation = dilation&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;not&lt;/span&gt; with_cp&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;而&lt;code&gt;Bottleneck&lt;/code&gt;，此处的代码忽略了一些判断，dcn，gcb等。&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Bottleneck&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(nn.Module)&lt;/span&gt;:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    expansion = &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     self.conv1 = build_conv_layer(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            conv_cfg,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            inplanes,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            planes,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            kernel_size=&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            stride=self.conv1_stride,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            bias=&lt;span class=&quot;keyword&quot;&gt;False&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        self.add_module(self.norm1_name, norm1)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        fallback_on_stride = &lt;span class=&quot;keyword&quot;&gt;False&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        self.with_modulated_dcn = &lt;span class=&quot;keyword&quot;&gt;False&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; self.with_dcn:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            fallback_on_stride = dcn.get(&lt;span class=&quot;string&quot;&gt;&#39;fallback_on_stride&#39;&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;False&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            self.with_modulated_dcn = dcn.get(&lt;span class=&quot;string&quot;&gt;&#39;modulated&#39;&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;False&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;not&lt;/span&gt; self.with_dcn &lt;span class=&quot;keyword&quot;&gt;or&lt;/span&gt; fallback_on_stride:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            self.conv2 = build_conv_layer(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                conv_cfg,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                planes,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                planes,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                kernel_size=&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                stride=self.conv2_stride,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                padding=dilation,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                dilation=dilation,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                bias=&lt;span class=&quot;keyword&quot;&gt;False&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        self.conv3 = build_conv_layer(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            conv_cfg,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            planes,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            planes * self.expansion,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            kernel_size=&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            bias=&lt;span class=&quot;keyword&quot;&gt;False&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        self.add_module(self.norm3_name, norm3)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        self.relu = nn.ReLU(inplace=&lt;span class=&quot;keyword&quot;&gt;True&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        self.downsample = downsample&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;简单了解了下&lt;code&gt;BasicBlock&lt;/code&gt;和&lt;code&gt;Bottleneck&lt;/code&gt;之后，我们来看下&lt;code&gt;make_res_layer&lt;/code&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;make_res_layer&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(block,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                   inplanes,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                   planes,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                   blocks,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                   stride=&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                   dilation=&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                   style=&lt;span class=&quot;string&quot;&gt;&#39;pytorch&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                   with_cp=False,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                   conv_cfg=None,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                   norm_cfg=dict&lt;span class=&quot;params&quot;&gt;(type=&lt;span class=&quot;string&quot;&gt;&#39;BN&#39;&lt;/span&gt;)&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                   dcn=None,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                   gcb=None,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                   gen_attention=None,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                   gen_attention_blocks=[])&lt;/span&gt;:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    downsample = &lt;span class=&quot;keyword&quot;&gt;None&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; stride != &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;or&lt;/span&gt; inplanes != planes * block.expansion:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        downsample = nn.Sequential(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            build_conv_layer(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                conv_cfg,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                inplanes,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                planes * block.expansion,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                kernel_size=&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                stride=stride,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                bias=&lt;span class=&quot;keyword&quot;&gt;False&lt;/span&gt;),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            build_norm_layer(norm_cfg, planes * block.expansion)[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;],&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        )&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    layers = []&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    layers.append(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        block(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            inplanes=inplanes,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            planes=planes,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            stride=stride,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            dilation=dilation,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            downsample=downsample,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            style=style,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            with_cp=with_cp,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            conv_cfg=conv_cfg,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            norm_cfg=norm_cfg,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            dcn=dcn,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            gcb=gcb,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            gen_attention=gen_attention &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            (&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; gen_attention_blocks) &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;None&lt;/span&gt;))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    inplanes = planes * block.expansion&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; range(&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, blocks):&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        layers.append(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            block(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                inplanes=inplanes,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                planes=planes,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                stride=&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                dilation=dilation,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                style=style,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                with_cp=with_cp,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                conv_cfg=conv_cfg,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                norm_cfg=norm_cfg,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                dcn=dcn,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                gcb=gcb,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                gen_attention=gen_attention &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                (i &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; gen_attention_blocks) &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;None&lt;/span&gt;))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; nn.Sequential(*layers)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;可以看到若stride不等于1或者输入的Feature map的channel不等于64 × expansion（BasicBlock.expansion = 1，Bottleneck.expansion = 4），则downsample设置成1x1x（64 × expansion），在可视化部分如图所示，downsample便指的是这一块的卷积层。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://pic1.superbed.cn/item/5df0a40a1f8f59f4d6017ef0.jpg&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;&lt;img src=&quot;https://pic1.superbed.cn/item/5df0a40a1f8f59f4d6017ef0&quot; alt=&quot;&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;shortcut的操作（恒等映射）在&lt;code&gt;BasicBlock&lt;/code&gt;和&lt;code&gt;Bottleneck&lt;/code&gt;的&lt;code&gt;forward函数&lt;/code&gt;中。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;class BasicBlock(nn.Module):&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;forward&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(self, x)&lt;/span&gt;:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    identity = x&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    out = self.conv1(x)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    out = self.norm1(out)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    out = self.relu(out)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    out = self.conv2(out)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    out = self.norm2(out)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; self.downsample &lt;span class=&quot;keyword&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;None&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        identity = self.downsample(x)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    out += identity&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    out = self.relu(out)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; out&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;class Bottleneck(nn.Module):&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;forward&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(self, x)&lt;/span&gt;:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;_inner_forward&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(x)&lt;/span&gt;:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        identity = x&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        out = self.conv1(x)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        out = self.norm1(out)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        out = self.relu(out)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;not&lt;/span&gt; self.with_dcn:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            out = self.conv2(out)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;elif&lt;/span&gt; self.with_modulated_dcn:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            offset_mask = self.conv2_offset(out)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            offset = offset_mask[:, :&lt;span class=&quot;number&quot;&gt;18&lt;/span&gt;, :, :]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            mask = offset_mask[:, &lt;span class=&quot;number&quot;&gt;-9&lt;/span&gt;:, :, :].sigmoid()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            out = self.conv2(out, offset, mask)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            offset = self.conv2_offset(out)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            out = self.conv2(out, offset)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        out = self.norm2(out)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        out = self.relu(out)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; self.with_gen_attention:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            out = self.gen_attention_block(out)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        out = self.conv3(out)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        out = self.norm3(out)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; self.with_gcb:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            out = self.context_block(out)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; self.downsample &lt;span class=&quot;keyword&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;None&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            identity = self.downsample(x)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        out += identity&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; out&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; self.with_cp &lt;span class=&quot;keyword&quot;&gt;and&lt;/span&gt; x.requires_grad:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        out = cp.checkpoint(_inner_forward, x)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        out = _inner_forward(x)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    out = self.relu(out)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; out&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;需要注意的是在每个stage，只有第一次才会传入&lt;code&gt;downsample&lt;/code&gt;，之后是不传入的。这和ResNet的可视化结果一致。ResNet-50第一个stage也确实是堆叠了3个&lt;code&gt;Bottleneck&lt;/code&gt;，与代码中也一致。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://pic.superbed.cn/item/5df0a7771f8f59f4d6095d68.jpg&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;&lt;img src=&quot;https://pic.superbed.cn/item/5df0a7771f8f59f4d6095d68&quot; alt=&quot;&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;此外还需要说明的是在每个stage之后channel数会发生变化。&lt;/p&gt;
&lt;p&gt;另外，在&lt;code&gt;resnet.py&lt;/code&gt;中还有&lt;code&gt;init_weights&lt;/code&gt;，&lt;code&gt;forward&lt;/code&gt;，&lt;code&gt;train&lt;/code&gt;函数。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;code&gt;init_weights&lt;/code&gt;在&lt;code&gt;two_stage.py&lt;/code&gt;被调用，将预训练权重加载到backbone中。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;code&gt;forward&lt;/code&gt;函数则是在&lt;code&gt;two_stage.py&lt;/code&gt;中的&lt;code&gt;extract_feat(img)&lt;/code&gt;中通过&lt;code&gt;self.backbone(img)&lt;/code&gt;调用，这是因为ResNet类继承至nn.Module，而在nn.Module中实现了&lt;code&gt;__call__&lt;/code&gt;，在nn.Module的&lt;code&gt;__call__&lt;/code&gt;中&lt;code&gt;result = self.forward(*input, **kwargs)&lt;/code&gt;，因此可以通过&lt;code&gt;self.backbone(img)&lt;/code&gt;直接调用&lt;code&gt;self.backbone.forward(img)&lt;/code&gt;。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;在本篇博客中，我们详细介绍了mmDetection框架中backbone的构建，此处以ResNet为例，结合论文、caffe的prototxt的可视化和代码，一起讲述了ResNet网络的构建过程。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Faster-R-CNN模块解读（二）-Backbone的构建&quot;&gt;&lt;a href=&quot;#Faster-R-CNN模块解读（二）-Backbone的构建&quot; class=&quot;headerlink&quot; title=&quot;Faster R-CNN模块解读（二） Backbone的构
    
    </summary>
    
      <category term="mmDetection源码分析" scheme="http://chr10003566.github.io./categories/mmDetection%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    
    
  </entry>
  
  <entry>
    <title>mmDetection源码分析（三）：Faster R-CNN模块解读（一）</title>
    <link href="http://chr10003566.github.io./2019/12/10/mmdetection(3)/"/>
    <id>http://chr10003566.github.io./2019/12/10/mmdetection(3)/</id>
    <published>2019-12-10T11:09:14.000Z</published>
    <updated>2019-12-10T13:42:16.000Z</updated>
    
    <content type="html">&lt;h1 id=&quot;Faster-R-CNN模块解读（一）—-检测器的构建&quot;&gt;&lt;a href=&quot;#Faster-R-CNN模块解读（一）—-检测器的构建&quot; class=&quot;headerlink&quot; title=&quot;Faster R-CNN模块解读（一）— 检测器的构建&quot;&gt;&lt;/a&gt;Faster R-CNN模块解读（一）— 检测器的构建&lt;/h1&gt;&lt;p&gt;根据之前的介绍，config文件中的 &lt;code&gt;model&lt;/code&gt; 中的 &lt;code&gt;type&lt;/code&gt; 指定了检测器是一个Faster R-CNN检测器。&lt;/p&gt;
&lt;p&gt;我们知道要调用一个检测模型要用到函数&lt;code&gt;model = build_detector(cfg.model, train_cfg=cfg.train_cfg, test_cfg=cfg.test_cfg)&lt;/code&gt;。接下来，我们看看其是如何调用到Faster R-CNN模块的。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;mmdetection/configs/faster_rcnn_r50_fpn_1x.py&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;model = dict(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    type=&lt;span class=&quot;string&quot;&gt;&#39;FasterRCNN&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    pretrained=&lt;span class=&quot;string&quot;&gt;&#39;torchvision://resnet50&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    backbone=dict(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        type=&lt;span class=&quot;string&quot;&gt;&#39;ResNet&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        depth=&lt;span class=&quot;number&quot;&gt;50&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        num_stages=&lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        out_indices=(&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        frozen_stages=&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        style=&lt;span class=&quot;string&quot;&gt;&#39;pytorch&#39;&lt;/span&gt;),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    neck=dict(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        type=&lt;span class=&quot;string&quot;&gt;&#39;FPN&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        in_channels=[&lt;span class=&quot;number&quot;&gt;256&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;512&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1024&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;2048&lt;/span&gt;],&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        out_channels=&lt;span class=&quot;number&quot;&gt;256&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        num_outs=&lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    rpn_head=dict(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        type=&lt;span class=&quot;string&quot;&gt;&#39;RPNHead&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        in_channels=&lt;span class=&quot;number&quot;&gt;256&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        feat_channels=&lt;span class=&quot;number&quot;&gt;256&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        anchor_scales=[&lt;span class=&quot;number&quot;&gt;8&lt;/span&gt;],&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        anchor_ratios=[&lt;span class=&quot;number&quot;&gt;0.5&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1.0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;2.0&lt;/span&gt;],&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        anchor_strides=[&lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;8&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;16&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;32&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;64&lt;/span&gt;],&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        target_means=[&lt;span class=&quot;number&quot;&gt;.0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;.0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;.0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;.0&lt;/span&gt;],&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        target_stds=[&lt;span class=&quot;number&quot;&gt;1.0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1.0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1.0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1.0&lt;/span&gt;],&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        loss_cls=dict(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            type=&lt;span class=&quot;string&quot;&gt;&#39;CrossEntropyLoss&#39;&lt;/span&gt;, use_sigmoid=&lt;span class=&quot;keyword&quot;&gt;True&lt;/span&gt;, loss_weight=&lt;span class=&quot;number&quot;&gt;1.0&lt;/span&gt;),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        loss_bbox=dict(type=&lt;span class=&quot;string&quot;&gt;&#39;SmoothL1Loss&#39;&lt;/span&gt;, beta=&lt;span class=&quot;number&quot;&gt;1.0&lt;/span&gt; / &lt;span class=&quot;number&quot;&gt;9.0&lt;/span&gt;, loss_weight=&lt;span class=&quot;number&quot;&gt;1.0&lt;/span&gt;)),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    bbox_roi_extractor=dict(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        type=&lt;span class=&quot;string&quot;&gt;&#39;SingleRoIExtractor&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        roi_layer=dict(type=&lt;span class=&quot;string&quot;&gt;&#39;RoIAlign&#39;&lt;/span&gt;, out_size=&lt;span class=&quot;number&quot;&gt;7&lt;/span&gt;, sample_num=&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        out_channels=&lt;span class=&quot;number&quot;&gt;256&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        featmap_strides=[&lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;8&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;16&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;32&lt;/span&gt;]),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    bbox_head=dict(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        type=&lt;span class=&quot;string&quot;&gt;&#39;SharedFCBBoxHead&#39;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        num_fcs=&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        in_channels=&lt;span class=&quot;number&quot;&gt;256&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        fc_out_channels=&lt;span class=&quot;number&quot;&gt;1024&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        roi_feat_size=&lt;span class=&quot;number&quot;&gt;7&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        num_classes=&lt;span class=&quot;number&quot;&gt;81&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        target_means=[&lt;span class=&quot;number&quot;&gt;0.&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;0.&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;0.&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;0.&lt;/span&gt;],&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        target_stds=[&lt;span class=&quot;number&quot;&gt;0.1&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;0.1&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;0.2&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;0.2&lt;/span&gt;],&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        reg_class_agnostic=&lt;span class=&quot;keyword&quot;&gt;False&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        loss_cls=dict(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            type=&lt;span class=&quot;string&quot;&gt;&#39;CrossEntropyLoss&#39;&lt;/span&gt;, use_sigmoid=&lt;span class=&quot;keyword&quot;&gt;False&lt;/span&gt;, loss_weight=&lt;span class=&quot;number&quot;&gt;1.0&lt;/span&gt;),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        loss_bbox=dict(type=&lt;span class=&quot;string&quot;&gt;&#39;SmoothL1Loss&#39;&lt;/span&gt;, beta=&lt;span class=&quot;number&quot;&gt;1.0&lt;/span&gt;, loss_weight=&lt;span class=&quot;number&quot;&gt;1.0&lt;/span&gt;)))&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;mmdetection/mmdet/models/registry.py&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;BACKBONES = Registry(&lt;span class=&quot;string&quot;&gt;&#39;backbone&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NECKS = Registry(&lt;span class=&quot;string&quot;&gt;&#39;neck&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ROI_EXTRACTORS = Registry(&lt;span class=&quot;string&quot;&gt;&#39;roi_extractor&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SHARED_HEADS = Registry(&lt;span class=&quot;string&quot;&gt;&#39;shared_head&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;HEADS = Registry(&lt;span class=&quot;string&quot;&gt;&#39;head&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;LOSSES = Registry(&lt;span class=&quot;string&quot;&gt;&#39;loss&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;DETECTORS = Registry(&lt;span class=&quot;string&quot;&gt;&#39;detector&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;mmdetection/mmdet/models/builder.py&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(cfg, registry, default_args=None)&lt;/span&gt;:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; isinstance(cfg, list):&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        modules = [&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            build_from_cfg(cfg_, registry, default_args) &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; cfg_ &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; cfg&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; nn.Sequential(*modules)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; build_from_cfg(cfg, registry, default_args)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;build_detector&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(cfg, train_cfg=None, test_cfg=None)&lt;/span&gt;:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; build(cfg, DETECTORS, dict(train_cfg=train_cfg, test_cfg=test_cfg))&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;mmdetection/mmdet/utils/registry.py&lt;/em&gt;&lt;/strong&gt; &lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;build_from_cfg&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(cfg, registry, default_args=None)&lt;/span&gt;:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;string&quot;&gt;&quot;&quot;&quot;Build a module from config dict.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Args:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        cfg (dict): Config dict. It should at least contain the key &quot;type&quot;.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        registry (:obj:`Registry`): The registry to search the type from.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        default_args (dict, optional): Default initialization arguments.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Returns:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        obj: The constructed object.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &quot;&quot;&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;assert&lt;/span&gt; isinstance(cfg, dict) &lt;span class=&quot;keyword&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&#39;type&#39;&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; cfg&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;assert&lt;/span&gt; isinstance(default_args, dict) &lt;span class=&quot;keyword&quot;&gt;or&lt;/span&gt; default_args &lt;span class=&quot;keyword&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;None&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    args = cfg.copy()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    obj_type = args.pop(&lt;span class=&quot;string&quot;&gt;&#39;type&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; mmcv.is_str(obj_type):&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        obj_type = registry.get(obj_type)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; obj_type &lt;span class=&quot;keyword&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;None&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;raise&lt;/span&gt; KeyError(&lt;span class=&quot;string&quot;&gt;&#39;&amp;#123;&amp;#125; is not in the &amp;#123;&amp;#125; registry&#39;&lt;/span&gt;.format(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                obj_type, registry.name))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;elif&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;not&lt;/span&gt; inspect.isclass(obj_type):&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;raise&lt;/span&gt; TypeError(&lt;span class=&quot;string&quot;&gt;&#39;type must be a str or valid type, but got &amp;#123;&amp;#125;&#39;&lt;/span&gt;.format(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            type(obj_type)))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; default_args &lt;span class=&quot;keyword&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;None&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; name, value &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; default_args.items():&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            args.setdefault(name, value)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; obj_type(**args)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;通过&lt;code&gt;build_from_cfg&lt;/code&gt;返回了&lt;code&gt;cfg.model.type&lt;/code&gt;定义的类。registry指明了该类在&lt;strong&gt;&lt;em&gt;mmdetection/mmdet/models/detectors&lt;/em&gt;&lt;/strong&gt;中，查看文件&lt;code&gt;faster_rcnn.py&lt;/code&gt;(此处有其框架设计的问题，比如注册器的使用，在本系列中暂时不分析)&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;@DETECTORS.register_module&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;FasterRCNN&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(TwoStageDetector)&lt;/span&gt;:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;__init__&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(self,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                 backbone,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                 rpn_head,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                 bbox_roi_extractor,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                 bbox_head,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                 train_cfg,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                 test_cfg,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                 neck=None,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                 shared_head=None,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                 pretrained=None)&lt;/span&gt;:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        super(FasterRCNN, self).__init__(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            backbone=backbone,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            neck=neck,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            shared_head=shared_head,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            rpn_head=rpn_head,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            bbox_roi_extractor=bbox_roi_extractor,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            bbox_head=bbox_head,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            train_cfg=train_cfg,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            test_cfg=test_cfg,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            pretrained=pretrained)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;可以看到&lt;code&gt;FasterRCNN&lt;/code&gt;继承于&lt;code&gt;TwoStageDetector&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;mmdetection/mmdet/models/detectors/two_stage.py&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;@DETECTORS.register_module&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;TwoStageDetector&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(BaseDetector, RPNTestMixin, BBoxTestMixin,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                       MaskTestMixin)&lt;/span&gt;:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;__init__&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(self,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                 backbone,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                 neck=None,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                 shared_head=None,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                 rpn_head=None,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                 bbox_roi_extractor=None,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                 bbox_head=None,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                 mask_roi_extractor=None,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                 mask_head=None,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                 train_cfg=None,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                 test_cfg=None,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                 pretrained=None)&lt;/span&gt;:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        super(TwoStageDetector, self).__init__()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        self.backbone = builder.build_backbone(backbone)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; neck &lt;span class=&quot;keyword&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;None&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            self.neck = builder.build_neck(neck)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; shared_head &lt;span class=&quot;keyword&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;None&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            self.shared_head = builder.build_shared_head(shared_head)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; rpn_head &lt;span class=&quot;keyword&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;None&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            self.rpn_head = builder.build_head(rpn_head)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; bbox_head &lt;span class=&quot;keyword&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;None&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            self.bbox_roi_extractor = builder.build_roi_extractor(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                bbox_roi_extractor)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            self.bbox_head = builder.build_head(bbox_head)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; mask_head &lt;span class=&quot;keyword&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;None&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; mask_roi_extractor &lt;span class=&quot;keyword&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;None&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                self.mask_roi_extractor = builder.build_roi_extractor(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    mask_roi_extractor)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                self.share_roi_extractor = &lt;span class=&quot;keyword&quot;&gt;False&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                self.share_roi_extractor = &lt;span class=&quot;keyword&quot;&gt;True&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                self.mask_roi_extractor = self.bbox_roi_extractor&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            self.mask_head = builder.build_head(mask_head)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        self.train_cfg = train_cfg&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        self.test_cfg = test_cfg&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        self.init_weights(pretrained=pretrained)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;init_weights&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(self, pretrained=None)&lt;/span&gt;:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        super(TwoStageDetector, self).init_weights(pretrained)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        self.backbone.init_weights(pretrained=pretrained)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; self.with_neck:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; isinstance(self.neck, nn.Sequential):&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; m &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; self.neck:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    m.init_weights()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                self.neck.init_weights()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; self.with_shared_head:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            self.shared_head.init_weights(pretrained=pretrained)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; self.with_rpn:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            self.rpn_head.init_weights()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; self.with_bbox:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            self.bbox_roi_extractor.init_weights()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            self.bbox_head.init_weights()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; self.with_mask:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            self.mask_head.init_weights()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;not&lt;/span&gt; self.share_roi_extractor:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                self.mask_roi_extractor.init_weights()&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;可以看到通过&lt;code&gt;builder&lt;/code&gt;将检测器的backbone，neck，shared_head，bbox_head，mask_head等全部创建了。并通过&lt;code&gt;init_weights&lt;/code&gt;初始话权重，后续有：&lt;/p&gt;
&lt;p&gt;&lt;code&gt;extract_feat()&lt;/code&gt;&lt;br&gt;&lt;code&gt;forward_train()&lt;/code&gt;&lt;br&gt;&lt;code&gt;simple_test &amp;amp;&amp;amp; aug_test&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;下一篇blog将介绍Backbone的构建。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Faster-R-CNN模块解读（一）—-检测器的构建&quot;&gt;&lt;a href=&quot;#Faster-R-CNN模块解读（一）—-检测器的构建&quot; class=&quot;headerlink&quot; title=&quot;Faster R-CNN模块解读（一）— 检测器的构建&quot;&gt;&lt;/a&gt;Faste
    
    </summary>
    
      <category term="mmDetection源码分析" scheme="http://chr10003566.github.io./categories/mmDetection%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    
    
  </entry>
  
  <entry>
    <title>CornerNet- Detecting Objects as Paired Keypoints论文解读</title>
    <link href="http://chr10003566.github.io./2019/12/09/%E5%AD%A6%E4%B9%A0%20CornerNet-%20Detecting%20Objects%20as%20Paired%20Keypoints/"/>
    <id>http://chr10003566.github.io./2019/12/09/学习 CornerNet- Detecting Objects as Paired Keypoints/</id>
    <published>2019-12-09T13:25:14.000Z</published>
    <updated>2020-02-16T08:19:15.390Z</updated>
    
    <content type="html">&lt;h1 id=&quot;CornerNet-Detecting-Objects-as-Paired-Keypoints论文笔记&quot;&gt;&lt;a href=&quot;#CornerNet-Detecting-Objects-as-Paired-Keypoints论文笔记&quot; class=&quot;headerlink&quot; title=&quot;CornerNet- Detecting Objects as Paired Keypoints论文笔记&quot;&gt;&lt;/a&gt;CornerNet- Detecting Objects as Paired Keypoints论文笔记&lt;/h1&gt;&lt;p&gt;论文：CornerNet: Detecting Objects as Paired Keypoints&lt;br&gt;论文链接：&lt;a href=&quot;https://arxiv.org/abs/1808.01244&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://arxiv.org/abs/1808.01244&lt;/a&gt;&lt;br&gt;代码链接：&lt;a href=&quot;https://github.com/umich-vl/CornerNet&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/umich-vl/CornerNet&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;这篇发表在ECCV2018上的目标检测文章给人一种眼前一亮的感觉，简单说一下几个比较吸引我的点：1、将目标检测问题当作关键点检测问题来解决，也就是通过检测目标框的左上角和右下角两个关键点得到预测框，因此CornerNet算法中没有anchor的概念，这种做法在目标检测领域是比较创新的而且能够取得不错效果是很难的。2、整个检测网络的训练是从头开始的，并不基于预训练的分类模型，这使得用户能够自由设计特征提取网络，不用受预训练模型的限制。&lt;/p&gt;
&lt;p&gt;我们知道目前大部分常用的目标检测算法都是基于anchor的，比如Faster RCNN系列，SSD，YOLO（v2、v3）等，引入anchor后检测效果提升确实比较明显（比如YOLO v1和YOLO v2），但是引入anchor的缺点在于：1、正负样本不均衡。大部分检测算法的anchor数量都成千上万，但是一张图中的目标数量并没有那么多，这就导致正样本数量会远远小于负样本，因此有了对负样本做欠采样以及focal loss等算法来解决这个问题。2、引入更多的超参数，比如anchor的数量、大小和宽高比等。因此这篇不采用anchor却能有不错效果的CornerNet就省去了这几个额外的操作，确实是非常有意思的作品。&lt;/p&gt;
&lt;p&gt;CornerNet算法整体结构如Figure4所示。&lt;br&gt;&lt;img src=&quot;https://img-blog.csdn.net/20181012201602253?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTQzODAxNjU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70&quot; alt=&quot;&quot;&gt;&lt;br&gt;首先1个7×7的卷积层将输入图像尺寸缩小为原来的1/4（论文中输入图像大小是511×511，缩小后得到128×128大小的输出）。&lt;br&gt;然后经过特征提取网络（backbone network）提取特征，该网络采用hourglass network，该网络通过串联多个hourglass module组成（Figure4中的hourglass network由2个hourglass module组成），每个hourglass module都是先通过一系列的降采样操作缩小输入的大小，然后通过上采样恢复到输入图像大小，因此该部分的输出特征图大小还是128×128，整个hourglass network的深度是104层。&lt;br&gt;hourglass module后会有两个输出分支模块，分别表示左上角点预测分支和右下角点预测分支，每个分支模块包含一个corner pooling层和3个输出：heatmaps、embeddings和offsets。heatmaps是输出预测角点信息，可以用维度为CHW的特征图表示，其中C表示目标的类别（注意：没有背景类），这个特征图的每个通道都是一个mask，mask的每个值（范围为0到1，论文中写的该mask是binary mask，也就是0或1，个人感觉是笔误，预测值应该是0到1，否则后面公式1计算损失函数时就没有意思了）表示该点是角点的分数；embeddings用来对预测的corner点做group，也就是找到属于同一个目标的左上角角点和右下角角点；offsets用来对预测框做微调，这是因为从输入图像中的点映射到特征图时有量化误差，offsets就是用来输出这些误差信息。&lt;/p&gt;
&lt;p&gt;接下来分别看看这3个输出和corner pooling的含义。&lt;/p&gt;
&lt;p&gt;CornerNet的第一个输出是headmaps，也就是预测角点的位置。&lt;br&gt;公式1是针对角点预测（headmaps）的损失函数，整体上是改良版的focal loss。几个参数的含义：pcij表示预测的heatmaps在第c个通道（类别c）的(i,j)位置的值，ycij表示对应位置的ground truth，N表示目标的数量。ycij=1时候的损失函数容易理解，就是focal loss，α参数用来控制难易分类样本的损失权重；ycij等于其他值时表示(i,j)点不是类别c的目标角点，照理说此时ycij应该是0（大部分算法都是这样处理的），但是这里ycij不是0，而是用基于ground truth角点的高斯分布计算得到，因此距离ground truth比较近的(i,j)点的ycij值接近1，这部分通过β参数控制权重，这是和focal loss的差别。为什么对不同的负样本点用不同权重的损失函数呢？这是因为靠近ground truth的误检角点组成的预测框仍会和ground truth有较大的重叠面积，如Figure5所示。&lt;br&gt;&lt;img src=&quot;https://img-blog.csdn.net/20181012201637309?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTQzODAxNjU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;Figure5是关于对不同负样本点的损失函数采取不同权重值的原因。红色实线框是ground truth；橘色圆圈是根据ground truth的左上角角点、右下角角点和设定的半径值画出来的，半径是根据圆圈内的角点组成的框和ground truth的IOU值大于0.7而设定的，圆圈内的点的数值是以圆心往外呈二维的高斯分布；白色虚线是一个预测框，可以看出这个预测框的两个角点和ground truth并不重合，但是该预测框基本框住了目标，因此是有用的预测框，所以要有一定权重的损失返回，这就是为什么要对不同负样本点的损失函数采取不同权重值的原因。&lt;br&gt;&lt;img src=&quot;https://img-blog.csdn.net/2018101220165774?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTQzODAxNjU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;CornerNet的第二个输出是offset，这个值和目标检测算法中预测的offset类似却完全不一样，说类似是因为都是偏置信息，说不一样是因为在目标检测算法中预测的offset是表示预测框和anchor之间的偏置，而这里的offset是表示在取整计算时丢失的精度信息，也就是公式2所表达的内容。&lt;br&gt;&lt;img src=&quot;https://img-blog.csdn.net/20181012201718217?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTQzODAxNjU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70&quot; alt=&quot;&quot;&gt;&lt;br&gt;我们知道从输入图像到特征图之间会有尺寸缩小，假设缩小倍数是n，那么输入图像上的(x,y)点对应到特征图上就如下式子&lt;br&gt;&lt;img src=&quot;https://img-blog.csdn.net/20181012201733925?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTQzODAxNjU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70&quot; alt=&quot;&quot;&gt;&lt;br&gt;式子中的符号是向下取整，取整会带来精度丢失，这尤其影响小尺寸目标的回归，Faster RCNN中的 ROI Pooling也是有类似的精度丢失问题。所以通过公式2计算offset，然后通过公式3的smooth L1损失函数监督学习该参数，和常见的目标检测算法中的回归支路类似。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img-blog.csdn.net/20181012201749649?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTQzODAxNjU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70&quot; alt=&quot;&quot;&gt;&lt;br&gt;CornerNet的第三个输出是embedding，对应文章中group corner的内容。前面介绍了关于角点的检测，在那部分中对角点的预测都是独立的，不涉及一个目标的一对角点的概念，因此如何找到一个目标的两个角点就是第三个输出embedding做的工作。这部分是受associative embedding那篇文章的启发，简而言之就是基于不同角点的embedding vector之间的距离找到每个目标的一对角点，如果一个左上角角点和一个右下角角点属于同一个目标，那么二者的embedding vector之间的距离应该很小。&lt;/p&gt;
&lt;p&gt;embedding这部分的训练是通过两个损失函数实现的，etk表示第k个目标的左上角角点的embedding vector，ebk表示第k个目标的右下角角点的embedding vector，ek表示etk和ebk的均值。公式4用来缩小属于同一个目标（第k个目标）的两个角点的embedding vector（etk和ebk）距离。公式5用来扩大不属于同一个目标的两个角点的embedding vector距离。&lt;br&gt;&lt;img src=&quot;https://img-blog.csdn.net/20181012201831690?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTQzODAxNjU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;最后一部分是corner pooling。首先看看为什么要引入corner pooling，如图Figure2所示。因为CornerNet是预测左上角和右下角两个角点，但是这两个角点在不同目标上没有相同规律可循，如果采用普通池化操作，那么在训练预测角点支路时会比较困难。考虑到左上角角点的右边有目标顶端的特征信息（第一张图的头顶），左上角角点的下边有目标左侧的特征信息（第一张图的手），因此如果左上角角点经过池化操作后能有这两个信息，那么就有利于该点的预测，这就有了corner pooling。&lt;/p&gt;
&lt;p&gt;Figure3是针对左上角点做corner pooling的示意图，该层有2个输入特征图，特征图的宽高分别用W和H表示，假设接下来要对图中红色点（坐标假设是(i,j)）做corner pooling，那么就计算(i,j)到(i,H)的最大值（对应Figure3上面第二个图），类似于找到Figure2中第一张图的左侧手信息；同时计算(i,j)到(W,j)的最大值（对应Figure3下面第二个图），类似于找到Figure2中第一张图的头顶信息，然后将这两个最大值相加得到(i,j)点的值（对应Figure3最后一个图的蓝色点）。右下角点的corner pooling操作类似，只不过计算最大值变成从(0,j)到(i,j)和从(i,0)到(i,j)。&lt;br&gt;&lt;img src=&quot;https://img-blog.csdn.net/2018101220185287?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTQzODAxNjU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;Figure6也是针对左上角点做corner pooling的示意图，是Figure3的具体数值计算例子，该图一共计算了4个点的corner pooling结果。第二列的数值计算和Figure3介绍的一样，比如第一行第一个图中的0值点，计算该点的最大值时是计算该点和其右侧的值为2的点的最大值，因此得到的就是2。&lt;br&gt;&lt;img src=&quot;https://img-blog.csdn.net/20181012201913296?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTQzODAxNjU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;Figure7是Figure4中预测模块的详细结构，该结构包括corner pooling模块和预测输出模块两部分，corner pooling模块采用了类似residual block的形式，有一个skip connection，虚线框部分执行的就是corner pooling操作，也就是Figure6的操作，这样整个corner pooling操作就介绍完了。&lt;br&gt;&lt;img src=&quot;https://img-blog.csdn.net/20181012201934254?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTQzODAxNjU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;模型测试时候的几个细节：1、在得到预测角点后，会对这些角点做NMS操作，选择前100个左上角角点和100个右下角角点。2、计算左上角和右下角角点的embedding vector的距离时采用L1范数，距离大于0.5或者两个点来自不同类别的目标的都不能构成一对。3、测试图像采用0值填充方式得到指定大小作为网络的输入，而不是采用resize，另外同时测试图像的水平翻转图并融合二者的结果。4、最后通过soft-nms操作去除冗余框，只保留前100个预测框。&lt;/p&gt;
&lt;p&gt;实验结果：&lt;br&gt;Table1是关于conner pooling的对比实验，可以看出添加conner pooling（第二行）对效果的提升比较明显，这种提升尤其在目标尺度比较大的数据中表现明显。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img-blog.csdn.net/20181012201953558?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTQzODAxNjU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70&quot; alt=&quot;&quot;&gt;&lt;br&gt;Table2是关于对不同位置负样本采取不同权重的损失函数的效果。第一行是不采用这种策略的效果；第二行是采用固定半径值的效果，可以看出提升比较明显；第三行是采用基于目标计算得到的半径值的效果（这篇文章所采用的），效果得到进一步提升。&lt;br&gt;&lt;img src=&quot;https://img-blog.csdn.net/2018101220211329?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTQzODAxNjU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;Table3是关于这篇文章的几个创新点效果。第一行是这篇文章的算法结果；第二行是将角点预测结果用ground truth代替，可以看到提升非常大；第三行是进一步将偏置用ground truth代替，相比之下提升会小很多。这说明目前该算法的瓶颈主要在于角点预测。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img-blog.csdn.net/20181012202130999?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTQzODAxNjU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70&quot; alt=&quot;&quot;&gt;&lt;br&gt;Table4是connerNet和其他目标检测算法的效果对比，可以看出模型效果还是很不错的。&lt;br&gt;&lt;img src=&quot;https://img-blog.csdn.net/20181012202146342?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTQzODAxNjU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;整篇文章看下来收获还是比较多的，希望目标检测领域能够继续百花齐放。不过比较好奇算法的速度，在实验部分没有看到对比。&lt;br&gt;————————————————&lt;br&gt;版权声明：本文为CSDN博主「AI之路」的原创文章。&lt;br&gt;原文链接：&lt;a href=&quot;https://blog.csdn.net/u014380165/article/details/83032273&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;AI之路-CornerNet&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;CornerNet-Detecting-Objects-as-Paired-Keypoints论文笔记&quot;&gt;&lt;a href=&quot;#CornerNet-Detecting-Objects-as-Paired-Keypoints论文笔记&quot; class=&quot;headerlin
    
    </summary>
    
      <category term="论文阅读" scheme="http://chr10003566.github.io./categories/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/"/>
    
    
  </entry>
  
  <entry>
    <title>mmDetection源码分析（2）：训练与配置文件</title>
    <link href="http://chr10003566.github.io./2019/12/03/mmdetection(2)/"/>
    <id>http://chr10003566.github.io./2019/12/03/mmdetection(2)/</id>
    <published>2019-12-03T14:22:22.000Z</published>
    <updated>2019-12-03T14:26:20.260Z</updated>
    
    <content type="html">&lt;h1 id=&quot;训练函数调用&quot;&gt;&lt;a href=&quot;#训练函数调用&quot; class=&quot;headerlink&quot; title=&quot;训练函数调用&quot;&gt;&lt;/a&gt;训练函数调用&lt;/h1&gt;&lt;h2 id=&quot;训练脚本&quot;&gt;&lt;a href=&quot;#训练脚本&quot; class=&quot;headerlink&quot; title=&quot;训练脚本&quot;&gt;&lt;/a&gt;训练脚本&lt;/h2&gt;&lt;p&gt;&lt;code&gt;python tools/train.py configs/faster_rcnn_r50_fpn_1x.py&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;训练可选项：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;–work_dir：模型checkpoint以及训练log文件的输出目录，若在脚本中不设置，则为&lt;code&gt;config/*.py&lt;/code&gt;中work_dir中的路径。&lt;/li&gt;
&lt;li&gt;–resume_from：指定在某个checkpoint的基础上继续训练，若在脚本中不设置，则为&lt;code&gt;config/*.py&lt;/code&gt;中resume_from中的值，默认为None。&lt;/li&gt;
&lt;li&gt;–validate：指是否在训练中建立checkpoint的时候对该checkpoint进行评估&lt;/li&gt;
&lt;li&gt;–gpus: 指使用GPU的数量，默认值为1&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;build-detector&quot;&gt;&lt;a href=&quot;#build-detector&quot; class=&quot;headerlink&quot; title=&quot;build_detector&quot;&gt;&lt;/a&gt;build_detector&lt;/h2&gt;&lt;h2 id=&quot;build-dataset&quot;&gt;&lt;a href=&quot;#build-dataset&quot; class=&quot;headerlink&quot; title=&quot;build_dataset&quot;&gt;&lt;/a&gt;build_dataset&lt;/h2&gt;&lt;h2 id=&quot;train-detector&quot;&gt;&lt;a href=&quot;#train-detector&quot; class=&quot;headerlink&quot; title=&quot;train_detector&quot;&gt;&lt;/a&gt;train_detector&lt;/h2&gt;&lt;p&gt;train_detector三个输入参数：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;model：build_detector返回的模型&lt;/li&gt;
&lt;li&gt;train_dataset：build_dataset返回的dataset&lt;/li&gt;
&lt;li&gt;cfg：模型的配置文件&lt;/li&gt;
&lt;li&gt;distributed：默认为False&lt;/li&gt;
&lt;li&gt;validate：默认为False&lt;/li&gt;
&lt;li&gt;logger：默认为None，若为None则会重新创建&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;配置文件详解&quot;&gt;&lt;a href=&quot;#配置文件详解&quot; class=&quot;headerlink&quot; title=&quot;配置文件详解&quot;&gt;&lt;/a&gt;配置文件详解&lt;/h1&gt;&lt;h2 id=&quot;model&quot;&gt;&lt;a href=&quot;#model&quot; class=&quot;headerlink&quot; title=&quot;model&quot;&gt;&lt;/a&gt;model&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;type：model类型，需要在&lt;code&gt;/mmdet/models/detectors/__init__.py&lt;/code&gt;中定义&lt;/li&gt;
&lt;li&gt;pretrained：预训练的模型&lt;/li&gt;
&lt;li&gt;backbone: 骨架参数字典  types需要在&lt;code&gt;/mmdet/models/backbones/__init__.py&lt;/code&gt;中定义&lt;/li&gt;
&lt;li&gt;neck:neck的类型，需要在&lt;code&gt;/mmdet/models/necks/__init__.py&lt;/code&gt;中定义&lt;/li&gt;
&lt;li&gt;rpn_head: RPN的类型需要在&lt;code&gt;/mmdet/models/anchor_heads/__init__.py&lt;/code&gt;中定义&lt;/li&gt;
&lt;li&gt;bbox_roi_extractor: 目前只有&lt;code&gt;SingleRoIExtractor&lt;/code&gt;这一种类型，需在&lt;code&gt;/mmdet/models/roi_extractors/__init__.py&lt;/code&gt;中定义&lt;/li&gt;
&lt;li&gt;bbox_head: head的类型需要在&lt;code&gt;/mmdet/models/bbox_heads/__init__.py&lt;/code&gt;中定义&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;train-cfg&quot;&gt;&lt;a href=&quot;#train-cfg&quot; class=&quot;headerlink&quot; title=&quot;train_cfg&quot;&gt;&lt;/a&gt;train_cfg&lt;/h2&gt;&lt;p&gt;训练超参数的设置。需要设置一下参数字典rpn，rcnn。&lt;br&gt;其中assigner和sampler的类型分别要在&lt;code&gt;/mmdet/core/box/assigners/__init__.py&lt;/code&gt;和&lt;code&gt;/mmdet/core/box/samplers/__init__.py&lt;/code&gt;中进行配置。&lt;/p&gt;
&lt;h2 id=&quot;test-cfg&quot;&gt;&lt;a href=&quot;#test-cfg&quot; class=&quot;headerlink&quot; title=&quot;test_cfg&quot;&gt;&lt;/a&gt;test_cfg&lt;/h2&gt;&lt;p&gt;测试阶段的超参数的配置&lt;/p&gt;
&lt;p&gt;需要设置rpn、rcnn的参数字典，要配置如nms的阈值与置信度的阈值。&lt;/p&gt;
&lt;h2 id=&quot;data&quot;&gt;&lt;a href=&quot;#data&quot; class=&quot;headerlink&quot; title=&quot;data&quot;&gt;&lt;/a&gt;data&lt;/h2&gt;&lt;p&gt;dataset_type：数据集类型，需要在&lt;code&gt;/mmdet/datasets/__init__.py&lt;/code&gt;中设置数据集类型。&lt;br&gt;data_root：数据集根目录&lt;/p&gt;
&lt;p&gt;参数字典data配置，配置train、val、test数据集的参数。&lt;/p&gt;
&lt;h2 id=&quot;optimizer&quot;&gt;&lt;a href=&quot;#optimizer&quot; class=&quot;headerlink&quot; title=&quot;optimizer&quot;&gt;&lt;/a&gt;optimizer&lt;/h2&gt;&lt;p&gt;优化器的选择。&lt;/p&gt;
&lt;p&gt;通过设置参数，构造优化器。&lt;/p&gt;
&lt;h2 id=&quot;lr-config&quot;&gt;&lt;a href=&quot;#lr-config&quot; class=&quot;headerlink&quot; title=&quot;lr_config&quot;&gt;&lt;/a&gt;lr_config&lt;/h2&gt;&lt;p&gt;学习率优化策略参数设置。&lt;/p&gt;
&lt;h2 id=&quot;checkpoint-config&quot;&gt;&lt;a href=&quot;#checkpoint-config&quot; class=&quot;headerlink&quot; title=&quot;checkpoint_config&quot;&gt;&lt;/a&gt;checkpoint_config&lt;/h2&gt;&lt;p&gt;设置多少epoch存储一次checkpoint&lt;/p&gt;
&lt;h2 id=&quot;log-config&quot;&gt;&lt;a href=&quot;#log-config&quot; class=&quot;headerlink&quot; title=&quot;log_config&quot;&gt;&lt;/a&gt;log_config&lt;/h2&gt;&lt;p&gt;输出log文件的配置&lt;br&gt;多少个batch输出一次信息&lt;br&gt;log文件的风格&lt;/p&gt;
&lt;h2 id=&quot;其他&quot;&gt;&lt;a href=&quot;#其他&quot; class=&quot;headerlink&quot; title=&quot;其他&quot;&gt;&lt;/a&gt;其他&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;total_epoches: 最大epoch数&lt;/li&gt;
&lt;li&gt;log_level:&lt;/li&gt;
&lt;li&gt;work_dir：log文件和模型文件存储路径&lt;/li&gt;
&lt;li&gt;load_from：训练模型的路径&lt;/li&gt;
&lt;li&gt;resume_from：恢复训练模型的路径&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;以下内容从&lt;a href=&quot;https://blog.csdn.net/hajlyx/article/details/85991400&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;mmdetection的configs中的各项参数具体解释&lt;/a&gt;转载过来。&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;85&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;86&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;87&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;88&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;89&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;90&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;91&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;92&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;93&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;94&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;95&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;96&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;97&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;98&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;99&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;100&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;101&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;102&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;103&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;104&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;105&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;106&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;107&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;108&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;109&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;110&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;111&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;112&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;113&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;114&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;115&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;116&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;117&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;118&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;119&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;120&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;121&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;122&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;123&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;124&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;125&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;126&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;127&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;128&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;129&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;130&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;131&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;132&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;133&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;134&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;135&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;136&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;137&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;138&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;139&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;140&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;141&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;142&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;143&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;144&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;145&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;146&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;147&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;148&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;149&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;150&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;151&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;152&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;153&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;154&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;155&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;156&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# model settings&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;model = dict(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	type=&lt;span class=&quot;string&quot;&gt;&#39;FasterRCNN&#39;&lt;/span&gt;,                         &lt;span class=&quot;comment&quot;&gt;# model类型&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    pretrained=&lt;span class=&quot;string&quot;&gt;&#39;modelzoo://resnet50&#39;&lt;/span&gt;,          &lt;span class=&quot;comment&quot;&gt;# 预训练模型：imagenet-resnet50&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    backbone=dict(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        type=&lt;span class=&quot;string&quot;&gt;&#39;ResNet&#39;&lt;/span&gt;,                         &lt;span class=&quot;comment&quot;&gt;# backbone类型&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        depth=&lt;span class=&quot;number&quot;&gt;50&lt;/span&gt;,                              &lt;span class=&quot;comment&quot;&gt;# 网络层数&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        num_stages=&lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;,                          &lt;span class=&quot;comment&quot;&gt;# resnet的stage数量&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        out_indices=(&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;),              &lt;span class=&quot;comment&quot;&gt;# 输出的stage的序号&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        frozen_stages=&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;,                       &lt;span class=&quot;comment&quot;&gt;# 冻结的stage数量，即该stage不更新参数，-1表示所有的stage都更新参数&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        style=&lt;span class=&quot;string&quot;&gt;&#39;pytorch&#39;&lt;/span&gt;),                      &lt;span class=&quot;comment&quot;&gt;# 网络风格：如果设置pytorch，则stride为2的层是conv3x3的卷积层；如果设置caffe，则stride为2的层是第一个conv1x1的卷积层&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    neck=dict(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        type=&lt;span class=&quot;string&quot;&gt;&#39;FPN&#39;&lt;/span&gt;,                            &lt;span class=&quot;comment&quot;&gt;# neck类型&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        in_channels=[&lt;span class=&quot;number&quot;&gt;256&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;512&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1024&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;2048&lt;/span&gt;],    &lt;span class=&quot;comment&quot;&gt;# 输入的各个stage的通道数&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        out_channels=&lt;span class=&quot;number&quot;&gt;256&lt;/span&gt;,                      &lt;span class=&quot;comment&quot;&gt;# 输出的特征层的通道数&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        num_outs=&lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;),                           &lt;span class=&quot;comment&quot;&gt;# 输出的特征层的数量&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    rpn_head=dict(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        type=&lt;span class=&quot;string&quot;&gt;&#39;RPNHead&#39;&lt;/span&gt;,                        &lt;span class=&quot;comment&quot;&gt;# RPN网络类型&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        in_channels=&lt;span class=&quot;number&quot;&gt;256&lt;/span&gt;,                       &lt;span class=&quot;comment&quot;&gt;# RPN网络的输入通道数&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        feat_channels=&lt;span class=&quot;number&quot;&gt;256&lt;/span&gt;,                     &lt;span class=&quot;comment&quot;&gt;# 特征层的通道数&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        anchor_scales=[&lt;span class=&quot;number&quot;&gt;8&lt;/span&gt;],                     &lt;span class=&quot;comment&quot;&gt;# 生成的anchor的baselen，baselen = sqrt(w*h)，w和h为anchor的宽和高&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        anchor_ratios=[&lt;span class=&quot;number&quot;&gt;0.5&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1.0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;2.0&lt;/span&gt;],         &lt;span class=&quot;comment&quot;&gt;# anchor的宽高比&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        anchor_strides=[&lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;8&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;16&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;32&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;64&lt;/span&gt;],     &lt;span class=&quot;comment&quot;&gt;# 在每个特征层上的anchor的步长（对应于原图）&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        target_means=[&lt;span class=&quot;number&quot;&gt;.0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;.0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;.0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;.0&lt;/span&gt;],         &lt;span class=&quot;comment&quot;&gt;# 均值&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        target_stds=[&lt;span class=&quot;number&quot;&gt;1.0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1.0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1.0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1.0&lt;/span&gt;],      &lt;span class=&quot;comment&quot;&gt;# 方差&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        use_sigmoid_cls=&lt;span class=&quot;keyword&quot;&gt;True&lt;/span&gt;),                 &lt;span class=&quot;comment&quot;&gt;# 是否使用sigmoid来进行分类，如果False则使用softmax来分类&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    bbox_roi_extractor=dict(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        type=&lt;span class=&quot;string&quot;&gt;&#39;SingleRoIExtractor&#39;&lt;/span&gt;,                                   &lt;span class=&quot;comment&quot;&gt;# RoIExtractor类型&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        roi_layer=dict(type=&lt;span class=&quot;string&quot;&gt;&#39;RoIAlign&#39;&lt;/span&gt;, out_size=&lt;span class=&quot;number&quot;&gt;7&lt;/span&gt;, sample_num=&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;),   &lt;span class=&quot;comment&quot;&gt;# ROI具体参数：ROI类型为ROIalign，输出尺寸为7，sample数为2&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        out_channels=&lt;span class=&quot;number&quot;&gt;256&lt;/span&gt;,                                            &lt;span class=&quot;comment&quot;&gt;# 输出通道数&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        featmap_strides=[&lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;8&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;16&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;32&lt;/span&gt;]),                             &lt;span class=&quot;comment&quot;&gt;# 特征图的步长&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    bbox_head=dict(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        type=&lt;span class=&quot;string&quot;&gt;&#39;SharedFCBBoxHead&#39;&lt;/span&gt;,                     &lt;span class=&quot;comment&quot;&gt;# 全连接层类型&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        num_fcs=&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;,                                   &lt;span class=&quot;comment&quot;&gt;# 全连接层数量&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        in_channels=&lt;span class=&quot;number&quot;&gt;256&lt;/span&gt;,                             &lt;span class=&quot;comment&quot;&gt;# 输入通道数&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        fc_out_channels=&lt;span class=&quot;number&quot;&gt;1024&lt;/span&gt;,                        &lt;span class=&quot;comment&quot;&gt;# 输出通道数&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        roi_feat_size=&lt;span class=&quot;number&quot;&gt;7&lt;/span&gt;,                             &lt;span class=&quot;comment&quot;&gt;# ROI特征层尺寸&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        num_classes=&lt;span class=&quot;number&quot;&gt;81&lt;/span&gt;,                              &lt;span class=&quot;comment&quot;&gt;# 分类器的类别数量+1，+1是因为多了一个背景的类别&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        target_means=[&lt;span class=&quot;number&quot;&gt;0.&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;0.&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;0.&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;0.&lt;/span&gt;],               &lt;span class=&quot;comment&quot;&gt;# 均值&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        target_stds=[&lt;span class=&quot;number&quot;&gt;0.1&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;0.1&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;0.2&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;0.2&lt;/span&gt;],            &lt;span class=&quot;comment&quot;&gt;# 方差&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        reg_class_agnostic=&lt;span class=&quot;keyword&quot;&gt;False&lt;/span&gt;))                   &lt;span class=&quot;comment&quot;&gt;# 是否采用class_agnostic的方式来预测，class_agnostic表示输出bbox时只考虑其是否为前景，后续分类的时候再根据该bbox在网络中的类别得分来分类，也就是说一个框可以对应多个类别&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# model training and testing settings&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;train_cfg = dict(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    rpn=dict(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        assigner=dict(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            type=&lt;span class=&quot;string&quot;&gt;&#39;MaxIoUAssigner&#39;&lt;/span&gt;,            &lt;span class=&quot;comment&quot;&gt;# RPN网络的正负样本划分&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            pos_iou_thr=&lt;span class=&quot;number&quot;&gt;0.7&lt;/span&gt;,                  &lt;span class=&quot;comment&quot;&gt;# 正样本的iou阈值&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            neg_iou_thr=&lt;span class=&quot;number&quot;&gt;0.3&lt;/span&gt;,                  &lt;span class=&quot;comment&quot;&gt;# 负样本的iou阈值&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            min_pos_iou=&lt;span class=&quot;number&quot;&gt;0.3&lt;/span&gt;,                  &lt;span class=&quot;comment&quot;&gt;# 正样本的iou最小值。如果assign给ground truth的anchors中最大的IOU低于0.3，则忽略所有的anchors，否则保留最大IOU的anchor&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ignore_iof_thr=&lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;),               &lt;span class=&quot;comment&quot;&gt;# 忽略bbox的阈值，当ground truth中包含需要忽略的bbox时使用，-1表示不忽略&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        sampler=dict(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            type=&lt;span class=&quot;string&quot;&gt;&#39;RandomSampler&#39;&lt;/span&gt;,             &lt;span class=&quot;comment&quot;&gt;# 正负样本提取器类型&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            num=&lt;span class=&quot;number&quot;&gt;256&lt;/span&gt;,                          &lt;span class=&quot;comment&quot;&gt;# 需提取的正负样本数量&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            pos_fraction=&lt;span class=&quot;number&quot;&gt;0.5&lt;/span&gt;,                 &lt;span class=&quot;comment&quot;&gt;# 正样本比例&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            neg_pos_ub=&lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;,                    &lt;span class=&quot;comment&quot;&gt;# 最大负样本比例，大于该比例的负样本忽略，-1表示不忽略&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            add_gt_as_proposals=&lt;span class=&quot;keyword&quot;&gt;False&lt;/span&gt;),       &lt;span class=&quot;comment&quot;&gt;# 把ground truth加入proposal作为正样本&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        allowed_border=&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,                     &lt;span class=&quot;comment&quot;&gt;# 允许在bbox周围外扩一定的像素&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        pos_weight=&lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;,                        &lt;span class=&quot;comment&quot;&gt;# 正样本权重，-1表示不改变原始的权重&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        smoothl1_beta=&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt; / &lt;span class=&quot;number&quot;&gt;9.0&lt;/span&gt;,                &lt;span class=&quot;comment&quot;&gt;# 平滑L1系数&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        debug=&lt;span class=&quot;keyword&quot;&gt;False&lt;/span&gt;),                         &lt;span class=&quot;comment&quot;&gt;# debug模式&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    rcnn=dict(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        assigner=dict(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            type=&lt;span class=&quot;string&quot;&gt;&#39;MaxIoUAssigner&#39;&lt;/span&gt;,            &lt;span class=&quot;comment&quot;&gt;# RCNN网络正负样本划分&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            pos_iou_thr=&lt;span class=&quot;number&quot;&gt;0.5&lt;/span&gt;,                  &lt;span class=&quot;comment&quot;&gt;# 正样本的iou阈值&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            neg_iou_thr=&lt;span class=&quot;number&quot;&gt;0.5&lt;/span&gt;,                  &lt;span class=&quot;comment&quot;&gt;# 负样本的iou阈值&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            min_pos_iou=&lt;span class=&quot;number&quot;&gt;0.5&lt;/span&gt;,                  &lt;span class=&quot;comment&quot;&gt;# 正样本的iou最小值。如果assign给ground truth的anchors中最大的IOU低于0.3，则忽略所有的anchors，否则保留最大IOU的anchor&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            ignore_iof_thr=&lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;),               &lt;span class=&quot;comment&quot;&gt;# 忽略bbox的阈值，当ground truth中包含需要忽略的bbox时使用，-1表示不忽略&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        sampler=dict(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            type=&lt;span class=&quot;string&quot;&gt;&#39;RandomSampler&#39;&lt;/span&gt;,             &lt;span class=&quot;comment&quot;&gt;# 正负样本提取器类型&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            num=&lt;span class=&quot;number&quot;&gt;512&lt;/span&gt;,                          &lt;span class=&quot;comment&quot;&gt;# 需提取的正负样本数量&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            pos_fraction=&lt;span class=&quot;number&quot;&gt;0.25&lt;/span&gt;,                &lt;span class=&quot;comment&quot;&gt;# 正样本比例&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            neg_pos_ub=&lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;,                    &lt;span class=&quot;comment&quot;&gt;# 最大负样本比例，大于该比例的负样本忽略，-1表示不忽略&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            add_gt_as_proposals=&lt;span class=&quot;keyword&quot;&gt;True&lt;/span&gt;),        &lt;span class=&quot;comment&quot;&gt;# 把ground truth加入proposal作为正样本&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        pos_weight=&lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt;,                        &lt;span class=&quot;comment&quot;&gt;# 正样本权重，-1表示不改变原始的权重&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        debug=&lt;span class=&quot;keyword&quot;&gt;False&lt;/span&gt;))                         &lt;span class=&quot;comment&quot;&gt;# debug模式&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;test_cfg = dict(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    rpn=dict(                                 &lt;span class=&quot;comment&quot;&gt;# 推断时的RPN参数&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        nms_across_levels=&lt;span class=&quot;keyword&quot;&gt;False&lt;/span&gt;,              &lt;span class=&quot;comment&quot;&gt;# 在所有的fpn层内做nms&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        nms_pre=&lt;span class=&quot;number&quot;&gt;2000&lt;/span&gt;,                         &lt;span class=&quot;comment&quot;&gt;# 在nms之前保留的的得分最高的proposal数量&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        nms_post=&lt;span class=&quot;number&quot;&gt;2000&lt;/span&gt;,                        &lt;span class=&quot;comment&quot;&gt;# 在nms之后保留的的得分最高的proposal数量&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        max_num=&lt;span class=&quot;number&quot;&gt;2000&lt;/span&gt;,                         &lt;span class=&quot;comment&quot;&gt;# 在后处理完成之后保留的proposal数量&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        nms_thr=&lt;span class=&quot;number&quot;&gt;0.7&lt;/span&gt;,                          &lt;span class=&quot;comment&quot;&gt;# nms阈值&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        min_bbox_size=&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;),                     &lt;span class=&quot;comment&quot;&gt;# 最小bbox尺寸&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    rcnn=dict(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        score_thr=&lt;span class=&quot;number&quot;&gt;0.05&lt;/span&gt;, nms=dict(type=&lt;span class=&quot;string&quot;&gt;&#39;nms&#39;&lt;/span&gt;, iou_thr=&lt;span class=&quot;number&quot;&gt;0.5&lt;/span&gt;), max_per_img=&lt;span class=&quot;number&quot;&gt;100&lt;/span&gt;)   &lt;span class=&quot;comment&quot;&gt;# max_per_img表示最终输出的det bbox数量&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;# soft-nms is also supported for rcnn testing&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;# e.g., nms=dict(type=&#39;soft_nms&#39;, iou_thr=0.5, min_score=0.05)            # soft_nms参数&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# dataset settings&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dataset_type = &lt;span class=&quot;string&quot;&gt;&#39;CocoDataset&#39;&lt;/span&gt;                &lt;span class=&quot;comment&quot;&gt;# 数据集类型&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;data_root = &lt;span class=&quot;string&quot;&gt;&#39;data/coco/&#39;&lt;/span&gt;                    &lt;span class=&quot;comment&quot;&gt;# 数据集根目录&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;img_norm_cfg = dict(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    mean=[&lt;span class=&quot;number&quot;&gt;123.675&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;116.28&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;103.53&lt;/span&gt;], std=[&lt;span class=&quot;number&quot;&gt;58.395&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;57.12&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;57.375&lt;/span&gt;], to_rgb=&lt;span class=&quot;keyword&quot;&gt;True&lt;/span&gt;)   &lt;span class=&quot;comment&quot;&gt;# 输入图像初始化，减去均值mean并处以方差std，to_rgb表示将bgr转为rgb&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;data = dict(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    imgs_per_gpu=&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;,                &lt;span class=&quot;comment&quot;&gt;# 每个gpu计算的图像数量&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    workers_per_gpu=&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;,             &lt;span class=&quot;comment&quot;&gt;# 每个gpu分配的线程数&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    train=dict(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        type=dataset_type,                                                 &lt;span class=&quot;comment&quot;&gt;# 数据集类型&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ann_file=data_root + &lt;span class=&quot;string&quot;&gt;&#39;annotations/instances_train2017.json&#39;&lt;/span&gt;,       &lt;span class=&quot;comment&quot;&gt;# 数据集annotation路径&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        img_prefix=data_root + &lt;span class=&quot;string&quot;&gt;&#39;train2017/&#39;&lt;/span&gt;,                               &lt;span class=&quot;comment&quot;&gt;# 数据集的图片路径&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        img_scale=(&lt;span class=&quot;number&quot;&gt;1333&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;800&lt;/span&gt;),                                             &lt;span class=&quot;comment&quot;&gt;# 输入图像尺寸，最大边1333，最小边800&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        img_norm_cfg=img_norm_cfg,                                         &lt;span class=&quot;comment&quot;&gt;# 图像初始化参数&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        size_divisor=&lt;span class=&quot;number&quot;&gt;32&lt;/span&gt;,                                                   &lt;span class=&quot;comment&quot;&gt;# 对图像进行resize时的最小单位，32表示所有的图像都会被resize成32的倍数&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        flip_ratio=&lt;span class=&quot;number&quot;&gt;0.5&lt;/span&gt;,                                                    &lt;span class=&quot;comment&quot;&gt;# 图像的随机左右翻转的概率&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        with_mask=&lt;span class=&quot;keyword&quot;&gt;False&lt;/span&gt;,                                                   &lt;span class=&quot;comment&quot;&gt;# 训练时附带mask&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        with_crowd=&lt;span class=&quot;keyword&quot;&gt;True&lt;/span&gt;,                                                   &lt;span class=&quot;comment&quot;&gt;# 训练时附带difficult的样本&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        with_label=&lt;span class=&quot;keyword&quot;&gt;True&lt;/span&gt;),                                                  &lt;span class=&quot;comment&quot;&gt;# 训练时附带label&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    val=dict(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        type=dataset_type,                                                 &lt;span class=&quot;comment&quot;&gt;# 同上&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ann_file=data_root + &lt;span class=&quot;string&quot;&gt;&#39;annotations/instances_val2017.json&#39;&lt;/span&gt;,         &lt;span class=&quot;comment&quot;&gt;# 同上&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        img_prefix=data_root + &lt;span class=&quot;string&quot;&gt;&#39;val2017/&#39;&lt;/span&gt;,                                 &lt;span class=&quot;comment&quot;&gt;# 同上&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        img_scale=(&lt;span class=&quot;number&quot;&gt;1333&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;800&lt;/span&gt;),                                             &lt;span class=&quot;comment&quot;&gt;# 同上&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        img_norm_cfg=img_norm_cfg,                                         &lt;span class=&quot;comment&quot;&gt;# 同上&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        size_divisor=&lt;span class=&quot;number&quot;&gt;32&lt;/span&gt;,                                                   &lt;span class=&quot;comment&quot;&gt;# 同上&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        flip_ratio=&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,                                                      &lt;span class=&quot;comment&quot;&gt;# 同上&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        with_mask=&lt;span class=&quot;keyword&quot;&gt;False&lt;/span&gt;,                                                   &lt;span class=&quot;comment&quot;&gt;# 同上&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        with_crowd=&lt;span class=&quot;keyword&quot;&gt;True&lt;/span&gt;,                                                   &lt;span class=&quot;comment&quot;&gt;# 同上&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        with_label=&lt;span class=&quot;keyword&quot;&gt;True&lt;/span&gt;),                                                  &lt;span class=&quot;comment&quot;&gt;# 同上&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    test=dict(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        type=dataset_type,                                                 &lt;span class=&quot;comment&quot;&gt;# 同上&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ann_file=data_root + &lt;span class=&quot;string&quot;&gt;&#39;annotations/instances_val2017.json&#39;&lt;/span&gt;,         &lt;span class=&quot;comment&quot;&gt;# 同上&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        img_prefix=data_root + &lt;span class=&quot;string&quot;&gt;&#39;val2017/&#39;&lt;/span&gt;,                                 &lt;span class=&quot;comment&quot;&gt;# 同上&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        img_scale=(&lt;span class=&quot;number&quot;&gt;1333&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;800&lt;/span&gt;),                                             &lt;span class=&quot;comment&quot;&gt;# 同上&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        img_norm_cfg=img_norm_cfg,                                         &lt;span class=&quot;comment&quot;&gt;# 同上&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        size_divisor=&lt;span class=&quot;number&quot;&gt;32&lt;/span&gt;,                                                   &lt;span class=&quot;comment&quot;&gt;# 同上&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        flip_ratio=&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,                                                      &lt;span class=&quot;comment&quot;&gt;# 同上&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        with_mask=&lt;span class=&quot;keyword&quot;&gt;False&lt;/span&gt;,                                                   &lt;span class=&quot;comment&quot;&gt;# 同上&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        with_label=&lt;span class=&quot;keyword&quot;&gt;False&lt;/span&gt;,                                                  &lt;span class=&quot;comment&quot;&gt;# 同上&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        test_mode=&lt;span class=&quot;keyword&quot;&gt;True&lt;/span&gt;))                                                   &lt;span class=&quot;comment&quot;&gt;# 同上&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# optimizer&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;optimizer = dict(type=&lt;span class=&quot;string&quot;&gt;&#39;SGD&#39;&lt;/span&gt;, lr=&lt;span class=&quot;number&quot;&gt;0.02&lt;/span&gt;, momentum=&lt;span class=&quot;number&quot;&gt;0.9&lt;/span&gt;, weight_decay=&lt;span class=&quot;number&quot;&gt;0.0001&lt;/span&gt;)   &lt;span class=&quot;comment&quot;&gt;# 优化参数，lr为学习率，momentum为动量因子，weight_decay为权重衰减因子&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;optimizer_config = dict(grad_clip=dict(max_norm=&lt;span class=&quot;number&quot;&gt;35&lt;/span&gt;, norm_type=&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;))          &lt;span class=&quot;comment&quot;&gt;# 梯度均衡参数&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# learning policy&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;lr_config = dict(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    policy=&lt;span class=&quot;string&quot;&gt;&#39;step&#39;&lt;/span&gt;,                        &lt;span class=&quot;comment&quot;&gt;# 优化策略&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    warmup=&lt;span class=&quot;string&quot;&gt;&#39;linear&#39;&lt;/span&gt;,                      &lt;span class=&quot;comment&quot;&gt;# 初始的学习率增加的策略，linear为线性增加&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    warmup_iters=&lt;span class=&quot;number&quot;&gt;500&lt;/span&gt;,                     &lt;span class=&quot;comment&quot;&gt;# 在初始的500次迭代中学习率逐渐增加&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    warmup_ratio=&lt;span class=&quot;number&quot;&gt;1.0&lt;/span&gt; / &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;,                 &lt;span class=&quot;comment&quot;&gt;# 起始的学习率&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    step=[&lt;span class=&quot;number&quot;&gt;8&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;11&lt;/span&gt;])                         &lt;span class=&quot;comment&quot;&gt;# 在第8和11个epoch时降低学习率&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;checkpoint_config = dict(interval=&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;)      &lt;span class=&quot;comment&quot;&gt;# 每1个epoch存储一次模型&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# yapf:disable&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;log_config = dict(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    interval=&lt;span class=&quot;number&quot;&gt;50&lt;/span&gt;,                          &lt;span class=&quot;comment&quot;&gt;# 每50个batch输出一次信息&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    hooks=[&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        dict(type=&lt;span class=&quot;string&quot;&gt;&#39;TextLoggerHook&#39;&lt;/span&gt;),      &lt;span class=&quot;comment&quot;&gt;# 控制台输出信息的风格&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;# dict(type=&#39;TensorboardLoggerHook&#39;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ])&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# yapf:enable&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# runtime settings&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;total_epochs = &lt;span class=&quot;number&quot;&gt;12&lt;/span&gt;                               &lt;span class=&quot;comment&quot;&gt;# 最大epoch数&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dist_params = dict(backend=&lt;span class=&quot;string&quot;&gt;&#39;nccl&#39;&lt;/span&gt;)              &lt;span class=&quot;comment&quot;&gt;# 分布式参数&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;log_level = &lt;span class=&quot;string&quot;&gt;&#39;INFO&#39;&lt;/span&gt;                              &lt;span class=&quot;comment&quot;&gt;# 输出信息的完整度级别&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;work_dir = &lt;span class=&quot;string&quot;&gt;&#39;./work_dirs/faster_rcnn_r50_fpn_1x&#39;&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;# log文件和模型文件存储路径&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;load_from = &lt;span class=&quot;keyword&quot;&gt;None&lt;/span&gt;                                &lt;span class=&quot;comment&quot;&gt;# 加载模型的路径，None表示从预训练模型加载&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;resume_from = &lt;span class=&quot;keyword&quot;&gt;None&lt;/span&gt;                              &lt;span class=&quot;comment&quot;&gt;# 恢复训练模型的路径&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;workflow = [(&lt;span class=&quot;string&quot;&gt;&#39;train&#39;&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;)]                       &lt;span class=&quot;comment&quot;&gt;# 当前工作区名称&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;训练函数调用&quot;&gt;&lt;a href=&quot;#训练函数调用&quot; class=&quot;headerlink&quot; title=&quot;训练函数调用&quot;&gt;&lt;/a&gt;训练函数调用&lt;/h1&gt;&lt;h2 id=&quot;训练脚本&quot;&gt;&lt;a href=&quot;#训练脚本&quot; class=&quot;headerlink&quot; title=&quot;训
    
    </summary>
    
      <category term="mmDetection源码分析" scheme="http://chr10003566.github.io./categories/mmDetection%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    
    
  </entry>
  
  <entry>
    <title>FCOS- Fully Convolutional One-Stage Object Detection论文解读</title>
    <link href="http://chr10003566.github.io./2019/12/03/%E5%AD%A6%E4%B9%A0%20FCOS-%20Fully%20Convolutional%20One-Stage%20Object%20Detection/"/>
    <id>http://chr10003566.github.io./2019/12/03/学习 FCOS- Fully Convolutional One-Stage Object Detection/</id>
    <published>2019-12-03T07:24:14.000Z</published>
    <updated>2019-12-03T07:58:35.712Z</updated>
    
    <content type="html">&lt;h1 id=&quot;FCOS-Fully-Convolutional-One-Stage-Object-Detection解读&quot;&gt;&lt;a href=&quot;#FCOS-Fully-Convolutional-One-Stage-Object-Detection解读&quot; class=&quot;headerlink&quot; title=&quot;FCOS- Fully Convolutional One-Stage Object Detection解读&quot;&gt;&lt;/a&gt;FCOS- Fully Convolutional One-Stage Object Detection解读&lt;/h1&gt;&lt;p&gt;本文属于个人基于论文的一些标注与理解，大部分截至原文的内容，未读过论文的同学看起来可能会有点吃力，可以先阅读&lt;a href=&quot;https://blog.csdn.net/u014380165&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;AI之路&lt;/a&gt;博主对论文的解读&lt;a href=&quot;https://blog.csdn.net/u014380165/article/details/90962991&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;FCOS算法详解&lt;/a&gt;。若已经通读论文的同学，可以阅读本文，或许能为您查缺补漏。谢谢～&lt;/p&gt;
&lt;h2 id=&quot;Motivation&quot;&gt;&lt;a href=&quot;#Motivation&quot; class=&quot;headerlink&quot; title=&quot;Motivation&quot;&gt;&lt;/a&gt;Motivation&lt;/h2&gt;&lt;h3 id=&quot;1-Anchor-Based存在的问题&quot;&gt;&lt;a href=&quot;#1-Anchor-Based存在的问题&quot; class=&quot;headerlink&quot; title=&quot;1. Anchor-Based存在的问题&quot;&gt;&lt;/a&gt;1. Anchor-Based存在的问题&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;detection performance is sensitive to the sizes, aspect ratios and number of anchor boxes.&lt;/li&gt;
&lt;li&gt;&lt;p&gt;the scales and aspect ratios of anchor boxes are kept fixed, detectors encounter difficulties to deal with object candidates with large shape variations, par- ticularly for small objects.&lt;/p&gt;
&lt;p&gt;anchor-boxes 尺寸和比例固定，导致其处理尺度变化大或者尺寸小的物体有难度。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;The excessive number of negative samples aggravates the imbalance between positive and negative samples in training.&lt;/p&gt;
&lt;p&gt;基于anchor-based的算法，由于要照顾到recall，要定义较多的尺寸和比例，因此会导致在训练过程，正负样本数量差异较大。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;involve complicated computation such as calculating the intersection-over-union (IoU) scores with ground-truth bounding boxes&lt;/p&gt;
&lt;p&gt;anchor-based算法需要复杂的计算（候选框和真值框的IoU）&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;2-FCNs-have-achieved-tremendous-success-in-dense-prediction-tasks&quot;&gt;&lt;a href=&quot;#2-FCNs-have-achieved-tremendous-success-in-dense-prediction-tasks&quot; class=&quot;headerlink&quot; title=&quot;2. FCNs have achieved tremendous success in dense prediction tasks&quot;&gt;&lt;/a&gt;2. FCNs have achieved tremendous success in dense prediction tasks&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Can we solve object detection in the neat per-pixel prediction fashion, analogue to FCN for semantic segmentation, for example&lt;/p&gt;
&lt;p&gt;FCN在分割，关键点检测上取得了不错的效果，能否在目标检测上有所表现。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;3-DenseBox存在的问题&quot;&gt;&lt;a href=&quot;#3-DenseBox存在的问题&quot; class=&quot;headerlink&quot; title=&quot;3. DenseBox存在的问题&quot;&gt;&lt;/a&gt;3. DenseBox存在的问题&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;DenseBox crops and resizes training images to a fixed scale. Thus DenseBox has to perform detection on image pyramids, which is against FCN’s philosophy of computing all convolutions once.&lt;/p&gt;
&lt;p&gt;由于DenseBox需要将候选框裁剪到固定的尺寸，因此其必须使用图像金字塔进行训练。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;the highly overlapped bounding boxes result in an intractable ambiguity&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&quot;https://pic1.superbed.cn/item/5de60f58f1f6f81c504fd591.png&quot; alt=&quot;DenseBox&quot;&gt;&lt;/p&gt;
&lt;p&gt;  更重要的原因是，在常规的目标检测中，高度重合的候选框很常见。同一个像素点要回归哪一个候选框是难以界定的。&lt;/p&gt;
&lt;h2 id=&quot;FCOS的优势&quot;&gt;&lt;a href=&quot;#FCOS的优势&quot; class=&quot;headerlink&quot; title=&quot;FCOS的优势&quot;&gt;&lt;/a&gt;FCOS的优势&lt;/h2&gt;&lt;h3 id=&quot;1-proposal-free-and-anchor-free&quot;&gt;&lt;a href=&quot;#1-proposal-free-and-anchor-free&quot; class=&quot;headerlink&quot; title=&quot;1. proposal free and anchor free&quot;&gt;&lt;/a&gt;1. proposal free and anchor free&lt;/h3&gt;&lt;p&gt;减少超参数的个数&lt;/p&gt;
&lt;h3 id=&quot;2-avoids-the-complicated-computation-related-to-anchor-boxes-such-as-the-IOU-computation-and-matching-between-the-anchor-boxes-and-ground-truth-boxes-during-training&quot;&gt;&lt;a href=&quot;#2-avoids-the-complicated-computation-related-to-anchor-boxes-such-as-the-IOU-computation-and-matching-between-the-anchor-boxes-and-ground-truth-boxes-during-training&quot; class=&quot;headerlink&quot; title=&quot;2. avoids the complicated computation related to anchor boxes such as the IOU computation and matching between the anchor boxes and ground-truth boxes during training&quot;&gt;&lt;/a&gt;2. avoids the complicated computation related to anchor boxes such as the IOU computation and matching between the anchor boxes and ground-truth boxes during training&lt;/h3&gt;&lt;p&gt;取消了anchor，就减少了候选框与GT框IoU计算的步骤&lt;/p&gt;
&lt;h3 id=&quot;3-achieve-state-of-the-art-results-among-one-stage-detectors&quot;&gt;&lt;a href=&quot;#3-achieve-state-of-the-art-results-among-one-stage-detectors&quot; class=&quot;headerlink&quot; title=&quot;3. achieve state-of-the- art results among one-stage detectors&quot;&gt;&lt;/a&gt;3. achieve state-of-the- art results among one-stage detectors&lt;/h3&gt;&lt;p&gt;达到了当前one-stage检测器的最好效果&lt;/p&gt;
&lt;p&gt;show that the proposed FCOS can be used as a Region Proposal Networks (RPNs) in two-stage detectors and can achieve significantly better performance than its anchor-based RPN counterpartsFCOS&lt;/p&gt;
&lt;p&gt;甚至可以取代RPNs，用在两阶段的检测器中，并且能达到更好的效果。&lt;/p&gt;
&lt;h3 id=&quot;4-immediately-extended-to-solve-other-vision-tasks-with-minimal-modification-including-instance-segmentation-and-key-point-detection&quot;&gt;&lt;a href=&quot;#4-immediately-extended-to-solve-other-vision-tasks-with-minimal-modification-including-instance-segmentation-and-key-point-detection&quot; class=&quot;headerlink&quot; title=&quot;4. immediately extended to solve other vision tasks with minimal modification, including instance segmentation and key-point detection.&quot;&gt;&lt;/a&gt;4. immediately extended to solve other vision tasks with minimal modification, including instance segmentation and key-point detection.&lt;/h3&gt;&lt;p&gt;很小的改变就可以用于实例分割和关键点检测等领域。&lt;/p&gt;
&lt;h2 id=&quot;FCOS检测器&quot;&gt;&lt;a href=&quot;#FCOS检测器&quot; class=&quot;headerlink&quot; title=&quot;FCOS检测器&quot;&gt;&lt;/a&gt;FCOS检测器&lt;/h2&gt;&lt;h3 id=&quot;1-FCOS模型设计&quot;&gt;&lt;a href=&quot;#1-FCOS模型设计&quot; class=&quot;headerlink&quot; title=&quot;1. FCOS模型设计&quot;&gt;&lt;/a&gt;1. FCOS模型设计&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Different from anchor-based detectors, which consider the location on the input image as the center of (multiple) anchor boxes and regress the target bounding box with these anchor boxes as references, we directly regress the target bounding box at the location&lt;/p&gt;
&lt;p&gt;将Feature map上的点映射回原图后，不使用Anchor而是直接回归目标候选框的位置。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;If a location falls into multiple bounding boxes, it is considered as an ambiguous sample. We simply choose the bounding box with minimal area as its regression target. &lt;/p&gt;
&lt;p&gt;与DenseBox的思路一致：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;若Feature map上的点映射会原图，如果落入GT框中，则认为该点是正样本。&lt;/li&gt;
&lt;li&gt;&lt;p&gt;如果该位置同时落到了多个GT框中，选择回归到面积更小的候选框中。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;It is worth noting that FCOS can leverage as many fore- ground samples as possible to train the regressor. It is dif- ferent from anchor-based detectors, which only consider the anchor boxes with a highly enough IOU with ground-truth boxes as positive samples. We argue that it may be one of the reasons that FCOS outperforms its anchor-based counterparts.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code&gt;作者认为因为将Feature map上所有的点作为样本点，落入GT框的点都算正样本，会有更多的正样本加入回归器，而Anchor-based的检测器由于只使用那些与GT框 IOU较大的anchor作为训练样本。这可能是FCOS比anchor-based算法表现更好的原因。
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;img src=&quot;https://pic.superbed.cn/item/5de60fadf1f6f81c504fdf0e.png&quot; alt=&quot;model&quot;&gt;&lt;/p&gt;
&lt;p&gt;  从结构上来看，似乎与RetinaNet十分的相似。多了一个center-ness的branch！&lt;/p&gt;
&lt;h3 id=&quot;2-损失函数&quot;&gt;&lt;a href=&quot;#2-损失函数&quot; class=&quot;headerlink&quot; title=&quot;2. 损失函数&quot;&gt;&lt;/a&gt;2. 损失函数&lt;/h3&gt;&lt;p&gt;&lt;img src=&quot;https://pic2.superbed.cn/item/5de60fe6f1f6f81c504fe443.png&quot; alt=&quot;loss&quot;&gt;&lt;/p&gt;
&lt;p&gt;  分类使用Focal loss的分类损失函数，而回归则采用了IoU loss。&lt;/p&gt;
&lt;p&gt;   对feature map中所有点都会计算分类损失，而对正样本的点计算回归损失。&lt;/p&gt;
&lt;h2 id=&quot;FCOS多层级预测&quot;&gt;&lt;a href=&quot;#FCOS多层级预测&quot; class=&quot;headerlink&quot; title=&quot;FCOS多层级预测&quot;&gt;&lt;/a&gt;FCOS多层级预测&lt;/h2&gt;&lt;h3 id=&quot;1-模块解决问题&quot;&gt;&lt;a href=&quot;#1-模块解决问题&quot; class=&quot;headerlink&quot; title=&quot;1. 模块解决问题&quot;&gt;&lt;/a&gt;1. 模块解决问题&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;The large stride of the final feature maps in a CNN can result in a relatively low best possible recall (BPR)&lt;/p&gt;
&lt;p&gt;存在问题：感受野过大，导致小物体漏检，recall会比较低。对于FCOS而言，下降x16后，小物体的点可能也没有了，则会导致recall下降。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Overlaps in ground-truth boxes can cause intractable ambiguity&lt;/p&gt;
&lt;p&gt;真值框重叠的话会导致 训练的时候，特征图上的像素点不知道回归到哪一个真值框。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;2-we-directly-limit-the-range-of-bounding-box-regression-for-each-level&quot;&gt;&lt;a href=&quot;#2-we-directly-limit-the-range-of-bounding-box-regression-for-each-level&quot; class=&quot;headerlink&quot; title=&quot;2. we directly limit the range of bounding box regression for each level.&quot;&gt;&lt;/a&gt;2. we directly limit the range of bounding box regression for each level.&lt;/h3&gt;&lt;p&gt; we firstly compute the regression targets l∗, t∗, r∗ and b∗for each location on all feature levels. Next, if a location satisfies max(l∗, t∗, r∗, b∗) &amp;gt; mi or max(l∗, t∗, r∗, b∗) &amp;lt; mi−1, it is set as a negative sample and is thus not required to regress a bounding box any- more.&lt;/p&gt;
&lt;p&gt;Since objects with different sizes are assigned to different feature levels and most overlapping happens between ob- jects with considerably different sizes. If a location, even with multi-level prediction used, is still assigned to more than one ground-truth boxes, we simply choose the groundtruth box with minimal area as its target. &lt;/p&gt;
&lt;p&gt;FCOS在FPN每一层的特征图上都做回归，如果回归的得到的结果超过了预定的边界，则认为该像素点为负样本，在计算loss的时候不考虑该点。&lt;/p&gt;
&lt;p&gt; 在解决真值框重叠问题的情况中，作者是这样解释的，不同尺寸的物体是通过FPN的不同层检测出来的，大部分真值框重叠都是真值框大小不同的情况。在同一层特征图中，某一个像素点仍然分配到两个真值框的话，那就回归到那个面积更小的框！&lt;/p&gt;
&lt;h2 id=&quot;3-Center-ness-for-FCOS&quot;&gt;&lt;a href=&quot;#3-Center-ness-for-FCOS&quot; class=&quot;headerlink&quot; title=&quot;3. Center-ness for FCOS&quot;&gt;&lt;/a&gt;3. Center-ness for FCOS&lt;/h2&gt;&lt;h3 id=&quot;due-to-a-lot-of-low-quality-predicted-bounding-boxes-produced-by-locations-far-away-from-the-center-of-an-object&quot;&gt;&lt;a href=&quot;#due-to-a-lot-of-low-quality-predicted-bounding-boxes-produced-by-locations-far-away-from-the-center-of-an-object&quot; class=&quot;headerlink&quot; title=&quot;due to a lot of low-quality predicted bounding boxes produced by locations far away from the center of an object.&quot;&gt;&lt;/a&gt;due to a lot of low-quality predicted bounding boxes produced by locations far away from the center of an object.&lt;/h3&gt;&lt;p&gt;存在很多低质量，远离物体中心点的矩形框&lt;/p&gt;
&lt;h3 id=&quot;The-center-ness-depicts-the-normalized-distance-from-the-location-to-the-center-of-the-object&quot;&gt;&lt;a href=&quot;#The-center-ness-depicts-the-normalized-distance-from-the-location-to-the-center-of-the-object&quot; class=&quot;headerlink&quot; title=&quot;The center-ness depicts the normalized distance from the location to the center of the object&quot;&gt;&lt;/a&gt;The center-ness depicts the normalized distance from the location to the center of the object&lt;/h3&gt;&lt;h3 id=&quot;The-center-ness-ranges-from-0-to-1-and-is-thus-trained-with-binary-cross-entropy-BCE-loss-The-loss-is-added-to-the-loss-function-Eq-2-When-testing-the-final-score-used-for-ranking-the-detected-bounding-boxes-is-computed-by-multiplying-the-predicted-center-ness-with-the-correspond-ing-classification-score-Thus-the-center-ness-can-down-weight-the-scores-of-bounding-boxes-far-from-the-center-of-an-object&quot;&gt;&lt;a href=&quot;#The-center-ness-ranges-from-0-to-1-and-is-thus-trained-with-binary-cross-entropy-BCE-loss-The-loss-is-added-to-the-loss-function-Eq-2-When-testing-the-final-score-used-for-ranking-the-detected-bounding-boxes-is-computed-by-multiplying-the-predicted-center-ness-with-the-correspond-ing-classification-score-Thus-the-center-ness-can-down-weight-the-scores-of-bounding-boxes-far-from-the-center-of-an-object&quot; class=&quot;headerlink&quot; title=&quot;The center-ness ranges from 0 to 1 and is thus trained with binary cross entropy (BCE) loss. The loss is added to the loss function Eq. (2). When testing, the final score (used for ranking the detected bounding boxes) is computed by multiplying the predicted center-ness with the correspond- ing classification score. Thus the center-ness can down- weight the scores of bounding boxes far from the center of an object.&quot;&gt;&lt;/a&gt;The center-ness ranges from 0 to 1 and is thus trained with binary cross entropy (BCE) loss. The loss is added to the loss function Eq. (2). When testing, the final score (used for ranking the detected bounding boxes) is computed by multiplying the predicted center-ness with the correspond- ing classification score. Thus the center-ness can down- weight the scores of bounding boxes far from the center of an object.&lt;/h3&gt;&lt;p&gt;在训练阶段：center-ness用交叉熵损失函数，测试阶段：center-ness x classification score作为最后classification score的值，通过这种方式将远离中心点的候选框的置信度降低。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;FCOS-Fully-Convolutional-One-Stage-Object-Detection解读&quot;&gt;&lt;a href=&quot;#FCOS-Fully-Convolutional-One-Stage-Object-Detection解读&quot; class=&quot;heade
    
    </summary>
    
      <category term="论文阅读" scheme="http://chr10003566.github.io./categories/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/"/>
    
    
  </entry>
  
  <entry>
    <title>mmDetection源码分析（一）：inference阶段代码调用</title>
    <link href="http://chr10003566.github.io./2019/12/02/mmdetection(1)/"/>
    <id>http://chr10003566.github.io./2019/12/02/mmdetection(1)/</id>
    <published>2019-12-02T08:48:14.000Z</published>
    <updated>2019-12-02T09:57:04.368Z</updated>
    
    <content type="html">&lt;h1 id=&quot;mmdetection介绍&quot;&gt;&lt;a href=&quot;#mmdetection介绍&quot; class=&quot;headerlink&quot; title=&quot;mmdetection介绍&quot;&gt;&lt;/a&gt;mmdetection介绍&lt;/h1&gt;&lt;p&gt;mmDetection（&lt;a href=&quot;https://github.com/open-mmlab/mmdetection&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;mmdetection&lt;/a&gt;）应该是目前最流行的检测网络框架了，由香港中文大学与商汤合作维护的一个检测工具箱，目前仍然在不断的更新中。&lt;/p&gt;
&lt;p&gt;本系列打算研究学习下如何使用mmDetection去复现其他论文的检测网络模型或者构建自己的网络模型，以及如何使用mmDetection训练自己的数据。网上已有不少mmDetection源码分析博客，大家也都是按照各自学习的节奏来排版的，这里记录下学习的过程。&lt;/p&gt;
&lt;p&gt;照例将学习的链接贴出，尊重原创～&lt;/p&gt;
&lt;p&gt;DateLoader学习链接：&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://blog.csdn.net/u014380165/article/details/79058479&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;AI之路-PyTorch源码解读之torch.utils.data.DataLoader&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/76893455&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;一文弄懂Pytorch的DataLoader, DataSet, Sampler之间的关系&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://blog.csdn.net/TH_NUM/article/details/80877687&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;pytorch 函数DataLoade&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&quot;推理阶段—demo-py（通过读取一张图像，显示效果）&quot;&gt;&lt;a href=&quot;#推理阶段—demo-py（通过读取一张图像，显示效果）&quot; class=&quot;headerlink&quot; title=&quot;推理阶段—demo.py（通过读取一张图像，显示效果）&quot;&gt;&lt;/a&gt;推理阶段—&lt;code&gt;demo.py&lt;/code&gt;（通过读取一张图像，显示效果）&lt;/h1&gt;&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; mmdet.apis &lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; init_detector, inference_detector, show_result&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; mmcv&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;config_file = &lt;span class=&quot;string&quot;&gt;&#39;configs/faster_rcnn_r50_fpn_1x.py&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;checkpoint_file = &lt;span class=&quot;string&quot;&gt;&#39;checkpoints/faster_rcnn_r50_fpn_1x_20181010-3d1b3351.pth&#39;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# build the model from a config file and a checkpoint file&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;model = init_detector(config_file, checkpoint_file, device=&lt;span class=&quot;string&quot;&gt;&#39;cuda:0&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# test a single image and show the results&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;img = &lt;span class=&quot;string&quot;&gt;&#39;test.jpg&#39;&lt;/span&gt;  &lt;span class=&quot;comment&quot;&gt;# or img = mmcv.imread(img), which will only load it once&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;result = inference_detector(model, img)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# visualize the results in a new window&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;show_result(img, result, model.CLASSES)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# or save the visualization results to image files&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;show_result(img, result, model.CLASSES, out_file=&lt;span class=&quot;string&quot;&gt;&#39;result.jpg&#39;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;init-detector&quot;&gt;&lt;a href=&quot;#init-detector&quot; class=&quot;headerlink&quot; title=&quot;init_detector&quot;&gt;&lt;/a&gt;&lt;code&gt;init_detector&lt;/code&gt;&lt;/h2&gt;&lt;p&gt;init_detector三个输入参数：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;config：检测模型的配置文件，一般位于 mmdetection/config/ 中&lt;/li&gt;
&lt;li&gt;checkpoint：即训练好的权重 在mmdetection的model zoo中可以下载&lt;/li&gt;
&lt;li&gt;device：分配到的设备对象&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;返回：model（检测模型）&lt;/p&gt;
&lt;h2 id=&quot;inference-detector&quot;&gt;&lt;a href=&quot;#inference-detector&quot; class=&quot;headerlink&quot; title=&quot;inference_detector&quot;&gt;&lt;/a&gt;&lt;code&gt;inference_detector&lt;/code&gt;&lt;/h2&gt;&lt;p&gt;inference_detector 输入两个参数：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;model: init_detector返回的model&lt;/li&gt;
&lt;li&gt;imgs: 图像的路径&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;返回：测试图像的结果&lt;/p&gt;
&lt;h3 id=&quot;inference-single&quot;&gt;&lt;a href=&quot;#inference-single&quot; class=&quot;headerlink&quot; title=&quot;_ inference_single&quot;&gt;&lt;/a&gt;&lt;code&gt;_ inference_single&lt;/code&gt;&lt;/h3&gt;&lt;p&gt;将输入的图像进过resize后，输入到模型中。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;_prepare_data&lt;/p&gt;
&lt;p&gt;用于将图像转换成config中test.img_scale&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;inference-generator&quot;&gt;&lt;a href=&quot;#inference-generator&quot; class=&quot;headerlink&quot; title=&quot;_ inference_generator&quot;&gt;&lt;/a&gt;&lt;code&gt;_ inference_generator&lt;/code&gt;&lt;/h3&gt;&lt;h2 id=&quot;show-result&quot;&gt;&lt;a href=&quot;#show-result&quot; class=&quot;headerlink&quot; title=&quot;show_result&quot;&gt;&lt;/a&gt;&lt;code&gt;show_result&lt;/code&gt;&lt;/h2&gt;&lt;p&gt;show_result参数：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;img :图像的路径（字符串）&lt;/li&gt;
&lt;li&gt;result：inference_detector的返回值&lt;/li&gt;
&lt;li&gt;class_name：训练图像的类别名称&lt;br&gt;阈值&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;推理阶段—-tools-test-py（对数据集进行测试）&quot;&gt;&lt;a href=&quot;#推理阶段—-tools-test-py（对数据集进行测试）&quot; class=&quot;headerlink&quot; title=&quot;推理阶段—./tools/test.py（对数据集进行测试）&quot;&gt;&lt;/a&gt;推理阶段—&lt;code&gt;./tools/test.py&lt;/code&gt;（对数据集进行测试）&lt;/h1&gt;&lt;p&gt;通过&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;# single-gpu testing&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;python tools/test.py $&amp;#123;CONFIG_FILE&amp;#125; $&amp;#123;CHECKPOINT_FILE&amp;#125; [--out $&amp;#123;RESULT_FILE&amp;#125;] [--eval $&amp;#123;EVAL_METRICS&amp;#125;] [--show]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# multi-gpu testing&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;./tools/dist_test.sh $&amp;#123;CONFIG_FILE&amp;#125; $&amp;#123;CHECKPOINT_FILE&amp;#125; $&amp;#123;GPU_NUM&amp;#125; [--out $&amp;#123;RESULT_FILE&amp;#125;] [--eval $&amp;#123;EVAL_METRICS&amp;#125;]&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;build-dataset&quot;&gt;&lt;a href=&quot;#build-dataset&quot; class=&quot;headerlink&quot; title=&quot;build_dataset&quot;&gt;&lt;/a&gt;&lt;code&gt;build_dataset&lt;/code&gt;&lt;/h2&gt;&lt;p&gt;build_dataset一个输入参数：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;cfg.data.test&lt;/code&gt;: 是mmcv.utils.config.ConfigDict类型。cfg则是通过&lt;code&gt;mmcv.Config.fromfile&lt;/code&gt;(mmdetection/config/xx.py的路径）转换成&lt;code&gt;mmcv.utils.config.Config&lt;/code&gt;得到。&lt;code&gt;cfg.data.test&lt;/code&gt;：包含了测试集的路径，标注文件路径，测试图像大小等信息。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;返回：mmdet定义的Dataset类（是&lt;code&gt;torch.utils.data.Dataset&lt;/code&gt;的子类）&lt;/p&gt;
&lt;h2 id=&quot;build-dataloader&quot;&gt;&lt;a href=&quot;#build-dataloader&quot; class=&quot;headerlink&quot; title=&quot;build_dataloader&quot;&gt;&lt;/a&gt;&lt;code&gt;build_dataloader&lt;/code&gt;&lt;/h2&gt;&lt;p&gt;build_dataloader:将数据转换成pytorch可读的类型&lt;/p&gt;
&lt;p&gt;DataLoader的学习链接见上～&lt;/p&gt;
&lt;h2 id=&quot;build-detector&quot;&gt;&lt;a href=&quot;#build-detector&quot; class=&quot;headerlink&quot; title=&quot;build_detector&quot;&gt;&lt;/a&gt;&lt;code&gt;build_detector&lt;/code&gt;&lt;/h2&gt;&lt;p&gt;build_detector三个参数：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;cfg: 仍然是目标检测框架配置文件（如：faster_rcnn_r50_fpn_1x.py）中model部分。需要包括目标检测框架backbone、neck、head等部分信息&lt;/li&gt;
&lt;li&gt;train_cfg: 推理阶段，该参数为None&lt;/li&gt;
&lt;li&gt;test_cfg: cfg中test_cfg字段的内容，需要包含阈值等信息&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;init_detector中包含函数，init_detector=build_detector + load_checkpoint&lt;/p&gt;
&lt;h2 id=&quot;load-checkpoint&quot;&gt;&lt;a href=&quot;#load-checkpoint&quot; class=&quot;headerlink&quot; title=&quot;load_checkpoint&quot;&gt;&lt;/a&gt;&lt;code&gt;load_checkpoint&lt;/code&gt;&lt;/h2&gt;&lt;p&gt;load_checkpoint两个个主要输入参数：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;model：build_detecor返回的model&lt;/li&gt;
&lt;li&gt;checkpoint：训练权重（.pth，如 /models/faster_rcnn_r50_fpn_1x_20181010-3d1b3351.pth）&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;gpt-test&quot;&gt;&lt;a href=&quot;#gpt-test&quot; class=&quot;headerlink&quot; title=&quot;gpt_test&quot;&gt;&lt;/a&gt;gpt_test&lt;/h2&gt;&lt;h3 id=&quot;single-gpu-test&quot;&gt;&lt;a href=&quot;#single-gpu-test&quot; class=&quot;headerlink&quot; title=&quot;single_gpu_test&quot;&gt;&lt;/a&gt;&lt;code&gt;single_gpu_test&lt;/code&gt;&lt;/h3&gt;&lt;p&gt;single_gpu_test三个输入参数：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;model：build_detector返回的model，并通过 load_checkpoint初始化了权重。&lt;/li&gt;
&lt;li&gt;data_loader：build_dataloader返回的DataLoader&lt;/li&gt;
&lt;li&gt;show：默认为False&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;multi-gpu-test&quot;&gt;&lt;a href=&quot;#multi-gpu-test&quot; class=&quot;headerlink&quot; title=&quot;multi_gpu_test&quot;&gt;&lt;/a&gt;&lt;code&gt;multi_gpu_test&lt;/code&gt;&lt;/h3&gt;&lt;p&gt;与single_gpu_test相似，用多块GPU进行测试。&lt;/p&gt;
&lt;h2 id=&quot;eval&quot;&gt;&lt;a href=&quot;#eval&quot; class=&quot;headerlink&quot; title=&quot;eval&quot;&gt;&lt;/a&gt;eval&lt;/h2&gt;&lt;p&gt;调用&lt;code&gt;mmdet.core&lt;/code&gt;中&lt;code&gt;coco_eval&lt;/code&gt;，根据&lt;code&gt;eval_type&lt;/code&gt;对COCO数据集进行评估。&lt;/p&gt;
&lt;p&gt;eval_type有以下几种：&lt;br&gt;&lt;code&gt;&amp;#39;proposal&amp;#39;, &amp;#39;proposal_fast&amp;#39;, &amp;#39;bbox&amp;#39;, &amp;#39;segm&amp;#39;, &amp;#39;keypoints&amp;#39;&lt;/code&gt;.&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;mmdetection介绍&quot;&gt;&lt;a href=&quot;#mmdetection介绍&quot; class=&quot;headerlink&quot; title=&quot;mmdetection介绍&quot;&gt;&lt;/a&gt;mmdetection介绍&lt;/h1&gt;&lt;p&gt;mmDetection（&lt;a href=&quot;https
    
    </summary>
    
      <category term="mmDetection源码分析" scheme="http://chr10003566.github.io./categories/mmDetection%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/"/>
    
    
  </entry>
  
  <entry>
    <title>2D坐标系与3D坐标系的相互转换--python实现</title>
    <link href="http://chr10003566.github.io./2019/07/15/2D%E5%9D%90%E6%A0%87%E7%B3%BB%E4%B8%8E3D%E5%9D%90%E6%A0%87%E7%B3%BB%E7%9A%84%E7%9B%B8%E4%BA%92%E8%BD%AC%E6%8D%A2--python%E5%AE%9E%E7%8E%B0/"/>
    <id>http://chr10003566.github.io./2019/07/15/2D坐标系与3D坐标系的相互转换--python实现/</id>
    <published>2019-07-15T05:48:14.000Z</published>
    <updated>2019-07-15T09:22:14.999Z</updated>
    
    <content type="html">&lt;p&gt;并不是做关于SLAM方向的，但由于某些任务涉及到，故作此笔记～&lt;/p&gt;
&lt;p&gt;相机内参矩阵：&lt;br&gt;不同的的深度摄像头具有不同的特征参数，在计算机视觉里，将这组参数设置为相机的内参矩阵C:&lt;br&gt;$$\begin{bmatrix} f_x&amp;amp; 0 &amp;amp;c_x \\ 0 &amp;amp; f_y &amp;amp; c_y \\ 0 &amp;amp; 0 &amp;amp; 1  \end{bmatrix}$$&lt;/p&gt;
&lt;p&gt;  fx，fy指相机在x轴和y轴上的焦距，cx，cy是相机的光圈中心，这组参数是摄像头生产制作之后就固定的。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;世界坐标系:&lt;/strong&gt; 用户定义的三维师姐坐标系，以某个点为远点，为描述目标物在真实师姐里的位置而被引入&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;相机坐标系:&lt;/strong&gt; 以相机为原点建立的坐标系，为了从相机的角度描述物体的位置而定义，作为沟通世界坐标系和图像/像素坐标系的中间一环。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;学习自:&lt;/strong&gt; &lt;a href=&quot;https://blog.csdn.net/mightbxg/article/details/79363699&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;三维坐标变换——旋转矩阵与旋转向量&lt;/a&gt; &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img-blog.csdn.net/20161210141917167?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbnRyYXZlbGxpbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast&quot; alt=&quot;&quot;&gt; &lt;/p&gt;
&lt;p&gt;&lt;strong&gt;旋转矩阵:&lt;/strong&gt;&lt;br&gt;  &lt;img src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9hZTAxLmFsaWNkbi5jb20va2YvSFRCMTljZTVha1AyZ0swalNaUHhxNnljUXBYYWQuanBn&quot; alt=&quot;&quot;&gt; &lt;/p&gt;
&lt;p&gt;使用矩阵来表示一个旋转关系有两个缺点： 1）通过旋转矩阵不能直观地看出旋转的方向和角度 2）另一方面：旋转变换有3个自由度，旋转矩阵中的元素不是相互独立的。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;旋转向量:&lt;/strong&gt;&lt;br&gt;设旋转向量的单位向量为r，模为θ。三维点（或者说三维向量）p在旋转向量 r 的作用下变换至 p′，则：&lt;br&gt;$$p’=\cos\theta\cdot p+(1-\cos\theta)(p\cdot r)r+\sin\theta\cdot r \times$$ p&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;学习自:&lt;/strong&gt;&lt;a href=&quot;https://blog.csdn.net/chentravelling/article/details/53558096&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;计算机视觉：相机成像原理：世界坐标系、相机坐标系、图像坐标系、像素坐标系之间的转换&lt;/a&gt;&lt;br&gt;&lt;img src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9hZTAxLmFsaWNkbi5jb20va2YvSFRCMXo0aTZha1AyZ0swalNaUHhxNnljUXBYYVcuanBn&quot; alt=&quot;&quot;&gt; &lt;/p&gt;
&lt;p&gt;&lt;strong&gt;从世界坐标系到相机坐标系:&lt;/strong&gt;&lt;br&gt;&lt;img src=&quot;https://img-blog.csdn.net/20161210142437060?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbnRyYXZlbGxpbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast&quot; alt=&quot;&quot;&gt; &lt;/p&gt;
&lt;p&gt;&lt;strong&gt;相机坐标系与图像坐标系:&lt;/strong&gt;&lt;br&gt;&lt;img src=&quot;https://img-blog.csdn.net/20161210142740999?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbnRyYXZlbGxpbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast&quot; alt=&quot;&quot;&gt; &lt;/p&gt;
&lt;p&gt;&lt;strong&gt;图像坐标系与像素坐标系:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;像素坐标系和图像坐标系都在成像平面，只是各自的原点和度量单位不大一样，图像坐标系的原点为相机光轴与成像平面的交点。图像坐标系的单位是mm，属于物理单位，而像素坐标系的单位是pixel&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://img-blog.csdn.net/20161210143514044?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbnRyYXZlbGxpbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast&quot; alt=&quot;&quot;&gt; &lt;/p&gt;
&lt;p&gt;&lt;strong&gt;像素坐标系与世界坐标系:&lt;/strong&gt;&lt;br&gt;&lt;img src=&quot;https://img-blog.csdn.net/20161210144703071?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY2hlbnRyYXZlbGxpbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast&quot; alt=&quot;&quot;&gt; &lt;/p&gt;
&lt;h2 id=&quot;convert2Dto3D&quot;&gt;&lt;a href=&quot;#convert2Dto3D&quot; class=&quot;headerlink&quot; title=&quot;convert2Dto3D&quot;&gt;&lt;/a&gt;convert2Dto3D&lt;/h2&gt;&lt;p&gt;通过上面的公式，将像素坐标系的点映射到世界坐标系上，由于二维坐标映射到三维坐标会多了一个深度信息，因此二维点映射到三维坐标系，得到的是一条射线。虽然通过下面的代码得到的确实是一个三维的坐标点，但是其实是不确定的，与光点连线上（射线）所有的点都满足条件&lt;/p&gt;
&lt;h2 id=&quot;convert3Dto2D&quot;&gt;&lt;a href=&quot;#convert3Dto2D&quot; class=&quot;headerlink&quot; title=&quot;convert3Dto2D&quot;&gt;&lt;/a&gt;convert3Dto2D&lt;/h2&gt;&lt;p&gt;将3D平面的box转成2D平面的box，通过cv.projectPoint(三维平面下的8个点，旋转矩阵， 平移向量， 相机内参， 0)可以得到3D平面下的8个点映射到2维平面下8个点的坐标&lt;/p&gt;
&lt;h2 id=&quot;代码&quot;&gt;&lt;a href=&quot;#代码&quot; class=&quot;headerlink&quot; title=&quot;代码&quot;&gt;&lt;/a&gt;代码&lt;/h2&gt;&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;85&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 此函数只是外部定义而已，大家可自行定义&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;camera_matrix, rvec, tvec = camera_params()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;print(&lt;span class=&quot;string&quot;&gt;&quot;相机内参:&quot;&lt;/span&gt;, camera_matrix)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;print(&lt;span class=&quot;string&quot;&gt;&quot;平移向量:&quot;&lt;/span&gt;, tvec)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;print(&lt;span class=&quot;string&quot;&gt;&quot;旋转矩阵:&quot;&lt;/span&gt;, rvec)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# (R T, 0 1)矩阵&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Trans = np.hstack((rvec, [[tvec[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;]], [tvec[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;]], [tvec[&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;]]]))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 相机内参和相机外参 矩阵相乘&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;temp = np.dot(camera_matrix, Trans)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Pp = np.linalg.pinv(temp)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 点（u, v, 1) 对应代码里的 [605,341,1]&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;p1 = np.array([&lt;span class=&quot;number&quot;&gt;605&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;341&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;], np.float)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;print(&lt;span class=&quot;string&quot;&gt;&quot;像素坐标系的点:&quot;&lt;/span&gt;, p1)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;X = np.dot(Pp, p1)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;print(&lt;span class=&quot;string&quot;&gt;&quot;X:&quot;&lt;/span&gt;, X)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 与Zc相除 得到世界坐标系的某一个点&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;X1 = np.array(X[:&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;], np.float)/X[&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;print(&lt;span class=&quot;string&quot;&gt;&quot;X1:&quot;&lt;/span&gt;, X1)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;## 3D 转成 2D&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;from&lt;/span&gt; utils &lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; *&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; numpy &lt;span class=&quot;keyword&quot;&gt;as&lt;/span&gt; np&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; cv2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;## 2D 转成 3D&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 此函数只是外部定义而已，大家可自行定义&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;camera_matrix, rvec, tvec = camera_params()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;print(&lt;span class=&quot;string&quot;&gt;&quot;相机内参:&quot;&lt;/span&gt;, camera_matrix)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;print(&lt;span class=&quot;string&quot;&gt;&quot;平移向量:&quot;&lt;/span&gt;, tvec)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;print(&lt;span class=&quot;string&quot;&gt;&quot;旋转矩阵:&quot;&lt;/span&gt;, rvec)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# (R T, 0 1)矩阵&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Trans = np.hstack((rvec, [[tvec[&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;]], [tvec[&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;]], [tvec[&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;]]]))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 相机内参和相机外参 矩阵相乘&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;temp = np.dot(camera_matrix, Trans)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Pp = np.linalg.pinv(temp)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 点（u, v, 1) 对应代码里的 [605,341,1]&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;p1 = np.array([&lt;span class=&quot;number&quot;&gt;605&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;341&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;], np.float)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;print(&lt;span class=&quot;string&quot;&gt;&quot;像素坐标系的点:&quot;&lt;/span&gt;, p1)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;X = np.dot(Pp, p1)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;print(&lt;span class=&quot;string&quot;&gt;&quot;X:&quot;&lt;/span&gt;, X)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# 与Zc相除 得到世界坐标系的某一个点&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;X1 = np.array(X[:&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;], np.float)/X[&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;print(&lt;span class=&quot;string&quot;&gt;&quot;X1:&quot;&lt;/span&gt;, X1)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;## 3D 转成 2D&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;## cube为世界坐标系的8个点的三维坐标&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cube = np.float64([[&lt;span class=&quot;number&quot;&gt;-3.102&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;-1.58400011&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;9.29399872&lt;/span&gt;],[&lt;span class=&quot;number&quot;&gt;-3.102&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;-0.08400005&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;9.29399872&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; ,[&lt;span class=&quot;number&quot;&gt;-1.27200007&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;-0.08400005&lt;/span&gt; , &lt;span class=&quot;number&quot;&gt;9.29399872&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; ,[&lt;span class=&quot;number&quot;&gt;-1.27200007&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;-1.58400011&lt;/span&gt;  ,&lt;span class=&quot;number&quot;&gt;9.29399872&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; ,[&lt;span class=&quot;number&quot;&gt;-3.102&lt;/span&gt;   ,   &lt;span class=&quot;number&quot;&gt;-1.58400011&lt;/span&gt; ,&lt;span class=&quot;number&quot;&gt;13.8939991&lt;/span&gt; ]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; ,[&lt;span class=&quot;number&quot;&gt;-3.102&lt;/span&gt;   ,   &lt;span class=&quot;number&quot;&gt;-0.08400005&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;13.8939991&lt;/span&gt; ]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; ,[&lt;span class=&quot;number&quot;&gt;-1.27200007&lt;/span&gt; ,&lt;span class=&quot;number&quot;&gt;-0.08400005&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;13.8939991&lt;/span&gt; ]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; ,[&lt;span class=&quot;number&quot;&gt;-1.27200007&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;-1.58400011&lt;/span&gt; ,&lt;span class=&quot;number&quot;&gt;13.8939991&lt;/span&gt; ]])&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;result, _ = cv2.projectPoints(cube, rvec, tvec, camera_matrix, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;print(&lt;span class=&quot;string&quot;&gt;&quot;3D to 2D 的 8个点的坐标：&quot;&lt;/span&gt;, result)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;并不是做关于SLAM方向的，但由于某些任务涉及到，故作此笔记～&lt;/p&gt;
&lt;p&gt;相机内参矩阵：&lt;br&gt;不同的的深度摄像头具有不同的特征参数，在计算机视觉里，将这组参数设置为相机的内参矩阵C:&lt;br&gt;$$\begin{bmatrix} f_x&amp;amp; 0 &amp;amp;c_x \
    
    </summary>
    
      <category term="work" scheme="http://chr10003566.github.io./categories/work/"/>
    
    
  </entry>
  
  <entry>
    <title>Java中的多线程实现方式</title>
    <link href="http://chr10003566.github.io./2017/03/03/Java%E4%B8%AD%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F/"/>
    <id>http://chr10003566.github.io./2017/03/03/Java中的多线程实现方式/</id>
    <published>2017-03-03T03:31:44.000Z</published>
    <updated>2017-03-03T04:05:10.000Z</updated>
    
    <content type="html">&lt;h1 id=&quot;Java中的多线程实现方式&quot;&gt;&lt;a href=&quot;#Java中的多线程实现方式&quot; class=&quot;headerlink&quot; title=&quot;Java中的多线程实现方式&quot;&gt;&lt;/a&gt;Java中的多线程实现方式&lt;/h1&gt;&lt;p&gt;在我们的开发的过程中，常常会碰到多线程的问题，对于多线程的实现方式主要有两种：&lt;strong&gt;实现Runnable接口&lt;/strong&gt;、&lt;strong&gt;集成Thread类&lt;/strong&gt;。对于这两种多线程实现的方式也是有一些差异的。网上针对此问题基本都是使用&lt;strong&gt;买票系统&lt;/strong&gt;的例子，接下来我们就用代码来模拟下售票系统，实现2个售票点发售10张车票，一个售票点表示一个线程。&lt;/p&gt;
&lt;h2 id=&quot;方案一&quot;&gt;&lt;a href=&quot;#方案一&quot; class=&quot;headerlink&quot; title=&quot;方案一&quot;&gt;&lt;/a&gt;方案一&lt;/h2&gt;&lt;p&gt;首先从最简单的做法开始，开两个Thread类进行售票。&lt;br&gt;&lt;strong&gt;测试代码如下&lt;/strong&gt;：&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ticketThread&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Thread&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; ticket = &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i &amp;lt; &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;; i++)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(ticket &amp;gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;					sleep(&lt;span class=&quot;number&quot;&gt;1000&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;					System.out.println(Thread.currentThread().getName() &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;							+ &lt;span class=&quot;string&quot;&gt;&quot;卖票 ——&amp;gt;&quot;&lt;/span&gt; + (ticket--) );					&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (Exception e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;					&lt;span class=&quot;comment&quot;&gt;// &lt;span class=&quot;doctag&quot;&gt;TODO:&lt;/span&gt; handle exception&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;					e.printStackTrace();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String[] args)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;comment&quot;&gt;// TODO Auto-generated method stub&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; ticketThread().start();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; ticketThread().start();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;测试结果：&lt;/strong&gt;&lt;br&gt;Thread-0卖票 ——&amp;gt;10&lt;br&gt;&lt;br&gt;Thread-1卖票 ——&amp;gt;10&lt;br&gt;&lt;br&gt;Thread-1卖票 ——&amp;gt;9&lt;br&gt;&lt;br&gt;Thread-0卖票 ——&amp;gt;9&lt;br&gt;&lt;br&gt;Thread-1卖票 ——&amp;gt;8&lt;br&gt;&lt;br&gt;Thread-0卖票 ——&amp;gt;8&lt;br&gt;&lt;br&gt;Thread-1卖票 ——&amp;gt;7&lt;br&gt;&lt;br&gt;Thread-0卖票 ——&amp;gt;7&lt;br&gt;&lt;br&gt;Thread-0卖票 ——&amp;gt;6&lt;br&gt;&lt;br&gt;Thread-1卖票 ——&amp;gt;6&lt;br&gt;&lt;br&gt;Thread-0卖票 ——&amp;gt;5&lt;br&gt;&lt;br&gt;Thread-1卖票 ——&amp;gt;5&lt;br&gt;&lt;br&gt;Thread-1卖票 ——&amp;gt;4&lt;br&gt;&lt;br&gt;Thread-0卖票 ——&amp;gt;4&lt;br&gt;&lt;br&gt;Thread-1卖票 ——&amp;gt;3&lt;br&gt;&lt;br&gt;Thread-0卖票 ——&amp;gt;3&lt;br&gt;&lt;br&gt;Thread-1卖票 ——&amp;gt;2&lt;br&gt;&lt;br&gt;Thread-0卖票 ——&amp;gt;2&lt;br&gt;&lt;br&gt;Thread-0卖票 ——&amp;gt;1&lt;br&gt;&lt;br&gt;Thread-1卖票 ——&amp;gt;1&lt;br&gt;&lt;br&gt;&lt;strong&gt;结论：&lt;/strong&gt;&lt;br&gt;从上面的测试结果可以看出，两个线程各自卖了各自的10张票而不是去卖共同的10张票，这和我们的目标多个线程去处理同一个资源相差很多。我们创建了2个&lt;code&gt;ticketThread&lt;/code&gt;对象就等于创建了2个资源，每个资源有10张票，每个资源都在独自处理各自的资源。所以通过这个例子我们知道，在这个售票系统中，我们只能创建一个资源对象，但需要创建多个线程去处理同一个资源对象，并且每个线程上所运行的是相同的程序代码。&lt;/p&gt;
&lt;h2 id=&quot;方案二&quot;&gt;&lt;a href=&quot;#方案二&quot; class=&quot;headerlink&quot; title=&quot;方案二&quot;&gt;&lt;/a&gt;方案二&lt;/h2&gt;&lt;p&gt;既然只能创建一个资源对象，那么我就只创建一个&lt;code&gt;ticketThread&lt;/code&gt;，在额外创建两个新的线程去实现售票。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;测试代码：&lt;/strong&gt;&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ticketThread&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Thread&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; ticket = &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i &amp;lt; &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;; i++)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&lt;span class=&quot;keyword&quot;&gt;synchronized&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(ticket &amp;gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;					&lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;						sleep(&lt;span class=&quot;number&quot;&gt;1000&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;						System.out.println(Thread.currentThread().getName() &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;								+ &lt;span class=&quot;string&quot;&gt;&quot;卖票 ——&amp;gt;&quot;&lt;/span&gt; + (&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.ticket--) );					&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;					&amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (Exception e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;						&lt;span class=&quot;comment&quot;&gt;// &lt;span class=&quot;doctag&quot;&gt;TODO:&lt;/span&gt; handle exception&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;						e.printStackTrace();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;					&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String[] args)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;comment&quot;&gt;// TODO Auto-generated method stub&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		ticketThread t1 = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; ticketThread();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Thread(t1, &lt;span class=&quot;string&quot;&gt;&quot;线程1&quot;&lt;/span&gt;).start();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Thread(t1, &lt;span class=&quot;string&quot;&gt;&quot;线程2&quot;&lt;/span&gt;).start();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;测试结果：&lt;/strong&gt;&lt;br&gt;线程1卖票 ——&amp;gt;10&lt;br&gt;&lt;br&gt;线程1卖票 ——&amp;gt;9&lt;br&gt;&lt;br&gt;线程2卖票 ——&amp;gt;8&lt;br&gt;&lt;br&gt;线程2卖票 ——&amp;gt;7&lt;br&gt;&lt;br&gt;线程2卖票 ——&amp;gt;6&lt;br&gt;&lt;br&gt;线程1卖票 ——&amp;gt;5&lt;br&gt;&lt;br&gt;线程1卖票 ——&amp;gt;4&lt;br&gt;&lt;br&gt;线程2卖票 ——&amp;gt;3&lt;br&gt;&lt;br&gt;线程2卖票 ——&amp;gt;2&lt;br&gt;&lt;br&gt;线程2卖票 ——&amp;gt;1&lt;br&gt;&lt;br&gt;&lt;strong&gt;结论：&lt;/strong&gt;&lt;br&gt;这种情况下，我们实现了多个线程对同一个资源进行处理。这里我们创建新线程使用了&lt;br&gt;&lt;code&gt;Thread(ThreadGroup groupOb, String threadName)&lt;/code&gt;&lt;br&gt;把&lt;code&gt;ticketThread&lt;/code&gt;作为参数传入新创建的线程。在这种情况下新创建的两个线程就去执行了&lt;code&gt;ticketThread&lt;/code&gt;中的&lt;code&gt;run()&lt;/code&gt;方法，这样一来就实现了两个线程对同一个资源进行处理。但就原理上来说，此方案与方案三是一样的。&lt;/p&gt;
&lt;h2 id=&quot;方案三&quot;&gt;&lt;a href=&quot;#方案三&quot; class=&quot;headerlink&quot; title=&quot;方案三&quot;&gt;&lt;/a&gt;方案三&lt;/h2&gt;&lt;p&gt;使用&lt;code&gt;Runnable&lt;/code&gt;来实现多线程。&lt;br&gt;&lt;strong&gt;测试代码：&lt;/strong&gt;&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;ticketThread&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Runnable&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; ticket = &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i &amp;lt; &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;; i++)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//			synchronized(this)&amp;#123;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(ticket &amp;gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;					&lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;						Thread.sleep(&lt;span class=&quot;number&quot;&gt;1000&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;						System.out.println(Thread.currentThread().getName() &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;								+ &lt;span class=&quot;string&quot;&gt;&quot;卖票 ——&amp;gt;&quot;&lt;/span&gt; + (ticket--) );	 &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;					&amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (Exception e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;						&lt;span class=&quot;comment&quot;&gt;// &lt;span class=&quot;doctag&quot;&gt;TODO:&lt;/span&gt; handle exception&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;						e.printStackTrace();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;					&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;				&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;			&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//		&amp;#125;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String[] args)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;comment&quot;&gt;// TODO Auto-generated method stub&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		ticketThread t1 = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; ticketThread();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Thread(t1, &lt;span class=&quot;string&quot;&gt;&quot;线程1&quot;&lt;/span&gt;).start();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Thread(t1, &lt;span class=&quot;string&quot;&gt;&quot;线程2&quot;&lt;/span&gt;).start();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;测试结果：&lt;/strong&gt;&lt;br&gt;线程1卖票 ——&amp;gt;10&lt;br&gt;&lt;br&gt;线程2卖票 ——&amp;gt;9&lt;br&gt;&lt;br&gt;线程2卖票 ——&amp;gt;7&lt;br&gt;&lt;br&gt;线程1卖票 ——&amp;gt;8&lt;br&gt;&lt;br&gt;线程1卖票 ——&amp;gt;6&lt;br&gt;&lt;br&gt;线程2卖票 ——&amp;gt;5&lt;br&gt;&lt;br&gt;线程1卖票 ——&amp;gt;4&lt;br&gt;&lt;br&gt;线程2卖票 ——&amp;gt;3&lt;br&gt;&lt;br&gt;线程2卖票 ——&amp;gt;2&lt;br&gt;&lt;br&gt;线程1卖票 ——&amp;gt;1&lt;br&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;结论&lt;/strong&gt;&lt;br&gt;在上面的测试代码中，我们创建了2个线程，每个县城调用的是同一个&lt;code&gt;ticketThread&lt;/code&gt;对象中的&lt;code&gt;run()&lt;/code&gt;方法，访问的是同一个对象的变量&lt;code&gt;(ticket)&lt;/code&gt;的实例，这个程序就完美的满足了我们的需求。&lt;/p&gt;
&lt;h3 id=&quot;Runnable与Thread的区别与联系&quot;&gt;&lt;a href=&quot;#Runnable与Thread的区别与联系&quot; class=&quot;headerlink&quot; title=&quot;Runnable与Thread的区别与联系&quot;&gt;&lt;/a&gt;Runnable与Thread的区别与联系&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;一个类只能继承一个父类，这是使用&lt;code&gt;Thread&lt;/code&gt;的局限性，而&lt;code&gt;Runnable&lt;/code&gt;是一个接口，只要实现这个接口就行了。所以在实际的开发过程中，是通过&lt;code&gt;Runnable&lt;/code&gt;接口来实现的，并且&lt;code&gt;Runnable&lt;/code&gt;更适合资源共享的实现。&lt;/li&gt;
&lt;li&gt;使用&lt;code&gt;Runnable&lt;/code&gt;可以比喵由于Java的单继承特性带来的局限性，我们经常碰到这样一种情况，即当我们要已经继承了某一个累的子类放入多线程中，由于一个类不能同时偶两个父类，所以不能用继承Thread类的方式，那么这个类就是只能采用Runnable接口的方式了。&lt;/li&gt;
&lt;li&gt;实际上&lt;code&gt;Thread类&lt;/code&gt;也是&lt;code&gt;Runnbale&lt;/code&gt;接口的子类。&lt;br&gt;&lt;code&gt;public class Thread extends Object implements Runnable&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;使用&lt;code&gt;Runnable&lt;/code&gt;对象时，&lt;code&gt;Runnable&lt;/code&gt;定义的子类没有&lt;code&gt;start()&lt;/code&gt;方法，只有&lt;code&gt;Thread&lt;/code&gt;类中才有，观察&lt;code&gt;Thread&lt;/code&gt;类，有一个构造方法&lt;code&gt;public Thread(Runnable target)&lt;/code&gt;，此构造方法接受&lt;code&gt;Runanble&lt;/code&gt;的子类实例，也就是说可以通过&lt;code&gt;Thread&lt;/code&gt;类来启动&lt;code&gt;Runnable&lt;/code&gt;实现多线程。&lt;/li&gt;
&lt;/ol&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Java中的多线程实现方式&quot;&gt;&lt;a href=&quot;#Java中的多线程实现方式&quot; class=&quot;headerlink&quot; title=&quot;Java中的多线程实现方式&quot;&gt;&lt;/a&gt;Java中的多线程实现方式&lt;/h1&gt;&lt;p&gt;在我们的开发的过程中，常常会碰到多线程的问题，对于多
    
    </summary>
    
      <category term="Java开发学习" scheme="http://chr10003566.github.io./categories/Java%E5%BC%80%E5%8F%91%E5%AD%A6%E4%B9%A0/"/>
    
    
  </entry>
  
  <entry>
    <title>Android开发学习笔记秘籍(二十一)</title>
    <link href="http://chr10003566.github.io./2017/01/04/tips/"/>
    <id>http://chr10003566.github.io./2017/01/04/tips/</id>
    <published>2017-01-04T03:31:44.000Z</published>
    <updated>2017-12-09T13:23:56.575Z</updated>
    
    <content type="html">&lt;h1 id=&quot;Android开发学习笔记秘籍-二十一&quot;&gt;&lt;a href=&quot;#Android开发学习笔记秘籍-二十一&quot; class=&quot;headerlink&quot; title=&quot;Android开发学习笔记秘籍(二十一)&quot;&gt;&lt;/a&gt;Android开发学习笔记秘籍(二十一)&lt;/h1&gt;&lt;p&gt;时隔半年重新捡起Android开发，以前学习的各种零零散散的Android开发技巧也忘的差不多了，但人总不能走回头路吧，只能猛向前走，遗忘的呢也正好通过翻阅以前的笔记进行复习。&lt;/p&gt;
&lt;p&gt;以前都是学习一些UI方面的知识，很少涉及网络。现在开始往网络方向学习。&lt;/p&gt;
&lt;p&gt;首先是最简单的一些Android小知识点，网上都有。大都一样，我也不知道哪个是原创就不贴链接了。纯粹为了以后自己好用！&lt;/p&gt;
&lt;h2 id=&quot;Android小知识点：&quot;&gt;&lt;a href=&quot;#Android小知识点：&quot; class=&quot;headerlink&quot; title=&quot;Android小知识点：&quot;&gt;&lt;/a&gt;Android小知识点：&lt;/h2&gt;&lt;p&gt;检查Android手机网络是否可用：&lt;/p&gt;
&lt;p&gt;1.获取ConnectivityManager对象&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;    Context context = activity.getApplicationContext();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 获取手机所有连接管理对象（包括对wi-fi,net等连接的管理）&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ConnectivityManager connectivityManager = (ConnectivityManager)context.getSystemService(Context.CONNECTIVITY_SERVICE);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;2.获取NetworkInfo对象&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;NetworkInfo[] networkInfo = connectivityManager.getAllNetworkInfo();&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;3.判断当前网络状态是否未连接在状态&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;if (networkInfo[i].getState() == NetworkInfo.State.CONNECTED)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      return true;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;另外还需要在&lt;code&gt;AndroidManifest.xml&lt;/code&gt;当中添加访问当前网络状态权限&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&amp;lt;uses-permission android:name=&amp;quot;android.permission.ACCESS_NETWORK_STATE&amp;quot;&amp;gt;&amp;lt;/uses-permission&amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;接下来就是重头戏了—-AsyncHttpClient开源库&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://my.oschina.net/u/725054/blog/494494&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;学习链接&lt;/a&gt;：&lt;a href=&quot;https://my.oschina.net/u/725054/blog/494494&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://my.oschina.net/u/725054/blog/494494&lt;/a&gt;&lt;br&gt;这个是一年前的一个在Apache的HttpCLient库的基础上开发构建而成的。现在还常不常用我就不清楚了，不过学习下总是对自己有帮助的。&lt;/p&gt;
&lt;p&gt;网上关于&lt;code&gt;AsyncHttpClient&lt;/code&gt;的介绍呢，统统都是来自官网的翻译—&lt;a href=&quot;http://loopj.com/android-async-http/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://loopj.com/android-async-http/&lt;/a&gt;&lt;br&gt;&lt;br&gt; github—&lt;a href=&quot;https://github.com/loopj/android-async-http&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/loopj/android-async-http&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;上面的学习链接是个人认为翻译的比较好的，但光有方法使用，没有实例可不行，于是乎自己找了知乎日报的API来测试学习。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/iKrelve/KuaiHu/blob/master/%E7%9F%A5%E4%B9%8E%E6%97%A5%E6%8A%A5API.md&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;知乎日报API&lt;/a&gt;：&lt;a href=&quot;https://github.com/iKrelve/KuaiHu/blob/master/%E7%9F%A5%E4%B9%8E%E6%97%A5%E6%8A%A5API.md&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/iKrelve/KuaiHu/blob/master/%E7%9F%A5%E4%B9%8E%E6%97%A5%E6%8A%A5API.md&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;然后发现大神也使用了这个库，瞬间感觉这个库还是很6的。&lt;/p&gt;
&lt;p&gt;看了学习链接的知识，应该知道要使用&lt;code&gt;AsyncHttpClient.get()&lt;/code&gt;,里面的参数一个Url，一个是要我们实现的匿名内部类。看上去还是很简单的，用起来就更简单了。&lt;/p&gt;
&lt;p&gt;首先拿一个简单的来试试用法，就拿启动界面图像获取这个Url来测试。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Android开发学习笔记秘籍-二十一&quot;&gt;&lt;a href=&quot;#Android开发学习笔记秘籍-二十一&quot; class=&quot;headerlink&quot; title=&quot;Android开发学习笔记秘籍(二十一)&quot;&gt;&lt;/a&gt;Android开发学习笔记秘籍(二十一)&lt;/h1&gt;&lt;p&gt;
    
    </summary>
    
      <category term="Android开发" scheme="http://chr10003566.github.io./categories/Android%E5%BC%80%E5%8F%91/"/>
    
    
  </entry>
  
  <entry>
    <title>RecyclerView总结学习(二)</title>
    <link href="http://chr10003566.github.io./2016/06/28/recyclerView2/"/>
    <id>http://chr10003566.github.io./2016/06/28/recyclerView2/</id>
    <published>2016-06-28T09:25:18.000Z</published>
    <updated>2016-06-28T09:31:12.000Z</updated>
    
    <content type="html">&lt;h1 id=&quot;RecyclerView总结学习（二）&quot;&gt;&lt;a href=&quot;#RecyclerView总结学习（二）&quot; class=&quot;headerlink&quot; title=&quot;RecyclerView总结学习（二）&quot;&gt;&lt;/a&gt;RecyclerView总结学习（二）&lt;/h1&gt;&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;上一篇学习了下RecyclerView的基本使用，主要是一些基本操作。回顾下：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;RecyclerView 是Android L版本中新添加的一个用来取代ListView的SDK，它的灵活性与可替代性比listview更好.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;首先还是POST出我的学习链接：&lt;br&gt;&lt;a href=&quot;http://blog.csdn.net/lmj623565791/article/details/44014941&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://blog.csdn.net/lmj623565791/article/details/44014941&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://blog.csdn.net/lmj623565791/article/details/51118836&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://blog.csdn.net/lmj623565791/article/details/51118836&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://github.com/hongyangAndroid/base-adapter&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/hongyangAndroid/base-adapter&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2015/1120/3705.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2015/1120/3705.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;要使用RecyclerView你需要做一些几件事情:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;设置布局管理器LayoutManager，控制其显示的方式。&lt;/li&gt;
&lt;li&gt;通过ItemDecoration来设置Item间的间隔。&lt;/li&gt;
&lt;li&gt;通过ItemAnimator来设置Item间的增删动画。&lt;/li&gt;
&lt;li&gt;自写RecyclerView.Adapter。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Adapter要自己来写，这多麻烦啊。还不像ListView可以使用多种适配器像ArrayAdapter、SimpleAdapter等等啊。RecyclerView还必须使用ViewHolder。但是总有大神会帮你解决这些问题的！&lt;/p&gt;
&lt;p&gt;在RecyclerView没出来之前就有ListView的万能适配器了，既然RecyclerView相似，那么适配器上也可以有所借鉴了。&lt;/p&gt;
&lt;p&gt;本文主要学习两种RecyclerView的万能适配器的使用，第一种是鸿洋老师写的万能适配器，第二种是陈宇明老师的万能适配器。从使用上来看陈宇明老师的适配器功能更加完善。本文只学习使用并不研究代码~&lt;/p&gt;
&lt;h2 id=&quot;万能适配器（一）&quot;&gt;&lt;a href=&quot;#万能适配器（一）&quot; class=&quot;headerlink&quot; title=&quot;万能适配器（一）&quot;&gt;&lt;/a&gt;万能适配器（一）&lt;/h2&gt;&lt;h3 id=&quot;使用方法&quot;&gt;&lt;a href=&quot;#使用方法&quot; class=&quot;headerlink&quot; title=&quot;使用方法&quot;&gt;&lt;/a&gt;使用方法&lt;/h3&gt;&lt;p&gt;首先要使用鸿洋老师的万能适配器，你要在你的&lt;code&gt;build.gradle&lt;/code&gt;中添加&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;compile &amp;apos;com.android.support:recyclerview-v7:23.2.0&amp;apos;//使用RecyclerView&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;compile &amp;apos;com.zhy:base-adapter:2.0.0&amp;apos;//使用万能适配器&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;对于简单的RecyclerView即从鸿洋老师的例子来看是只有一个ItemType的RecyclerView，比如下面这种形式统一的RecyclerView。&lt;br&gt;&lt;img src=&quot;http://7xtcu9.com1.z0.glb.clouddn.com/QQ%E6%88%AA%E5%9B%BE20160618151930.png&quot; alt=&quot;enter image description here&quot;&gt;&lt;/p&gt;
&lt;p&gt;要实现上面的效果你只需要在完成以下几件事情：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;数据封装，以及数据集的准备。&lt;/li&gt;
&lt;li&gt;设置布局管理器和分割线，通过以下代码设置：&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;mRecyclerView.setLayoutManager(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; LinearLayoutManager(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mRecyclerView.addItemDecoration(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; DividerItemDecoration(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;, DividerItemDecoration.VERTICAL_LIST));&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;如果使用CardView的话可以不设置分割线…&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;完成&lt;code&gt;item_list.xml&lt;/code&gt;的编写，这个就是&lt;code&gt;RecylerView&lt;/code&gt;每一项的布局格式，本人测试的&lt;code&gt;item_list.xml&lt;/code&gt;如下：&lt;/p&gt;
&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;	&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;android.support.v7.widget.CardView&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;xmlns:android&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;http://schemas.android.com/apk/res/android&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;android:layout_marginTop&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;10dp&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;android:orientation&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;horizontal&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;android:layout_width&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;match_parent&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;android:layout_height&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;wrap_content&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;LinearLayout&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;attr&quot;&gt;android:layout_width&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;match_parent&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;attr&quot;&gt;android:layout_height&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;wrap_content&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;ImageView&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;attr&quot;&gt;android:id&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;@+id/icon1&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;attr&quot;&gt;android:layout_width&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;0dp&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;attr&quot;&gt;android:layout_height&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;wrap_content&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;attr&quot;&gt;android:layout_weight&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;1&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            /&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;TextView&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;attr&quot;&gt;android:id&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;@+id/name&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;attr&quot;&gt;android:layout_width&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;0dp&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;attr&quot;&gt;android:layout_height&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;wrap_content&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;attr&quot;&gt;android:layout_weight&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;1&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;attr&quot;&gt;android:text&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;li&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;TextView&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;attr&quot;&gt;android:id&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;@+id/info1&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;attr&quot;&gt;android:layout_width&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;0dp&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;attr&quot;&gt;android:layout_height&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;wrap_content&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;attr&quot;&gt;android:layout_weight&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;2&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            /&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;LinearLayout&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;android.support.v7.widget.CardView&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;使用万能适配器，代码如下：&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;recyclerView.setAdapter(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; CommonAdapter&amp;lt;Persons&amp;gt;(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;, R.layout.item_list, mDatas) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;convert&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(ViewHolder holder, Persons persons)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                holder.setText(R.id.name, persons.getName());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                holder.setText(R.id.info1, persons.getInfo());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                holder.setImageResource(R.id.icon1, persons.getIcon());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;可以看到适配器这部分的代码确实简单了很多，以往还得自己写个Adapter，现在只要将数据和相应的视图对应就可以了。相当的方便。这样的话那些数据项是统一样式的RecyclerView就能够几句话完成适配了！&lt;/p&gt;
&lt;h3 id=&quot;多个ItemViewTyped的RecyclerView&quot;&gt;&lt;a href=&quot;#多个ItemViewTyped的RecyclerView&quot; class=&quot;headerlink&quot; title=&quot;多个ItemViewTyped的RecyclerView&quot;&gt;&lt;/a&gt;多个ItemViewTyped的RecyclerView&lt;/h3&gt;&lt;p&gt;针对于多个ItemViewType的RecyclerView则可以通过MutiItemCommonAdapter来实现，比如鸿洋大神Sample里的聊天记录的展示。这个的代码实现就没有上面那么简单了，需要自己写一个适配器（这也是理所应当的，不然谁知道你哪种情况下需要使用哪种视图展示啊）。&lt;br&gt;其构造适配器的步骤如下：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;首先你的数据集肯定是要考虑到这个点的，你可以在之前的数据集中设置一个布尔值。在适配的时候进行判断！（鸿洋老师的例子），当然你也可以设置多个数据集，分别对应不同的视图。&lt;/li&gt;
&lt;li&gt;之后你就需要写&lt;code&gt;RecyclerView&lt;/code&gt;的适配器了，继承自&lt;code&gt;MultiItemCommonAdapter&lt;/code&gt;,在构造器中我们要告诉代码我们有几种当时的ItemType，设置好对应关系。&lt;/li&gt;
&lt;li&gt;之后在&lt;code&gt;convert()&lt;/code&gt;函数中完成数据项与视图的一一对应。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;这个我个人感觉会用的不会很多，有很多问题我也没有问题研究。等到使用到这种方式的时候着重研究下，这里先记个笔记。&lt;/p&gt;
&lt;h3 id=&quot;带Header的RecyclerView&quot;&gt;&lt;a href=&quot;#带Header的RecyclerView&quot; class=&quot;headerlink&quot; title=&quot;带Header的RecyclerView&quot;&gt;&lt;/a&gt;带Header的RecyclerView&lt;/h3&gt;&lt;p&gt;第三种，添加Header。关于给&lt;code&gt;RecyclerView&lt;/code&gt;添加Header的原理，请看第四篇学习博客，里面详细介绍了如何实现给&lt;code&gt;RecyclerView&lt;/code&gt;添加Header。其实Header同样是作为RecyclerView的一个Item来考虑的，只是我们通过&lt;code&gt;ItemType&lt;/code&gt;去找到它，如果是Header就设置&lt;code&gt;HeaderView&lt;/code&gt;如果不是Header就正常设置Item。大致的原理就是这样。&lt;/p&gt;
&lt;p&gt;在鸿洋老师的万能适配器中，封装好后你只需要按如下步骤做就可以了：&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;	SectionSupport&amp;lt;String&amp;gt; sectionSupport = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; SectionSupport&amp;lt;String&amp;gt;()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;sectionHeaderLayoutId&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; R.layout.header;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;sectionTitleTextViewId&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; R.id.id_header_title;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; String &lt;span class=&quot;title&quot;&gt;getTitle&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String s)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; s.substring(&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;在上面的代码中 首先指定Header的布局，以及布局中显示标题的&lt;code&gt;TextView&lt;/code&gt;，以及根据Item显示什么样的标题。通过上面的 &lt;code&gt;SectionSupport&lt;/code&gt;来指定。这里有一点需要注意的就是，标题栏里的标题是通过&lt;code&gt;getTitle（）&lt;/code&gt; 设置的，在鸿洋老师的例子中，鸿洋老师在&lt;code&gt;initData()&lt;/code&gt;设置数据集的时候做了点手脚，就是每个数据就都是“A(B.C…) + 数字”，这样标题就取第一个字母就行了，但这里有两个问题不晓得是鸿洋老师例子中没有展示还是没有实现，一个是这里默认的标题是&lt;code&gt;TextView&lt;/code&gt;，如果是要以&lt;code&gt;ImageView&lt;/code&gt;作为标题呢？&lt;br&gt;第二个问题就是标题栏的标题设置有什么更好的办法吗？&lt;/p&gt;
&lt;p&gt;在接下来就很简单了：&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;SectionAdapter&amp;lt;String&amp;gt; adapter = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; SectionAdapter&amp;lt;String&amp;gt;(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;, R.layout.item_list, mDatas, sectionSupport)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;convert&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(ViewHolder holder, String s)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;              holder.setText(R.id.id_item_list_title, s);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      mRecyclerView.setAdapter(adapter);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;这样就完成了Header的添加。最后是鸿洋老师Sample的展示。&lt;br&gt;&lt;img src=&quot;http://7xtcu9.com1.z0.glb.clouddn.com/12123.gif&quot; alt=&quot;enter image description here&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;万能适配器（二）&quot;&gt;&lt;a href=&quot;#万能适配器（二）&quot; class=&quot;headerlink&quot; title=&quot;万能适配器（二）&quot;&gt;&lt;/a&gt;万能适配器（二）&lt;/h2&gt;&lt;h3 id=&quot;使用方法-1&quot;&gt;&lt;a href=&quot;#使用方法-1&quot; class=&quot;headerlink&quot; title=&quot;使用方法&quot;&gt;&lt;/a&gt;使用方法&lt;/h3&gt;&lt;p&gt;学习完鸿洋老师的万能适配器的使用，接下来学习下陈宇明大神的万能适配器，就例子的功能和效果来看确实要比鸿洋老师更丰富一些。使用起来也很好，但我看陈大神github首页的介绍使用的时候没有鸿洋老师来的省力，因为陈大神把很多的数据封装起来了，所以光看他的Github介绍是无法了解如何使用的，必须把他的代码Clone或者DownLoad下来看看才知道如何使用。但总的来说陈大神的万能适配器还是很好使用的。&lt;/p&gt;
&lt;p&gt;学习链接：&lt;br&gt;&lt;a href=&quot;http://www.jianshu.com/p/411ab861034f&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.jianshu.com/p/411ab861034f&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://www.jianshu.com/p/fa3f97c19263&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.jianshu.com/p/fa3f97c19263&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://www.jianshu.com/p/9d75c22f0964&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.jianshu.com/p/9d75c22f0964&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://www.jianshu.com/p/cf29d4e45536&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.jianshu.com/p/cf29d4e45536&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://github.com/CymChad/BaseRecyclerViewAdapterHelper/blob/master/README-cn.md&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/CymChad/BaseRecyclerViewAdapterHelper/blob/master/README-cn.md&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;因为陈大神的数据全部封装起来了，我这里就不用他的例子了，我自己学习了下如何使用后，自己实践了下！&lt;/p&gt;
&lt;p&gt;首先还是数据集的创建:&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Persons&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; String name;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; String info;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; icon;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Persons&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String name, String info, &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; icon)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.name = name;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.info = info;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.icon = icon;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; String &lt;span class=&quot;title&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; name;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;setName&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String name)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.name = name;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; String &lt;span class=&quot;title&quot;&gt;getInfo&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; info;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;setInfo&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String info)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.info = info;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;getIcon&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; icon;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;setIcon&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; icon)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.icon = icon;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;这就类似陈大神例子中的&lt;code&gt;Status&lt;/code&gt;，然后我们就直接写&lt;code&gt;QuickAdapter&lt;/code&gt;了。&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;QuickAdapter&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;BaseQuickAdapter&lt;/span&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;Persons&lt;/span&gt;&amp;gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;QuickAdapter&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; layoutResId, List&amp;lt;Persons&amp;gt; data)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt;(layoutResId, data);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;convert&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(BaseViewHolder baseViewHolder, Persons persons)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        baseViewHolder.setText(R.id.name, persons.getName());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        baseViewHolder.setText(R.id.info1, persons.getInfo());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        baseViewHolder.setImageResource(R.id.icon1, persons.getIcon());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        baseViewHolder.setOnClickListener(R.id.name, &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; OnItemChildClickListener());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//        baseViewHolder.setOnClickListener(R.id.info1, new OnItemChildClickListener());&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        baseViewHolder.setOnClickListener(R.id.icon1, &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; OnItemChildClickListener());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;这个&lt;code&gt;RecyclerView.Adapater&lt;/code&gt;基本类似，上面说的两个万能适配器都是参考&lt;br&gt;&lt;a href=&quot;https://github.com/JoanZapata/base-adapter-helper&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;JoanZapata / base-adapter-helper&lt;/a&gt;&lt;br&gt;所以适配器的代码普遍相似。&lt;/p&gt;
&lt;p&gt;然后就回到&lt;code&gt;MainAcitivity&lt;/code&gt;中去：&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;MainActivity&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;AppCompatActivity&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; RecyclerView rv_list;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; List&amp;lt;Persons&amp;gt; mDatas = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;Persons&amp;gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; QuickAdapter mQuickAdapter;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; String TAG = &lt;span class=&quot;string&quot;&gt;&quot;MainActivity&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onCreate&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Bundle savedInstanceState)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt;.onCreate(savedInstanceState);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        setContentView(R.layout.activity_main);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        initDatas();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        rv_list = (RecyclerView) findViewById(R.id.rv_list);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        rv_list.setLayoutManager(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; LinearLayoutManager(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mQuickAdapter = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; QuickAdapter(R.layout.item_list, mDatas);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;//添加RecyclerView的点击事件&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mQuickAdapter.setOnRecyclerViewItemClickListener(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; BaseQuickAdapter.OnRecyclerViewItemClickListener() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onItemClick&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(View view, &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; i)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                Toast.makeText(MainActivity.&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;Item&quot;&lt;/span&gt; + i + &lt;span class=&quot;string&quot;&gt;&quot;has been clicked&quot;&lt;/span&gt;, Toast.LENGTH_SHORT).show();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;//添加RecyclerView的长按事件&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mQuickAdapter.setOnRecyclerViewItemLongClickListener(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; BaseQuickAdapter.OnRecyclerViewItemLongClickListener() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onItemLongClick&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(View view, &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; i)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                Toast.makeText(MainActivity.&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;长按&quot;&lt;/span&gt;, Toast.LENGTH_SHORT).show();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;//添加RecyclerView的子布局多个控件的点击事件&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mQuickAdapter.setOnRecyclerViewItemChildClickListener(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; BaseQuickAdapter.OnRecyclerViewItemChildClickListener() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onItemChildClick&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(BaseQuickAdapter baseQuickAdapter, View view, &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; i)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;switch&lt;/span&gt; (view.getId())&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; R.id.icon1:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        Toast.makeText(MainActivity.&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;icon1&quot;&lt;/span&gt; + i + &lt;span class=&quot;string&quot;&gt;&quot;has been clicked&quot;&lt;/span&gt;, Toast.LENGTH_SHORT).show();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        Log.d(TAG, &lt;span class=&quot;string&quot;&gt;&quot;onItemChildClick: had been finished&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; R.id.name:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        Toast.makeText(MainActivity.&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;name&quot;&lt;/span&gt; + i + &lt;span class=&quot;string&quot;&gt;&quot;has been clicked&quot;&lt;/span&gt;, Toast.LENGTH_SHORT).show();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        Log.d(TAG, &lt;span class=&quot;string&quot;&gt;&quot;onItemChildClick: had been finished&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; R.id.info1:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        Toast.makeText(MainActivity.&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;info&quot;&lt;/span&gt; + i + &lt;span class=&quot;string&quot;&gt;&quot;has been clicked&quot;&lt;/span&gt;, Toast.LENGTH_SHORT).show();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        Log.d(TAG, &lt;span class=&quot;string&quot;&gt;&quot;onItemChildClick: had been finished&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mQuickAdapter.openLoadAnimation(BaseQuickAdapter.SCALEIN);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mQuickAdapter.isFirstOnly(&lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        rv_list.setAdapter(mQuickAdapter);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;initDatas&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mDatas.add(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Persons(&lt;span class=&quot;string&quot;&gt;&quot;li&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;qedasc6456qdsadas&quot;&lt;/span&gt;, R.drawable.ic_launcher));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mDatas.add(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Persons(&lt;span class=&quot;string&quot;&gt;&quot;li2&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;qedascqdsa6456das&quot;&lt;/span&gt;, R.drawable.ic_launcher));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mDatas.add(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Persons(&lt;span class=&quot;string&quot;&gt;&quot;li3&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;qed43asc754qdsadas&quot;&lt;/span&gt;, R.drawable.ic_launcher));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mDatas.add(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Persons(&lt;span class=&quot;string&quot;&gt;&quot;li4&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;qedascqdsadas&quot;&lt;/span&gt;, R.drawable.ic_launcher));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mDatas.add(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Persons(&lt;span class=&quot;string&quot;&gt;&quot;li5&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;qe43dascqd31sadas&quot;&lt;/span&gt;, R.drawable.ic_launcher));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mDatas.add(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Persons(&lt;span class=&quot;string&quot;&gt;&quot;li6&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;qedascqd1sad31as&quot;&lt;/span&gt;, R.drawable.ic_launcher));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mDatas.add(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Persons(&lt;span class=&quot;string&quot;&gt;&quot;li7&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;qedascqdsa12das&quot;&lt;/span&gt;, R.drawable.ic_launcher));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mDatas.add(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Persons(&lt;span class=&quot;string&quot;&gt;&quot;li8&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;qedascqdsa123das&quot;&lt;/span&gt;, R.drawable.ic_launcher));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mDatas.add(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Persons(&lt;span class=&quot;string&quot;&gt;&quot;li9&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;qedascqds321adas&quot;&lt;/span&gt;, R.drawable.ic_launcher));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mDatas.add(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Persons(&lt;span class=&quot;string&quot;&gt;&quot;li10&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;qedasc1231qdsadas&quot;&lt;/span&gt;, R.drawable.ic_launcher));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mDatas.add(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Persons(&lt;span class=&quot;string&quot;&gt;&quot;li11&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;qed3123cqdsadas&quot;&lt;/span&gt;, R.drawable.ic_launcher));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mDatas.add(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Persons(&lt;span class=&quot;string&quot;&gt;&quot;li12&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;qeewqdascqdsadas&quot;&lt;/span&gt;, R.drawable.ic_launcher));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mDatas.add(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Persons(&lt;span class=&quot;string&quot;&gt;&quot;li13&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;qedascqds23ss&quot;&lt;/span&gt;, R.drawable.ic_launcher));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mDatas.add(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Persons(&lt;span class=&quot;string&quot;&gt;&quot;li14&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;qedascqdsaas&quot;&lt;/span&gt;, R.drawable.ic_launcher));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;很简单，和鸿洋老师那个万能适配器做的事情一样。但这里有两个优点，第一个添加动画方面很方便，只需要一行代码就可以搞定&lt;br&gt;&lt;code&gt;quickAdapter.openLoadAnimation();&lt;/code&gt;&lt;br&gt;不加参数的话就是默认的动画效果，其还提供其他五种效果&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;BaseQuickAdapter.ALPHAIN 渐显&lt;br&gt;BaseQuickAdapter.SCALEIN 缩放&lt;br&gt;BaseQuickAdapter.SLIDEIN_BOTTOM 从下到上滑进&lt;br&gt;BaseQuickAdapter.SLIDEIN_LEFT 从左到右滑进&lt;br&gt;BaseQuickAdapter.SLIDEIN_RIGHT 从右到左滑进&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;第二个能够添加子布局多个控件的点击事件，这个功能应该比长按功能更来得实际。要实现也很简单:&lt;/p&gt;
&lt;p&gt;首先在你写的Adapter中，这里即&lt;code&gt;QuickAdapter&lt;/code&gt;中添加控件的点击事件即可：&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;convert&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(BaseViewHolder helper, Status item)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   helper.setOnClickListener(R.id.tweetAvatar, &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; OnItemChildClickListener())&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     .setOnClickListener(R.id.tweetName, &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; OnItemChildClickListener());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;然后在Activity中实现子布局的控件的点击事件：&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;mQuickAdapter.setOnRecyclerViewItemChildClickListener(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; BaseQuickAdapter.OnRecyclerViewItemChildClickListener() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onItemChildClick&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(BaseQuickAdapter baseQuickAdapter, View view, &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; i)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;               &lt;span class=&quot;keyword&quot;&gt;switch&lt;/span&gt; (view.getId())&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                   &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; R.id.icon1:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                       Toast.makeText(MainActivity.&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;icon1&quot;&lt;/span&gt; + i + &lt;span class=&quot;string&quot;&gt;&quot;has been clicked&quot;&lt;/span&gt;, Toast.LENGTH_SHORT).show();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                       Log.d(TAG, &lt;span class=&quot;string&quot;&gt;&quot;onItemChildClick: had been finished&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                       &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                   &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; R.id.name:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                       Toast.makeText(MainActivity.&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;name&quot;&lt;/span&gt; + i + &lt;span class=&quot;string&quot;&gt;&quot;has been clicked&quot;&lt;/span&gt;, Toast.LENGTH_SHORT).show();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                       Log.d(TAG, &lt;span class=&quot;string&quot;&gt;&quot;onItemChildClick: had been finished&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                       &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                   &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; R.id.info1:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                       Toast.makeText(MainActivity.&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;info&quot;&lt;/span&gt; + i + &lt;span class=&quot;string&quot;&gt;&quot;has been clicked&quot;&lt;/span&gt;, Toast.LENGTH_SHORT).show();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                       Log.d(TAG, &lt;span class=&quot;string&quot;&gt;&quot;onItemChildClick: had been finished&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                       &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;               &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;           &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;是不是特别简单，这样感觉QQ都能自己写了呢~（开个玩笑）最后的效果如下：&lt;br&gt;&lt;img src=&quot;http://7xtcu9.com1.z0.glb.clouddn.com/1231241342.gif&quot; alt=&quot;enter image description here&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;多个ItemViewTyped的RecyclerView-1&quot;&gt;&lt;a href=&quot;#多个ItemViewTyped的RecyclerView-1&quot; class=&quot;headerlink&quot; title=&quot;多个ItemViewTyped的RecyclerView&quot;&gt;&lt;/a&gt;多个ItemViewTyped的RecyclerView&lt;/h3&gt;&lt;p&gt;接着就是多个ItemViewType的RecyclerView的使用了，实话实说，在这个方面的使用上来讲，陈大神的万能适配器真的比鸿洋老师的好用不少，还记得鸿洋老师的如何使用吗…回顾下：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;首先你的数据集得多一个变量，作用是做判断是哪种ItemType&lt;/li&gt;
&lt;li&gt;接着在Adapter里你就是对变量进行判断然后对应其ItemType&lt;/li&gt;
&lt;li&gt;再接着就是每种ItemType对应一个布局了。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;而陈大神的万能适配器的具体使用步骤如下：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;首先也是需要一个数据集的，当然这个数据集也得给出ItemType，但不需要多余的变量来进行判断。这里需要注意的是这个数据集必须继承自&lt;code&gt;MultiItemEntity&lt;/code&gt;，因为它提供了一个&lt;code&gt;setItemType&lt;/code&gt;的方法，去设置每个数据的ItemType&lt;/li&gt;
&lt;li&gt;再来就是编写Adapter了，这个适配器得继承自&lt;code&gt;BaseMultiItemQuickAdapter&amp;lt;T&amp;gt;&lt;/code&gt;，这里重载实现&lt;code&gt;convert()&lt;/code&gt;方法。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;说的太虚又说不准，拿例子来说话吧。&lt;br&gt;第一步数据集的构造：&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;MutiItem&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;MultiItemEntity&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; SEND = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; FROM = &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; icon;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; String name;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; String content;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; String createDate;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;MutiItem&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; icon, String name, String content, String createDate)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.name = name;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.icon = icon;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.content = content;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.createDate = createDate;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;getIcon&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; icon;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;setIcon&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; icon)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.icon = icon;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; String &lt;span class=&quot;title&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; name;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;setName&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String name)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.name = name;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; String &lt;span class=&quot;title&quot;&gt;getContent&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; content;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;setContent&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String content)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.content = content;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; String &lt;span class=&quot;title&quot;&gt;getCreateDate&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; createDate;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;setCreateDate&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(String createDate)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;.createDate = createDate;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;这里我直接把鸿洋老师的&lt;code&gt;ChatMessage&lt;/code&gt;去了一个变量后直接拿来用了&lt;/p&gt;
&lt;p&gt;前面两个常量就是ItemType。而Adapter就更简单了。只需要设置ItemType对应的视图，以及&lt;code&gt;convert&lt;/code&gt;里做数据填充就可以了。&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;MutiItemAdapter&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;BaseMultiItemQuickAdapter&lt;/span&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;MutiItem&lt;/span&gt;&amp;gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;MutiItemAdapter&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Context context, List&amp;lt;MutiItem&amp;gt; data)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt;(data);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        addItemType(MutiItem.SEND, R.layout.main_chat_send_msg);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        addItemType(MutiItem.FROM, R.layout.main_chat_from_msg);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;convert&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(BaseViewHolder baseViewHolder, MutiItem mutiItem)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;switch&lt;/span&gt; (baseViewHolder.getItemViewType()) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; MutiItem.SEND:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                baseViewHolder.setText(R.id.chat_send_content, mutiItem.getContent());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                baseViewHolder.setText(R.id.chat_send_name, mutiItem.getName());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                baseViewHolder.setImageResource(R.id.chat_send_icon, mutiItem.getIcon());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; MutiItem.FROM:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                baseViewHolder.setText(R.id.chat_from_content, mutiItem.getContent());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                baseViewHolder.setText(R.id.chat_from_name, mutiItem.getName());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                baseViewHolder.setImageResource(R.id.chat_from_icon, mutiItem.getIcon());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;然后就可以在Activity中设置RecyclerView的Adapter了。&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;MutiItemActivity&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;Activity&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; RecyclerView mRecyclerView;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; List&amp;lt;MutiItem&amp;gt; mutiItemList = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;MutiItem&amp;gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onCreate&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Bundle savedInstanceState)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt;.onCreate(savedInstanceState);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        setContentView(R.layout.mutiitem);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mRecyclerView = (RecyclerView) findViewById(R.id.id_recyclerview);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mRecyclerView.setLayoutManager(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; LinearLayoutManager(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        initData();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        MutiItemAdapter mutiItemAdapter = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; MutiItemAdapter(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;, mutiItemList);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mRecyclerView.setAdapter(mutiItemAdapter);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;initData&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        MutiItem item = &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        item =  &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; MutiItem(R.drawable.xiaohei, &lt;span class=&quot;string&quot;&gt;&quot;xiaohei&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;where are you &quot;&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        item.setItemType(MutiItem.SEND);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mutiItemList.add(item);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        item =  &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; MutiItem(R.drawable.xiaohei, &lt;span class=&quot;string&quot;&gt;&quot;renma&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;where are you &quot;&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        item.setItemType(MutiItem.FROM);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mutiItemList.add(item);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        item =  &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; MutiItem(R.drawable.xiaohei, &lt;span class=&quot;string&quot;&gt;&quot;xiaohei&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;where are you &quot;&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        item.setItemType(MutiItem.SEND);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mutiItemList.add(item);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        item =  &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; MutiItem(R.drawable.xiaohei, &lt;span class=&quot;string&quot;&gt;&quot;renma&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;where are you &quot;&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        item.setItemType(MutiItem.FROM);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mutiItemList.add(item);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        item =  &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; MutiItem(R.drawable.xiaohei, &lt;span class=&quot;string&quot;&gt;&quot;xiaohei&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;where are you &quot;&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        item.setItemType(MutiItem.SEND);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mutiItemList.add(item);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        item =  &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; MutiItem(R.drawable.xiaohei, &lt;span class=&quot;string&quot;&gt;&quot;xiaohei&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;where are you &quot;&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        item.setItemType(MutiItem.SEND);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mutiItemList.add(item);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        item =  &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; MutiItem(R.drawable.xiaohei, &lt;span class=&quot;string&quot;&gt;&quot;renma&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;where are you &quot;&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        item.setItemType(MutiItem.FROM);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mutiItemList.add(item);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        item =  &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; MutiItem(R.drawable.xiaohei, &lt;span class=&quot;string&quot;&gt;&quot;xiaohei&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;where are you &quot;&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        item.setItemType(MutiItem.SEND);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mutiItemList.add(item);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        item =  &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; MutiItem(R.drawable.xiaohei, &lt;span class=&quot;string&quot;&gt;&quot;renma&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;where are you &quot;&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        item.setItemType(MutiItem.FROM);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mutiItemList.add(item);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        item =  &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; MutiItem(R.drawable.xiaohei, &lt;span class=&quot;string&quot;&gt;&quot;xiaohei&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;where are you &quot;&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        item.setItemType(MutiItem.SEND);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        mutiItemList.add(item);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;是不是超级简单，只是别忘了在数据构造的时候记得使用&lt;code&gt;setItemType&lt;/code&gt;。&lt;/p&gt;
&lt;h3 id=&quot;带Header的RecyclerView-1&quot;&gt;&lt;a href=&quot;#带Header的RecyclerView-1&quot; class=&quot;headerlink&quot; title=&quot;带Header的RecyclerView&quot;&gt;&lt;/a&gt;带Header的RecyclerView&lt;/h3&gt;&lt;p&gt;根据官方的介绍，要添加HeaderView和FooterView，只需要两句代码就可以搞定。&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;mQuickAdapter.addHeaderView(getView());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;mQuickAdapter.addFooterView(getView());&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;这里的&lt;code&gt;getView()&lt;/code&gt;返回的是一个&lt;code&gt;View&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;如果只有一个HeaderView和FooterView那这个万能适配器就能完美实现，但像鸿洋老师那种可以添加多个HeaderView的，这边没有提及。但也不是没有解决办法，添加Header的思想其实也就是多加一个ItemType，如果真要实现分类，有多个Header的话，那就把HeaderView作为一个ItemType，指定其视图就好了~&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;RecyclerView总结学习（二）&quot;&gt;&lt;a href=&quot;#RecyclerView总结学习（二）&quot; class=&quot;headerlink&quot; title=&quot;RecyclerView总结学习（二）&quot;&gt;&lt;/a&gt;RecyclerView总结学习（二）&lt;/h1&gt;&lt;h2 i
    
    </summary>
    
      <category term="Android开发" scheme="http://chr10003566.github.io./categories/Android%E5%BC%80%E5%8F%91/"/>
    
    
  </entry>
  
  <entry>
    <title>layout_*的一些注意事项</title>
    <link href="http://chr10003566.github.io./2016/06/17/layout/"/>
    <id>http://chr10003566.github.io./2016/06/17/layout/</id>
    <published>2016-06-17T04:47:35.000Z</published>
    <updated>2016-06-17T04:51:34.000Z</updated>
    
    <content type="html">&lt;h1 id=&quot;layout-的一些注意事项&quot;&gt;&lt;a href=&quot;#layout-的一些注意事项&quot; class=&quot;headerlink&quot; title=&quot;layout_*的一些注意事项&quot;&gt;&lt;/a&gt;layout_*的一些注意事项&lt;/h1&gt;&lt;p&gt;在Android UI的开发中layout_*应该是用的很多的，但其中有很多的坑想必大家也碰到过，今天就来写写自己碰到的！之后如果还有碰到就在添加。&lt;/p&gt;
&lt;h2 id=&quot;layout-width-layout-height&quot;&gt;&lt;a href=&quot;#layout-width-layout-height&quot; class=&quot;headerlink&quot; title=&quot;layout_width   |   layout_height&quot;&gt;&lt;/a&gt;&lt;code&gt;layout_width&lt;/code&gt;   |   &lt;code&gt;layout_height&lt;/code&gt;&lt;/h2&gt;&lt;h3 id=&quot;起因&quot;&gt;&lt;a href=&quot;#起因&quot; class=&quot;headerlink&quot; title=&quot;起因&quot;&gt;&lt;/a&gt;起因&lt;/h3&gt;&lt;p&gt;先来说说起因，做一个自定义的Dialog。这本来是很简单的事情，以前也做过很多次包括&lt;code&gt;PopupWindow&lt;/code&gt;。可能是之前到处借鉴别人的代码，没怎么注意，今天自己动手写。出现了个之前出现却没仔细解决的问题！然后就花了一下午甚至还去stackoverflow上提了一发问，不得不说国外的环境就是比国内的好。国内的论坛”杂鱼”太多。真正好好回答你问题的没几个！但也不乏有细心的大神指导~&lt;br&gt;问题描述见stackoverflow:&lt;br&gt;&lt;a href=&quot;http://stackoverflow.com/questions/37854419/why-can-android-alertdialogs-width-and-height-1&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://stackoverflow.com/questions/37854419/why-can-android-alertdialogs-width-and-height-1&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;问题描述&quot;&gt;&lt;a href=&quot;#问题描述&quot; class=&quot;headerlink&quot; title=&quot;问题描述&quot;&gt;&lt;/a&gt;问题描述&lt;/h3&gt;&lt;p&gt;看了stackoverflow的人应该知道我出现了什么样的问题，问题总的来说是4个：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;问题1：我在&lt;code&gt;AlertDialog&lt;/code&gt;实例化的时候，直接获取其高度和宽度，结果得到-1 ，出现-1的原因&lt;/li&gt;
&lt;li&gt;问题2：&lt;code&gt;setLayout&lt;/code&gt;必须在&lt;code&gt;dialog.show()&lt;/code&gt;之后执行，理由是？&lt;/li&gt;
&lt;li&gt;问题3：&lt;code&gt;getWindow.setLayout(int width, int height)&lt;/code&gt;这里&lt;code&gt;width&lt;/code&gt; 和&lt;code&gt;height&lt;/code&gt;的单位是什么？&lt;/li&gt;
&lt;li&gt;问题4：为何xml文件中的&lt;code&gt;LinearLayout&lt;/code&gt;中的&lt;code&gt;layout_width&lt;/code&gt;和&lt;code&gt;layout_height&lt;/code&gt;没有起到作用！&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;问题解决&quot;&gt;&lt;a href=&quot;#问题解决&quot; class=&quot;headerlink&quot; title=&quot;问题解决&quot;&gt;&lt;/a&gt;问题解决&lt;/h3&gt;&lt;h4 id=&quot;问题1：&quot;&gt;&lt;a href=&quot;#问题1：&quot; class=&quot;headerlink&quot; title=&quot;问题1：&quot;&gt;&lt;/a&gt;问题1：&lt;/h4&gt;&lt;p&gt;&lt;code&gt;AlertDialog&lt;/code&gt;实例化&lt;code&gt;AlertDialog dialog = new AlertDialog.Builder(MainActivity.this).setView(view).create();&lt;/code&gt;后，&lt;code&gt;AlertDialog&lt;/code&gt;并没有真正被创建。只有当&lt;code&gt;dialog.create()&lt;/code&gt;[API 21才允许使用]和&lt;code&gt;dialog.show()&lt;/code&gt;之后才真正被创建。所以当我这个时候去获取它的高度和宽度的时候会得到”-1”，这个“-1”是有深意的&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;@Deprecated&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; FILL_PARENT = -&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * Special value for the height or width requested by a View.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * MATCH_PARENT means that the view wants to be as big as its parent,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * minus the parent&#39;s padding, if any. Introduced in API Level 8.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; MATCH_PARENT = -&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * Special value for the height or width requested by a View.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * WRAP_CONTENT means that the view wants to be just large enough to fit&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * its own internal content, taking its own padding into account.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; */&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; WRAP_CONTENT = -&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;“-1”即全屏。默认是全屏的。如果我们把&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;WindowManager.LayoutParams lp = dialog.getWindow().getAttributes();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; Log.d(&lt;span class=&quot;string&quot;&gt;&quot;TAG&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;First lp width and height&quot;&lt;/span&gt; + lp.width + &lt;span class=&quot;string&quot;&gt;&quot;  &quot;&lt;/span&gt; + lp.height);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;我门得到的结果为“-2“。至于为何我也不知所以！&lt;/p&gt;
&lt;h4 id=&quot;问题2&quot;&gt;&lt;a href=&quot;#问题2&quot; class=&quot;headerlink&quot; title=&quot;问题2&quot;&gt;&lt;/a&gt;问题2&lt;/h4&gt;&lt;p&gt;问题2和问题1是一样的问题，同样是由于Dialog还未生成，所以在&lt;code&gt;.show()&lt;/code&gt;之后，&lt;code&gt;setLayout()&lt;/code&gt;是可以起到作用的！&lt;/p&gt;
&lt;h4 id=&quot;问题3&quot;&gt;&lt;a href=&quot;#问题3&quot; class=&quot;headerlink&quot; title=&quot;问题3&quot;&gt;&lt;/a&gt;问题3&lt;/h4&gt;&lt;p&gt;这里的&lt;code&gt;int width&lt;/code&gt;和&lt;code&gt;int height&lt;/code&gt;都是px单位的。可以看到我设置了TextView的高度和宽度分别是&lt;code&gt;200dp&lt;/code&gt;设置了Dialog的高度和宽度分贝是&lt;code&gt;500px&lt;/code&gt;则会出现下面的效果：&lt;br&gt;&lt;img src=&quot;http://7xtcu9.com1.z0.glb.clouddn.com/QQ%E5%9B%BE%E7%89%8720160617112302.png&quot; alt=&quot;image description&quot;&gt;&lt;/p&gt;
&lt;p&gt;发现&lt;code&gt;200dp&lt;/code&gt;和&lt;code&gt;500px&lt;/code&gt;差的不多。&lt;/p&gt;
&lt;h4 id=&quot;问题4&quot;&gt;&lt;a href=&quot;#问题4&quot; class=&quot;headerlink&quot; title=&quot;问题4&quot;&gt;&lt;/a&gt;问题4&lt;/h4&gt;&lt;p&gt;这个问题就很高深了，具体为啥是由国外友人告诉我的。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;layout_ prefixed attributes are set on a LayoutParams object provided by parent view. Since there’s no parent, there are no LayoutParams you can work with. Try setting android:minHeight and android:minWidth instead.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;国外友人说的很详细，&lt;code&gt;layout_*&lt;/code&gt;这个属性要能使用必须有父视图（父布局）。如果你不是很懂（其实我也不是很懂），看看郭神的这篇博客可能会有点体会：&lt;br&gt;&lt;a href=&quot;http://blog.csdn.net/guolin_blog/article/details/12921889&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://blog.csdn.net/guolin_blog/article/details/12921889&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;平时我们经常使用layout_width和layout_height来设置View的大小，并且一直都能正常工作，就好像这两个属性确实是用于设置View的大小的。而实际上则不然，它们其实是用于设置View在布局中的大小的，也就是说，首先View必须存在于一个布局中&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;这也就是为啥有时候在xml那边设置了宽、高，但是却没能在界面中体现出来的某一个原因。&lt;/p&gt;
&lt;h2 id=&quot;layout-weight&quot;&gt;&lt;a href=&quot;#layout-weight&quot; class=&quot;headerlink&quot; title=&quot;layout_weight&quot;&gt;&lt;/a&gt;&lt;code&gt;layout_weight&lt;/code&gt;&lt;/h2&gt;&lt;p&gt;链接在这里：&lt;a href=&quot;http://blog.csdn.net/cuihaoren01/article/details/51373887&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://blog.csdn.net/cuihaoren01/article/details/51373887&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;layout-gravity-gravity&quot;&gt;&lt;a href=&quot;#layout-gravity-gravity&quot; class=&quot;headerlink&quot; title=&quot;layout_gravity   |    gravity&quot;&gt;&lt;/a&gt;&lt;code&gt;layout_gravity&lt;/code&gt;   |    &lt;code&gt;gravity&lt;/code&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;code&gt;android:gravity&lt;/code&gt; 是用于设置View组建对齐方式。是针对控件里面的元素来说的，用来控制元素在该空间里的显示位置。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;android:layout_gravity&lt;/code&gt; 用于设置Container组建的对齐方式。是针对控件本身而言，用来控制该控件在包涵该控件的父控件的位置。&lt;/li&gt;
&lt;li&gt;特殊情况：当我们采用&lt;code&gt;LinearLayout&lt;/code&gt;布局时：&lt;br&gt;1）当&lt;code&gt;android:orientation = veritical&lt;/code&gt;时，&lt;code&gt;android:layout_gravity&lt;/code&gt;只有水平方向的设置才起作用，垂直方向的设置是不起作用的&lt;br&gt;2）当&lt;code&gt;android:orientation = horizontal&lt;/code&gt;时，&lt;code&gt;android:layout_gravity&lt;/code&gt;只有垂直方向的设置才起作用，水平方向的设置不起作用。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;之后如果还出现什么问题或者Bug的话在补充也希望有人能给我补充！&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;layout-的一些注意事项&quot;&gt;&lt;a href=&quot;#layout-的一些注意事项&quot; class=&quot;headerlink&quot; title=&quot;layout_*的一些注意事项&quot;&gt;&lt;/a&gt;layout_*的一些注意事项&lt;/h1&gt;&lt;p&gt;在Android UI的开发中layou
    
    </summary>
    
      <category term="Android开发查缺补漏" scheme="http://chr10003566.github.io./categories/Android%E5%BC%80%E5%8F%91%E6%9F%A5%E7%BC%BA%E8%A1%A5%E6%BC%8F/"/>
    
    
  </entry>
  
  <entry>
    <title>RecyclerView总结学习(一)</title>
    <link href="http://chr10003566.github.io./2016/06/13/RecycleView1/"/>
    <id>http://chr10003566.github.io./2016/06/13/RecycleView1/</id>
    <published>2016-06-13T03:06:42.000Z</published>
    <updated>2016-06-13T06:23:47.000Z</updated>
    
    <content type="html">&lt;h1 id=&quot;RecyclerView总结学习（一）&quot;&gt;&lt;a href=&quot;#RecyclerView总结学习（一）&quot; class=&quot;headerlink&quot; title=&quot;RecyclerView总结学习（一）&quot;&gt;&lt;/a&gt;RecyclerView总结学习（一）&lt;/h1&gt;&lt;p&gt;RecyclerView已经出现有一年多了，各种“该有的”东西也都有了。这里就来总结学习一发！&lt;/p&gt;
&lt;p&gt;照常先贴学习链接：&lt;br&gt;&lt;a href=&quot;http://blog.csdn.net/lmj623565791/article/details/45059587&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://blog.csdn.net/lmj623565791/article/details/45059587&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://github.com/codepath/android_guides/wiki/Using-the-RecyclerView&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/codepath/android_guides/wiki/Using-the-RecyclerView&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;第一篇博客鸿洋大神已经写的非常非常完美了，第二篇算是google工程是提供的一些RecyclerView的使用。两篇相互学习相互补充吧！&lt;/p&gt;
&lt;h2 id=&quot;RecyclerView综述&quot;&gt;&lt;a href=&quot;#RecyclerView综述&quot; class=&quot;headerlink&quot; title=&quot;RecyclerView综述&quot;&gt;&lt;/a&gt;RecyclerView综述&lt;/h2&gt;&lt;p&gt;如果你想使用RecyclerView的话，你将必须按照下面这么做：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;RecyclerView.Adapter&lt;/code&gt; 将数据集与相应的视图绑定&lt;/li&gt;
&lt;li&gt;&lt;code&gt;LayoutManager&lt;/code&gt; 解决数据项的放置位置问题&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ItemAnimator&lt;/code&gt; 与动画的常用操作，如添加或项目删除的动画效果&lt;br&gt;&lt;img src=&quot;http://7xtcu9.com1.z0.glb.clouddn.com/RecyclerView.png&quot; alt=&quot;image description&quot;&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;与ListView相比较（面试）&quot;&gt;&lt;a href=&quot;#与ListView相比较（面试）&quot; class=&quot;headerlink&quot; title=&quot;与ListView相比较（面试）&quot;&gt;&lt;/a&gt;与ListView相比较（面试）&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;在Adapters中需要使用ViewHolder  -&lt;code&gt;ListView&lt;/code&gt;的Adapter没有强制要求使用ViewHolder来提高性能，相比较使用&lt;code&gt;RecyclerView&lt;/code&gt;的Adapter则需要使用ViewHolder。&lt;/li&gt;
&lt;li&gt;可定制的项目布局  -&lt;code&gt;ListView&lt;/code&gt;仅仅能够垂直布局或者线性布局，它不能够被定制。相反，&lt;code&gt;RecyclerView&lt;/code&gt;通过&lt;code&gt;RecyclerView.LayoutManager&lt;/code&gt;可以设置任何数据项的布局，包括水平列表或交错网格。&lt;/li&gt;
&lt;li&gt;简单的数据操作动画 -数据项的添加和删除&lt;code&gt;ListView&lt;/code&gt;都不提供任何的特殊方法。相反，&lt;code&gt;RecyclerView&lt;/code&gt;则通过&lt;code&gt;RecyclerView.ItemAnimator&lt;/code&gt;来处理操作数据项的动画。&lt;/li&gt;
&lt;li&gt;手动的数据来源 -&lt;code&gt;ListView&lt;/code&gt;有&lt;code&gt;ArrayAdapter&lt;/code&gt;和&lt;code&gt;CursorAdapter&lt;/code&gt;分别来处理数组和数据库等一些数据。相反&lt;code&gt;RecyclerView.Adapter&lt;/code&gt;需要我们自己定义实现数据提供给Adapter。&lt;/li&gt;
&lt;li&gt;手动的项目分割线 -&lt;code&gt;ListView&lt;/code&gt;有&lt;code&gt;android:divider&lt;/code&gt;属性来提供简单的列表中数据项之间的分割线，相反&lt;code&gt;RecyclerView&lt;/code&gt;则需要使用&lt;code&gt;RecyclerView.ItemDecoration&lt;/code&gt;来设置分割线&lt;/li&gt;
&lt;li&gt;手动的点击检测 -&lt;code&gt;ListView&lt;/code&gt;有&lt;code&gt;AdapterView.OnItemClickListener&lt;/code&gt;接口为列表的独立项绑定点击事件。而&lt;code&gt;RecyclerView&lt;/code&gt;仅仅对&lt;code&gt;RecyclerView.onItemTouchListener&lt;/code&gt;提供了支持，但没有内置的点击处理操作。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;关于&lt;code&gt;RecyclerView&lt;/code&gt;使用，在鸿洋老师的博客中可以学习到，我这里就不累述了。讲讲现在很流行的&lt;code&gt;RecyclerView&lt;/code&gt;与&lt;code&gt;CardView&lt;/code&gt;的搭配使用吧。原文如下：&lt;br&gt;&lt;a href=&quot;http://www.androidhive.info/2016/05/android-working-with-card-view-and-recycler-view/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.androidhive.info/2016/05/android-working-with-card-view-and-recycler-view/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;这里面有很多的&lt;code&gt;Material Design&lt;/code&gt;的知识，大家可以翻阅我之前写的Material Design专题的内容。&lt;/p&gt;
&lt;p&gt;总的来说还是按照&lt;code&gt;RecyclerView&lt;/code&gt;的使用方法走的。具体使用步骤如下：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;准备好数据集&lt;/li&gt;
&lt;li&gt;设置&lt;code&gt;RecyclerView.LayoutManager&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;写好&lt;code&gt;RecyclerView.Adpater&lt;/code&gt;并设置适配&lt;/li&gt;
&lt;li&gt;设置&lt;code&gt;RecyclerView.ItemAnimator&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;如果你不是使用&lt;code&gt;CardView&lt;/code&gt;你可能还需要设置&lt;code&gt;RecyclerView.ItemDecoration&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;RecyclerView总结学习（一）&quot;&gt;&lt;a href=&quot;#RecyclerView总结学习（一）&quot; class=&quot;headerlink&quot; title=&quot;RecyclerView总结学习（一）&quot;&gt;&lt;/a&gt;RecyclerView总结学习（一）&lt;/h1&gt;&lt;p&gt;Re
    
    </summary>
    
      <category term="Android开发" scheme="http://chr10003566.github.io./categories/Android%E5%BC%80%E5%8F%91/"/>
    
    
  </entry>
  
  <entry>
    <title>Material Design(四)</title>
    <link href="http://chr10003566.github.io./2016/05/25/MaterialDesign4/"/>
    <id>http://chr10003566.github.io./2016/05/25/MaterialDesign4/</id>
    <published>2016-05-25T09:48:31.000Z</published>
    <updated>2016-05-26T08:16:31.000Z</updated>
    
    <content type="html">&lt;h1 id=&quot;Material-Design-四&quot;&gt;&lt;a href=&quot;#Material-Design-四&quot; class=&quot;headerlink&quot; title=&quot;Material Design(四)&quot;&gt;&lt;/a&gt;Material Design(四)&lt;/h1&gt;&lt;p&gt;今天来学习下之前一直在用但却从没研究过的Toolbar吧。这个小东西在如今的Android开发中几乎是必用，用过很多次但每次自己想写的时候却只能写个简单的出来。现在就来深究下！&lt;/p&gt;
&lt;p&gt;照常先贴学习链接：&lt;br&gt;&lt;a href=&quot;http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2014/1118/2006.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2014/1118/2006.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;这个链接呢，基本上把Toobar的一些主要知识点介绍了下。但少了一个很重要的功能就是Toolbar与DrawerLayout的搭配使用。&lt;/p&gt;
&lt;h2 id=&quot;Toolbar基础&quot;&gt;&lt;a href=&quot;#Toolbar基础&quot; class=&quot;headerlink&quot; title=&quot;Toolbar基础&quot;&gt;&lt;/a&gt;Toolbar基础&lt;/h2&gt;&lt;p&gt;Toolbar是在Android 5.0开始推出的一个Material Design风格的导航控件，Google非常推荐大家使用Toolbar作为Android客户端的导航栏，以此来取代之前的Actionbar。与Actionbar相比，Toolbar明显要灵活的多，它不像Actionbar一样，一定要固定在Activity顶部，而是可以放到界面的任意位置，除此之外，在设计Toolbar的时候，Google也流给改开发者很多可以定制修改的地方。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;设置导航栏图标；&lt;/li&gt;
&lt;li&gt;设置App的logo&lt;/li&gt;
&lt;li&gt;支持设置标题核子标题&lt;/li&gt;
&lt;li&gt;支持添加一个或多个的自定义控件&lt;/li&gt;
&lt;li&gt;支持Action Menu&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;在上面那个学习链接中，除了第四点均涉及了，我这里也不详述了。而第四点也很容易实现，在Toolbar的标签下再加控件就可以了。我这里补充一些上面学习链接的知识。&lt;/p&gt;
&lt;p&gt;Toolbar是替代掉Actionbar的，那我们的应用一定不能够使用带Actionbar的主题Theme，所以在&lt;code&gt;styles.xml&lt;/code&gt; 中我们需要对其进行修改。如果使用&lt;br&gt;&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;resources&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;style&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;AppTheme&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;parent&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;AppTheme.Base&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;undefined&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;style&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;resources&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;style&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;AppTheme.Base&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;parent&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;Theme.AppCompat&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;xml&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;item&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;windowActionBar&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;false&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;item&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;item&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;android:windowNoTitle&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;true&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;item&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;style&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;不晓得为什么我这边会报错。原因是&lt;code&gt;AppCompat...&lt;/code&gt;不能这么设置之类的错误，那我就更狠一点&lt;br&gt;&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;resources&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;&amp;lt;!-- Base application theme. --&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;style&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;AppTheme&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;parent&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;AppTheme.Base&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;xml&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;&amp;lt;!-- Customize your theme here. --&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;style&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;style&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;AppTheme.Base&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;parent&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;Theme.AppCompat.NoActionBar&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;xml&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;item&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;colorPrimary&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;@color/colorPrimary&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;item&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;item&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;colorPrimaryDark&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;@color/colorPrimaryDark&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;item&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;item&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;colorAccent&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;@color/colorAccent&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;item&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;style&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;resources&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;直接使用&lt;code&gt;Theme.AppCompat.NoActionBar&lt;/code&gt;即可。接着在&lt;code&gt;res/layout&lt;/code&gt;的&lt;code&gt;activity_main.xml&lt;/code&gt;（布局文件可以在学习链接中找到）中添加Toobar然后再在&lt;code&gt;MainActivity.java&lt;/code&gt;中添加&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;toolbar = (Toolbar) findViewById(R.id.toolbar);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;toolbar.setTitle(&lt;span class=&quot;string&quot;&gt;&quot;My Title&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;toolbar.setSubtitle(&lt;span class=&quot;string&quot;&gt;&quot;Sub title&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;setSupportActionBar(toolbar);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;就能到得到如下效果了：&lt;br&gt;&lt;img src=&quot;http://7xtcu9.com1.z0.glb.clouddn.com/QQ%E6%88%AA%E5%9B%BE20160526140250.png&quot; alt=&quot;image description&quot;&gt;&lt;/p&gt;
&lt;p&gt;Toolbar就只这样的话那真是太不实用了，怎么也得整几个可以点的东西呀。这里就有些花样了。它可以将&lt;code&gt;menu&lt;/code&gt;文件中的item显示出来，这么说可能不是很理解。举个例子：有的手机应该是还有菜单键的，点菜单键弹出来的item将会显示在Toolbar上。这也就能理解为什么越来越多的手机取消了菜单键（应该会有点关系）！&lt;/p&gt;
&lt;p&gt;在&lt;code&gt;res/menu&lt;/code&gt;中添加一个&lt;code&gt;menu.xml&lt;/code&gt;然后在其中添加如下代码：&lt;br&gt;&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;menu&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;xmlns:android&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;http://schemas.android.com/apk/res/android&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;xmlns:app&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;http://schemas.android.com/apk/res-auto&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;item&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;android:id&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;@+id/edit&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;android:icon&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;@mipmap/ic_launcher&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;android:title&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;@string/action_edit&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;android:orderInCategory&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;100&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;app:showAsAction&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;ifRoom&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;item&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;android:id&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;@+id/share&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;android:icon&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;@mipmap/ic_launcher&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;android:title&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;@string/action_share&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;android:orderInCategory&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;100&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;app:showAsAction&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;ifRoom&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;item&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;android:id&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;@+id/setting&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;android:icon&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;@mipmap/ic_launcher&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;android:title&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;@string/action_setting&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;android:orderInCategory&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;100&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;app:showAsAction&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;never&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;menu&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;然后在&lt;code&gt;MainActivity.java&lt;/code&gt;中覆写：&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onCreateOptionsMenu&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Menu menu)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    getMenuInflater().inflate(R.menu.menu, menu);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt;.onCreateOptionsMenu(menu);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onOptionsItemSelected&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(MenuItem item)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    String msg = &lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;switch&lt;/span&gt; (item.getItemId()) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//        case android.R.id.home:&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//            mDrawerLayout.openDrawer(GravityCompat.START);&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//           Log.i(TAG, &quot;onMenuItemClick: Home had been click&quot;);&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//            return true;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; R.id.edit:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            msg += &lt;span class=&quot;string&quot;&gt;&quot;Click edit&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; R.id.share:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            msg += &lt;span class=&quot;string&quot;&gt;&quot;Click share&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; R.id.setting:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            msg += &lt;span class=&quot;string&quot;&gt;&quot;Click setting&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(!msg.equals(&lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Toast.makeText(MainActivity.&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;, msg, Toast.LENGTH_SHORT).show();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;之后你在运行程序的话，就能看到下面的效果了：&lt;br&gt;&lt;img src=&quot;http://7xtcu9.com1.z0.glb.clouddn.com/131231.png&quot; alt=&quot;image description&quot;&gt;&lt;br&gt;在Toolbar中多了几个item，点击的话也会有相应的事件发生。学习链接中有这样一段代码&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; Toolbar.OnMenuItemClickListener onMenuItemClick = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Toolbar.OnMenuItemClickListener() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onMenuItemClick&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(MenuItem menuItem)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    String msg = &lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;switch&lt;/span&gt; (menuItem.getItemId()) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; R.id.action_edit:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        msg += &lt;span class=&quot;string&quot;&gt;&quot;Click edit&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; R.id.action_share:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        msg += &lt;span class=&quot;string&quot;&gt;&quot;Click share&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; R.id.action_settings:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        msg += &lt;span class=&quot;string&quot;&gt;&quot;Click setting&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(!msg.equals(&lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      Toast.makeText(MainActivity.&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;, msg, Toast.LENGTH_SHORT).show();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;这个经我测试发现其功能和&lt;code&gt;onOptionsItemSelected&lt;/code&gt;一模一样，并且还少了一个之后会讲到的功能（看我注释的代码就懂了）。&lt;br&gt;到这里Toolbar的基本使用就算学习结束了。&lt;/p&gt;
&lt;h2 id=&quot;Toolbar进阶-–Toolbar与DrawerLayout的搭配使用&quot;&gt;&lt;a href=&quot;#Toolbar进阶-–Toolbar与DrawerLayout的搭配使用&quot; class=&quot;headerlink&quot; title=&quot;Toolbar进阶 –Toolbar与DrawerLayout的搭配使用&quot;&gt;&lt;/a&gt;Toolbar进阶 –Toolbar与DrawerLayout的搭配使用&lt;/h2&gt;&lt;p&gt;我也不知道算不算进阶，但我估计大部分和我一样的基础学习者应该是不会用的吧。对我来说算进阶，这里记录下来加深印象并分享给大家。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;DrawerLayout&lt;/code&gt;大家应该不陌生，这个肯定是必用的了。在&lt;a href=&quot;http://chr10003566.github.io/2016/04/21/MaterialDesign/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Material Design（一）&lt;/a&gt;中，我还给大家介绍了&lt;code&gt;Android Design Support Library&lt;/code&gt;中的&lt;code&gt;NavigationView&lt;/code&gt;作为配合&lt;code&gt;DrawerLayout&lt;/code&gt;的控件。今天也会在用到。&lt;/p&gt;
&lt;p&gt;首先布局代码在上面就有所改变了，需要添加&lt;code&gt;DrawerLayout&lt;/code&gt;。&lt;br&gt;&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;LinearLayout&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;xmlns:android&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;http://schemas.android.com/apk/res/android&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;xmlns:app&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;http://schemas.android.com/apk/res-auto&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;android:layout_width&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;match_parent&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;android:layout_height&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;match_parent&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;android:orientation&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;vertical&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;android.support.v7.widget.Toolbar&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;android:id&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;@+id/toolbar&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;android:layout_width&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;match_parent&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;android:layout_height&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;?attr/actionBarSize&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;android:background&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;@color/colorAccent&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;android:popupTheme&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;@style/ThemeOverlay.AppCompat.Light&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;app:theme&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;@style/ThemeOverlay.AppCompat.ActionBar&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;android.support.v7.widget.Toolbar&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;android.support.v4.widget.DrawerLayout&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;android:id&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;@+id/drawer&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;android:layout_width&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;match_parent&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;android:layout_height&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;match_parent&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;RelativeLayout&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;android:layout_width&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;match_parent&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;android:layout_height&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;match_parent&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;TextView&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;attr&quot;&gt;android:layout_width&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;wrap_content&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;attr&quot;&gt;android:layout_height&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;wrap_content&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;attr&quot;&gt;android:text&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;Hello World!&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;RelativeLayout&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;android.support.design.widget.NavigationView&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;android:layout_width&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;wrap_content&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;android:layout_height&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;match_parent&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;android:layout_gravity&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;start&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;app:headerLayout&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;@layout/drawer_header&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;app:menu&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;@menu/drawer&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;android.support.design.widget.NavigationView&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;android.support.v4.widget.DrawerLayout&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;LinearLayout&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;这里稍微提一下，有的App比如&lt;a href=&quot;http://chr10003566.github.io/2016/04/21/MaterialDesign/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Material Design（一）&lt;/a&gt;中的Demo &lt;code&gt;DrawerLayout&lt;/code&gt;的高度是整个屏幕的大小，而这里&lt;code&gt;DrawerLayout&lt;/code&gt;没有占整个屏幕的高度，其关键在与Toolbar的位置，如果你把Toolbar发在&lt;code&gt;DrawerLayout&lt;/code&gt;的外面，并在外面把Toolbar和&lt;code&gt;DrawerLayout&lt;/code&gt; “垂直”放置的话，那么&lt;code&gt;DrawerLayout&lt;/code&gt;就只能显示在Toolbar之下了。这样就能看到抽屉打开关闭Toolbar的变化了。至于&lt;code&gt;@layout/drawer_header&lt;/code&gt;和&lt;code&gt;@menu/drawer&lt;/code&gt;大家可以在&lt;a href=&quot;http://chr10003566.github.io/2016/04/21/MaterialDesign/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Material Design（一）&lt;/a&gt;去找。我这里就不贴了。然后你在&lt;code&gt;MainActivity.java&lt;/code&gt;的&lt;code&gt;onCreate()&lt;/code&gt;中加入下面的代码：&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;getSupportActionBar().setHomeButtonEnabled(&lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;); &lt;span class=&quot;comment&quot;&gt;//设置返回键可用&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;getSupportActionBar().setDisplayHomeAsUpEnabled(&lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;以及将&lt;code&gt;onOptionsItemSelected&lt;/code&gt;的注释去掉，你就可以看到如下效果：&lt;br&gt;&lt;img src=&quot;http://7xtcu9.com1.z0.glb.clouddn.com/123123123.gif&quot; alt=&quot;image description&quot;&gt;&lt;/p&gt;
&lt;p&gt;点击左上角的按钮可以打开&lt;code&gt;DrawerLayout&lt;/code&gt;，这是为什么呢？&lt;br&gt;经我测试发现主要是&lt;code&gt;getSupportActionBar().setDisplayHomeAsUpEnabled(true);&lt;/code&gt;这个函数起的功劳，查官方API发现：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;public abstract void setDisplayHomeAsUpEnabled (boolean showHomeAsUp)&lt;/p&gt;
&lt;p&gt;Set whether home should be displayed as an “up” affordance. Set this to true if selecting “home” returns up by a single level in your UI rather than back to the top level or front page.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;所以才会有在&lt;code&gt;onOptionsItemSelected&lt;/code&gt;的注释的那段！如果你嫌弃那个自带的箭头，没事我们把它换了，&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;getSupportActionBar().setHomeAsUpIndicator(R.drawable.ic_menu);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;getSupportActionBar().setDisplayHomeAsUpEnabled(&lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;使用&lt;code&gt;setHomeAsUpIndicator&lt;/code&gt;函数可以选择相关图片加载。最后就是Toolbar和&lt;code&gt;DrawerLayout&lt;/code&gt;的配合了,效果如下：&lt;br&gt;&lt;img src=&quot;http://7xtcu9.com1.z0.glb.clouddn.com/132312312324.gif&quot; alt=&quot;image description&quot;&gt;&lt;br&gt;代码添加如下：&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;mDrawerToggle = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; ActionBarDrawerToggle(&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;, mDrawerLayout, toolbar, &lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onDrawerOpened&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(View drawerView)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt;.onDrawerOpened(drawerView);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            toolbar.setTitle(&lt;span class=&quot;string&quot;&gt;&quot;Opened&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onDrawerClosed&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(View drawerView)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt;.onDrawerClosed(drawerView);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            toolbar.setTitle(&lt;span class=&quot;string&quot;&gt;&quot;Closed&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    mDrawerToggle.syncState();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    mDrawerLayout.setDrawerListener(mDrawerToggle);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;有一些变量的声明代码中没有给出，对于有些基础的人来说应该是可以解决的，如果不行最后给大家一个下载链接，大家下载下来自己去实践吧。&lt;/p&gt;
&lt;p&gt;到这里Material Design的学习可能就告一段落了。Material Design很多的模式我没有学习，之后真正开始做项目的时候可能就需要用到。&lt;/p&gt;
&lt;p&gt;下载链接：&lt;a href=&quot;http://download.csdn.net/detail/cuihaoren01/9532123&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://download.csdn.net/detail/cuihaoren01/9532123&lt;/a&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Material-Design-四&quot;&gt;&lt;a href=&quot;#Material-Design-四&quot; class=&quot;headerlink&quot; title=&quot;Material Design(四)&quot;&gt;&lt;/a&gt;Material Design(四)&lt;/h1&gt;&lt;p&gt;今天来学习下之前
    
    </summary>
    
      <category term="Material Design学习" scheme="http://chr10003566.github.io./categories/Material-Design%E5%AD%A6%E4%B9%A0/"/>
    
    
  </entry>
  
  <entry>
    <title>Material Design学习（三）</title>
    <link href="http://chr10003566.github.io./2016/05/06/MaterialDesign3/"/>
    <id>http://chr10003566.github.io./2016/05/06/MaterialDesign3/</id>
    <published>2016-05-06T08:24:00.000Z</published>
    <updated>2016-05-18T03:17:27.000Z</updated>
    
    <content type="html">&lt;h1 id=&quot;Material-Design-三&quot;&gt;&lt;a href=&quot;#Material-Design-三&quot; class=&quot;headerlink&quot; title=&quot;Material Design(三)&quot;&gt;&lt;/a&gt;Material Design(三)&lt;/h1&gt;&lt;p&gt;上篇介绍了Material Design中的各种动画效果，结合第一篇就可以写出很棒的UI界面了，这次再学习下Material Design中其它控件.&lt;/p&gt;
&lt;p&gt;照常先贴学习链接:&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/traex/ExpandableLayout&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/traex/ExpandableLayout&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://githubonepiece.github.io/2015/11/26/Material-Design-Palette/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://githubonepiece.github.io/2015/11/26/Material-Design-Palette/&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://www.fx114.net/qa-26-168872.aspx&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.fx114.net/qa-26-168872.aspx&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://blog.csdn.net/jdsjlzx/article/details/41441083/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://blog.csdn.net/jdsjlzx/article/details/41441083/&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;https://github.com/Flipboard/bottomsheet&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/Flipboard/bottomsheet&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;ExpandableLayout&quot;&gt;&lt;a href=&quot;#ExpandableLayout&quot; class=&quot;headerlink&quot; title=&quot;ExpandableLayout&quot;&gt;&lt;/a&gt;ExpandableLayout&lt;/h2&gt;&lt;p&gt;这个组件还是很常用的，但是Android自带的那个ExpandableListView使用起来不是很好，而且其适配器得继承其自带的适配器，使得代码十分不好写。今天在Github上看到&lt;code&gt;ExpandableLayout&lt;/code&gt;真的是比Android自带的&lt;code&gt;ExpandableListView&lt;/code&gt;好用不是一点点。这个组件的效果大家都见过，比如QQ的好友展开等等就是使用了该控件。废话不多说，直接开始使用吧。&lt;/p&gt;
&lt;p&gt;要使用&lt;code&gt;ExpandableLayout&lt;/code&gt;十分简单，在&lt;code&gt;build.gradle&lt;/code&gt;中添加:&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;dependencies &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    compile &amp;apos;com.github.traex.expandablelayout:library:1.2.2&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;就可以调用了。接下来在&lt;code&gt;xml&lt;/code&gt;文件中就可以添加&lt;code&gt;ExpandableLayout&lt;/code&gt;,&lt;code&gt;ExpandableLayoutItem&lt;/code&gt;,&lt;code&gt;ExpandableLayoutListView&lt;/code&gt;这三个控件了。&lt;/p&gt;
&lt;p&gt;在&lt;code&gt;xml&lt;/code&gt;文件中使用&lt;code&gt;ExpandableLayout&lt;/code&gt;需要添加&lt;code&gt;head layout&lt;/code&gt;和&lt;code&gt;content layout&lt;/code&gt;(在下面代码中去理解).&lt;/p&gt;
&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;com.andexert.expandablelayout.library.ExpandableLayout&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;attr&quot;&gt;android:id&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;@+id/expandableLayout&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;attr&quot;&gt;xmlns:expandable&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;http://schemas.android.com/apk/res-auto&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;attr&quot;&gt;android:layout_width&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;match_parent&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;attr&quot;&gt;android:layout_height&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;match_parent&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;attr&quot;&gt;expandable:headerLayout&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;@layout/view_header&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;attr&quot;&gt;expandable:contentLayout&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;@layout/view_content&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;自己在写两个&lt;code&gt;xml&lt;/code&gt;文件即可，测试效果就是点击&lt;code&gt;view_header&lt;/code&gt;后&lt;code&gt;view_content&lt;/code&gt;显示出来。效果自己也可以很好的实现，即写两个控件其中一个不可见，点击其中一个设置另一个控件可见。&lt;/p&gt;
&lt;p&gt;同样的&lt;code&gt;ExpandableLayoutListView&lt;/code&gt;也可以添加到&lt;code&gt;xml&lt;/code&gt;文件。&lt;br&gt;&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;com.andexert.expandablelayout.library.ExpandableLayoutListView&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;android:id&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;@+id/expandableLayout&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;xmlns:expandable&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;http://schemas.android.com/apk/res-auto&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;android:layout_width&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;match_parent&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;android:layout_height&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;match_parent&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;而填充ListView则可以使用&lt;code&gt;ExpandableLayoutItem&lt;/code&gt;&lt;br&gt;&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;com.andexert.expandablelayout.library.ExpandableLayoutItem&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;attr&quot;&gt;android:id&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;@+id/expandableLayout&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;attr&quot;&gt;xmlns:expandable&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;http://schemas.android.com/apk/res-auto&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;attr&quot;&gt;android:layout_width&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;match_parent&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;attr&quot;&gt;android:layout_height&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;match_parent&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;attr&quot;&gt;expandable:headerLayout&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;@layout/view_header&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;attr&quot;&gt;expandable:contentLayout&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;@layout/view_content&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;是不是特别的简单。在&lt;code&gt;MainAcitivity.java&lt;/code&gt;中也不需要你做太多的事情，只需要你简单适配一下ListView就行，而ListView的适配就和正常ListView的适配相差无几。剩下的具体使用可以去Github上去看。这里只是做个简介！&lt;/p&gt;
&lt;h2 id=&quot;Palette&quot;&gt;&lt;a href=&quot;#Palette&quot; class=&quot;headerlink&quot; title=&quot;Palette&quot;&gt;&lt;/a&gt;Palette&lt;/h2&gt;&lt;p&gt;在Material Design设计中很重要的一部分内容是应用中的图片颜色和文字颜色和主题相匹配。而在&lt;code&gt;Android Lollipop&lt;/code&gt;发布的时候，&lt;code&gt;Palette&lt;/code&gt;类则用来实现上面说的效果。这个类的作用就是提取某张图片中的主要颜色，比如你有一张大海的图片，那么这个类可以提取出的这张照片的主要颜色可能是蓝色。接下来看看怎么使用这个类。&lt;/p&gt;
&lt;p&gt;首先你要使用这个类的话，你得依赖于：&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;compile &amp;apos;com.android.support:palette-v7:23.0.0&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;Palette有四种生成方式，其中前两种已经被google抛弃，但这里学习下不至于以后碰到了看不懂。&lt;/p&gt;
&lt;h3 id=&quot;已抛弃得用法&quot;&gt;&lt;a href=&quot;#已抛弃得用法&quot; class=&quot;headerlink&quot; title=&quot;已抛弃得用法.&quot;&gt;&lt;/a&gt;已抛弃得用法.&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;两种同步的方式：&lt;/strong&gt;&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Palette p = generate(Bitmap bitmap);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Palette p = generate(Bitmap bitmap ,&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; size)&lt;span class=&quot;comment&quot;&gt;//设置调色板得大小为size&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;两种异步得方式&lt;/strong&gt;：&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 简单快速的实现方法，内部使用AsyncTask&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 但是可能不是最优的方法(因为有线程的切换)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 默认调色板大小(16).&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Palette.generateAsync(bitmap, &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Palette.PaletteAsyncListener() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onGenerated&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Palette palette)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;comment&quot;&gt;// palette为生成的调色板&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 设置调色板大小(24)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Palette.generateAsync(bitmap, &lt;span class=&quot;number&quot;&gt;24&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Palette.PaletteAsyncListener() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onGenerated&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Palette palette)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;       &lt;span class=&quot;comment&quot;&gt;// palette为生成的调色板&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h3 id=&quot;提倡的方法&quot;&gt;&lt;a href=&quot;#提倡的方法&quot; class=&quot;headerlink&quot; title=&quot;提倡的方法&quot;&gt;&lt;/a&gt;提倡的方法&lt;/h3&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Palette.Builder builder = Palette.from(bitmap);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;builder.generate(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Palette.PaletteAsyncListener() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onGenerated&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Palette palette)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//或者很多时候也可以直接写成&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Palette.from(bitmap).generate(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; PaletteAsyncListener() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onGenerated&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Palette p)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// do something&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;调色板的大小值越大，生成得调色的时间越长，数值越小，得到的颜色信息也越少，调色板的大小最好根据图像类型来决定。（默认是16.）&lt;/p&gt;
&lt;p&gt;生成了Palette对象后就可以尝试获取六种不同的色板了，具体如下：&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;. Palette.Swatch s1 = Palette.getVibrantSwatch(); &lt;span class=&quot;comment&quot;&gt;//充满活力的色板&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;. Palette.Swatch s2 = Palette.getDarkVibrantSwatch(); &lt;span class=&quot;comment&quot;&gt;//充满活力的暗色类型色板&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;. Palette.Swatch s3 = Palette.getLightVibrantSwatch(); &lt;span class=&quot;comment&quot;&gt;//充满活力的亮色类型色板&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;. Palette.Swatch s4 = Palette.getMutedSwatch(); &lt;span class=&quot;comment&quot;&gt;//黯淡的色板&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;. Palette.Swatch s5 = Palette.getDarkMutedSwatch(); &lt;span class=&quot;comment&quot;&gt;//黯淡的暗色类型色板（翻译过来没有原汁原味的赶脚啊！）&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;. Palette.Swatch s6 = Palette.getLightMutedSwatch(); &lt;span class=&quot;comment&quot;&gt;//黯淡的亮色类型色板&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;可以根据需求自由选择色板类型，有了色板就可以根据色板来获取具体颜色信息，在&lt;code&gt;Swatch&lt;/code&gt;色板中提供了五种颜色信息，分别如下：&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;. getPopulation(): the number of pixels represented by &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt; swatch&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;. getRgb(): the RGB value of &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt; color.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;. getHsl(): the HSL value of &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt; color.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;. getBodyTextColor(): the RGB value of a text color which can be displayed on top of &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt; color.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;. getTitleTextColor(): the RGB value of a text color which can be displayed on top of &lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt; color.&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;示例代码如下：&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Palette.Swatch swatch = palette.getVibrantSwatch();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;TextView titleView = ...;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (swatch != &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    titleView.setBackgroundColor(swatch.getRgb());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    titleView.setTextColor(swatch.getTitleTextColor()); &lt;span class=&quot;comment&quot;&gt;//设置文本颜色&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;请注意必须对&lt;code&gt;swatch&lt;/code&gt;进行是否为&lt;code&gt;null&lt;/code&gt;的判断，因为如果面板无法找到相匹配的标准色，那么然后将返回&lt;code&gt;null&lt;/code&gt;，不进行判断将会出现空指针异常。也可以是用另一种方式&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;tv1.setBackgroundColor(palette.getVibrantColor(&lt;span class=&quot;number&quot;&gt;0x999933&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      tv2.setBackgroundColor(palette.getDarkVibrantColor(&lt;span class=&quot;number&quot;&gt;0x999933&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      tv3.setBackgroundColor(palette.getLightVibrantColor(&lt;span class=&quot;number&quot;&gt;0x999933&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      tv4.setBackgroundColor(palette.getMutedColor(&lt;span class=&quot;number&quot;&gt;0x999933&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      tv5.setBackgroundColor(palette.getDarkMutedColor(&lt;span class=&quot;number&quot;&gt;0x999933&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      tv6.setBackgroundColor(palette.getLightMutedColor(&lt;span class=&quot;number&quot;&gt;0x999933&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;设置默认的颜色&lt;code&gt;0x999933&lt;/code&gt;即使为空也可以填充默认的颜色。&lt;/p&gt;
&lt;p&gt;这里也是个简单的说明，效果大概如下：&lt;br&gt;&lt;img src=&quot;http://7xtcu9.com2.z0.glb.clouddn.com/Palette.png&quot; alt=&quot;Palette效果&quot;&gt;&lt;/p&gt;
&lt;p&gt;这个代码很简单，大家按照上面的代码试试就能得到了，具体&lt;code&gt;Palette&lt;/code&gt;在Material Design的App中的应用大家可以看看这个项目，链接：&lt;br&gt;&lt;a href=&quot;http://blog.csdn.net/jdsjlzx/article/details/41441083/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Material Design之Toolbar与Palette实践&lt;/a&gt;，博主源码也给了，大家可以试试看。&lt;/p&gt;
&lt;h2 id=&quot;Bottom-Sheet&quot;&gt;&lt;a href=&quot;#Bottom-Sheet&quot; class=&quot;headerlink&quot; title=&quot;Bottom Sheet&quot;&gt;&lt;/a&gt;Bottom Sheet&lt;/h2&gt;&lt;p&gt;哇，这个看起来就不是一般的帅了。知乎的分享大家都用过吧，那个从底下弹出来然后一堆的可以分享应用(如微信，qq)给你选择。你上滑整个界面也会往上划，看上去是不是很帅。效果很棒代码应该很难写吧？ No No No，代码真的一点都不复杂，因为总有大神会帮你搞出个&lt;code&gt;Library&lt;/code&gt;出来。今天学习的是&lt;code&gt;Flipboard&lt;/code&gt;做的&lt;code&gt;bottomsheet&lt;/code&gt;，链接已经贴在上面了。使用的话Github上有个sample你可以自己下下来看看效果然后实践下即可，这里就给大家抛砖引玉下吧。&lt;br&gt;&lt;img src=&quot;http://7xtcu9.com1.z0.glb.clouddn.com/Bottom.gif&quot; alt=&quot;image description&quot;&gt;&lt;br&gt;那么开始吧，如果你要使用bottom sheet的话，请记得在你的&lt;code&gt;build.gradle&lt;/code&gt;中添加&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;dependencies&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    compile &amp;apos;com.flipboard:bottomsheet-core:1.5.0&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    compile &amp;apos;com.flipboard:bottomsheet-commons:1.5.0&amp;apos; //optional&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;这里有个&lt;code&gt;optional&lt;/code&gt;是什么个意思，解释下：如果你只需要bottom sheet显示一个页面的话，你可以不依赖第二个。否则请添加上。&lt;/p&gt;
&lt;p&gt;布局文件上呢也有轻微的变化，比如你曾经是这么写布局文件的。&lt;br&gt;&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;LinearLayout&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;android:id&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;@+id/root&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;android:orientation&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;vertical&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;android:layout_width&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;match_parent&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;android:layout_height&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;match_parent&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;View&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;android:id&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;@+id/view1&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;android:layout_width&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;match_parent&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;android:layout_height&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;match_parent&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;LinearLayout&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;如果你要在这个布局文件中使用bottom sheet的话，请将你的布局文件该成下面这样：&lt;br&gt;&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;com.flipboard.bottomsheet.BottomSheetLayout&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;android:id&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;@+id/bottomsheet&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;android:layout_width&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;match_parent&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;attr&quot;&gt;android:layout_height&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;match_parent&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;LinearLayout&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;android:id&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;@+id/root&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;android:orientation&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;vertical&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;android:layout_width&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;match_parent&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;android:layout_height&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;match_parent&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;View&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;attr&quot;&gt;android:id&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;@+id/view1&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;attr&quot;&gt;android:layout_width&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;match_parent&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;attr&quot;&gt;android:layout_height&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;match_parent&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;LinearLayout&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;com.flipboard.bottomsheet.BottomSheetLayout&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;首先是最简单的：只显示一个界面那你只需要在你的&lt;code&gt;.java&lt;/code&gt;文件中加下面2句话&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;BottomSheetLayout bottomSheet = (BottomSheetLayout) findViewById(R.id.bottomsheet);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;bottomSheet.showWithSheetView(LayoutInflater.from(context).inflate(R.layout.my_sheet_layout, bottomSheet, &lt;span class=&quot;keyword&quot;&gt;false&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;这里的&lt;code&gt;R.layout.my_sheet_layout&lt;/code&gt;即是你要显示的页面。&lt;/p&gt;
&lt;p&gt;第二个种就是知乎分享按钮弹出来的界面：即你可以在上面的View中进行点击后执行相应的操作。&lt;br&gt;&lt;img src=&quot;http://7xtcu9.com1.z0.glb.clouddn.com/Screenshot_2016-05-16-14-39-19.jpeg&quot; alt=&quot;知乎的分享界面&quot;&gt;&lt;br&gt;布局文件同样如上，只是你不需要再写一个需要显示的布局文件。相关的代码如下：&lt;br&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;btn2.setOnClickListener(&lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; View.OnClickListener() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onClick&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(View v)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; Intent intent = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; Intent(Intent.ACTION_SEND);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        intent.putExtra(Intent.EXTRA_TEXT, &lt;span class=&quot;string&quot;&gt;&quot;dasjdasjdsadasd&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        intent.setType(&lt;span class=&quot;string&quot;&gt;&quot;text/plain&quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        IntentPickerSheetView intentPickerSheet = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; IntentPickerSheetView(MainActivity.&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;, intent,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;string&quot;&gt;&quot;I love you&quot;&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; IntentPickerSheetView.OnIntentPickedListener() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onIntentPicked&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(IntentPickerSheetView.ActivityInfo activityInfo)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                bottomsheet.dismissSheet();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                startActivity(activityInfo.getConcreteIntent(intent));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        List&amp;lt;IntentPickerSheetView.ActivityInfo&amp;gt; activityInfo = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;&amp;gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Drawable customDrawable = ResourcesCompat.getDrawable(getResources(), R.mipmap.ic_launcher, &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        IntentPickerSheetView.ActivityInfo customInfo = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; IntentPickerSheetView.ActivityInfo(customDrawable, &lt;span class=&quot;string&quot;&gt;&quot;Custom mix-in&quot;&lt;/span&gt;, MainActivity.&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;, MainActivity.class);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        activityInfo.add(customInfo);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Drawable customDrawable2 = ResourcesCompat.getDrawable(getResources(), R.mipmap.ic_launcher, &lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        IntentPickerSheetView.ActivityInfo customInfo2 = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; IntentPickerSheetView.ActivityInfo(customDrawable2, &lt;span class=&quot;string&quot;&gt;&quot;Custom mix-in123123&quot;&lt;/span&gt;, MainActivity.&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;, Main2Activity.class);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        activityInfo.add(customInfo2);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        intentPickerSheet.setMixins(activityInfo);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        bottomsheet.showWithSheetView(intentPickerSheet);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;这里稍微做点说明，具体的还是大家测试才知道。我也是试了然后看了作者的函数以及调用参数后自己写的。如果大家要实现知乎的那个分享效果的话，只需要把&lt;code&gt;Intent.ACTION_SEND&lt;/code&gt;这里换成分享的&lt;code&gt;Intent&lt;/code&gt;就好了。具体的我这里就不就不写了，也不是本文的重点。下面还有一堆的代码是我们用户自己添加到&lt;code&gt;bottomsheet&lt;/code&gt;界面上的，添加了一个icon，title和点击该视图所执行的操作&lt;br&gt;&lt;code&gt;intentPickerSheet.setMixins(List ActivityInfo)&lt;/code&gt;&lt;br&gt;你可以根据上面的方式添加多个你想要的&lt;code&gt;ActivityInfo&lt;/code&gt;，之后你把它添加到&lt;code&gt;ActivityInfo&lt;/code&gt;的集合中去即可。&lt;/p&gt;
&lt;p&gt;最后如果你想要自己定制的Bottom sheet的话，你就需要使用这个库中&lt;code&gt;MenuSheetView&lt;/code&gt;了，这个也很好写。具体代码如下：&lt;/p&gt;
&lt;p&gt;首先你得创建一个&lt;code&gt;menu&lt;/code&gt;文件夹（如果有就不必创建了），在&lt;code&gt;menu&lt;/code&gt;文件夹下新建一个&lt;code&gt;activity_menu.xml&lt;/code&gt;文件。代码如下：&lt;/p&gt;
&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;menu&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;xmlns:android&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;http://schemas.android.com/apk/res/android&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;item&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;android:title&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;@string/document&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;android:icon&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;@mipmap/ic_launcher&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        /&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;item&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;android:title&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;@string/spreadsheet&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;android:icon&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;@mipmap/ic_launcher&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        /&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;item&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;android:title&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;@string/folder&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;android:icon&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;@mipmap/ic_launcher&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        /&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;item&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;android:id&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;@+id/menu_subheader&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;android:title&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;menu&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;item&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;attr&quot;&gt;android:id&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;@+id/navigation_sub_item_1&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;attr&quot;&gt;android:icon&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;@mipmap/ic_launcher&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;attr&quot;&gt;android:title&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;@string/upload_photos&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;item&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;attr&quot;&gt;android:id&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;@+id/navigation_sub_item_2&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;attr&quot;&gt;android:icon&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;@mipmap/ic_launcher&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;attr&quot;&gt;android:title&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;@string/use_camera&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;menu&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;item&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;item&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;android:id&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;@+id/reopen&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;android:title&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;@string/reopen&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;attr&quot;&gt;android:icon&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;@mipmap/ic_launcher&quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    /&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;menu&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;接着在&lt;code&gt;MainActivity.java&lt;/code&gt;中为&lt;code&gt;menu&lt;/code&gt;中的item添加点击事件。&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;MenuSheetView menuSheetView =&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; MenuSheetView(MenuActivity.&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;, MenuSheetView.MenuType.LIST, &lt;span class=&quot;string&quot;&gt;&quot;Create...&quot;&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; MenuSheetView.OnMenuItemClickListener() &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;onMenuItemClick&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(MenuItem item)&lt;/span&gt; &lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                Toast.makeText(MenuActivity.&lt;span class=&quot;keyword&quot;&gt;this&lt;/span&gt;, item.getTitle(), Toast.LENGTH_SHORT).show();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (bottomSheetLayout.isSheetShowing()) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    bottomSheetLayout.dismissSheet();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;true&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;menuSheetView.inflateMenu(R.menu.activity_menu);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;bottomSheetLayout.showWithSheetView(menuSheetView);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;当然&lt;code&gt;MenuSheetView.MenuType&lt;/code&gt;除了&lt;code&gt;LIST&lt;/code&gt;还有&lt;code&gt;GRID&lt;/code&gt;，一个是列表一个是表格，上面的GIF已经把效果显示出来了。&lt;/p&gt;
&lt;p&gt;在它的&lt;code&gt;sample&lt;/code&gt;中还有两种其他的效果，一种是&lt;code&gt;ImagePicker&lt;/code&gt;就是把相册中的图片放到了&lt;code&gt;bottomsheet&lt;/code&gt;中。另一个是在&lt;code&gt;bottomsheet&lt;/code&gt;中显示一个&lt;code&gt;Fragment&lt;/code&gt;，竟然都能显示&lt;code&gt;Fragment&lt;/code&gt;了那估计想干么就能干么了。但在实际的App中常见的用途是前面介绍的两种，后面两种等需要使用的时候在继续学习。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Material-Design-三&quot;&gt;&lt;a href=&quot;#Material-Design-三&quot; class=&quot;headerlink&quot; title=&quot;Material Design(三)&quot;&gt;&lt;/a&gt;Material Design(三)&lt;/h1&gt;&lt;p&gt;上篇介绍了Mat
    
    </summary>
    
      <category term="Material Design学习" scheme="http://chr10003566.github.io./categories/Material-Design%E5%AD%A6%E4%B9%A0/"/>
    
    
  </entry>
  
</feed>
